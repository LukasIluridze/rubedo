import{ItemStack as or,MinecraftItemTypes as rr,world as ir}from"@minecraft/server";import{world as Yn}from"@minecraft/server";var v="-";import{world as jn}from"@minecraft/server";import{BlockLocation as Fn}from"@minecraft/server";var bt=32e3,ne="rubedo:database",B=new Fn(0,-64,0);import{ItemStack as Gn,MinecraftItemTypes as Hn}from"@minecraft/server";function kt(t,e){return t.match(new RegExp(".{1,"+e+"}","g"))}import{BlockLocation as Vn,MinecraftDimensionTypes as W,world as J}from"@minecraft/server";import{MessageFormData as zn}from"@minecraft/server-ui";var q=class{constructor(e,n){this.title=e,this.body=n,this.form=new zn,e&&this.form.title(e),n&&this.form.body(n),this.triedToShow=0}setButton1(e,n){return this.button1={text:e,callback:n},this.form.button1(e),this}setButton2(e,n){return this.button2={text:e,callback:n},this.form.button2(e),this}show(e){this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e)}return}n.selection==1&&this.button1?.callback?.(),n.selection==0&&this.button2?.callback?.()})}};var k={overworld:J.getDimension(W.overworld),nether:J.getDimension(W.nether),theEnd:J.getDimension(W.theEnd),"minecraft:overworld":J.getDimension(W.overworld),"minecraft:nether":J.getDimension(W.nether),"minecraft:the_end":J.getDimension(W.theEnd)};function re(t){let e=t.split(",");console.warn(e.length);let n=0;for(let o of e){let r=parseInt(o.match(/\D+|\d+/g)[0]),i=o.match(/\D+|\d+/g)[1];i=="y"&&(n=n+317098e-16*r),i=="w"&&(n=n+6048e5*r),i=="d"&&(n=n+864e5*r),i=="h"&&(n=n+36e5*r),i=="m"&&(n=n+6e4*r),i=="s"&&(n=n+1e3*r),i=="ms"&&(n=n+r)}return n}function X(t){return new Date(t).toString()}function It(t){return new Vn(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z))}function be(t,e,n,o=()=>{}){new q("Confirm To Continue",e).setButton1("Confirm",n).setButton2("Never Mind",o).show(t)}var g=class{static compress(e){return e}static decompress(e){return e}static createEntity(e,n){let o=k.overworld.spawnEntity(ne,B);o.setDynamicProperty("name",e),o.setDynamicProperty("index",n);let r=o.getComponent("inventory").container,i=new Gn(Hn.acaciaBoat,1);return n==0&&(i.nameTag="{}"),r.setItem(0,i),o}static getInventorySlotName(e,n){return e.getComponent("inventory").container.getItem(n)?.nameTag}static setInventorySlotName(e,n,o){let r=e.getComponent("inventory").container,i=r.getItem(n);return i.nameTag=o,r.setItem(n,i)}constructor(e){this.name=e,this.savedEntitys=void 0,this.MEMORY=void 0}get entitys(){if(this.savedEntitys)return this.savedEntitys;let e=k.overworld.getEntitiesAtBlockLocation(B).filter(n=>n.typeId==ne&&n.getDynamicProperty("name")==this.name);return this.savedEntitys=e,e}data(){if(this.MEMORY)return this.MEMORY;if(this.entitys.length==0&&g.createEntity(this.name,0),this.entitys.length==1){let n=JSON.parse(g.decompress(g.getInventorySlotName(this.entitys[0],0)));return this.MEMORY=n,n}let e=new Array(this.entitys.length);for(let n of this.entitys){let o=n.getDynamicProperty("index");e[o]=g.getInventorySlotName(n,0)}try{e=JSON.parse(e.join(""))}catch{e={}}return this.MEMORY=e,e}save(e){this.MEMORY=e;let n=kt(g.compress(JSON.stringify(e)),bt);if(this.entitys&&n.length==this.entitys.length)for(let o=0;o<n.length;o++)g.setInventorySlotName(this.entitys[o],0,n[o]);else{this.entitys?.forEach(o=>o?.triggerEvent("despawn")),this.savedEntitys=void 0;for(let o=0;o<n.length;o++){let r=g.createEntity(this.name,o);g.setInventorySlotName(r,0,n[o])}}}set(e,n){let o=this.data();o[e]=n,this.save(o)}get(e){return this.data()[e]}has(e){return this.keys().includes(e)}delete(e){let n=this.data(),o=delete n[e];return this.save(n),o}size(){return this.keys().length}clear(){this.save({})}keys(){return Object.keys(this.data())}values(){return Object.values(this.data())}getCollection(){return this.data()}};var s={config:new g("config"),freezes:new g("freezes"),mutes:new g("mutes"),bans:new g("bans"),regions:new g("regions"),roles:new g("roles"),tasks:new g("tasks"),npcs:new g("npcs"),ids:new g("ids"),logs:new g("logs")};function Ct(t){return[...jn.getPlayers()].find(e=>e.name===t)}var F=class{constructor(e="literal"){this.name=e;this.typeName="literal";this.name=e}matches(e){return{success:this.name==e}}fail(e){return`${e} should be ${this.name}!`}},ie=class{constructor(e="string"){this.name=e;this.typeName="string";this.name=e}matches(e){return{success:e&&e!="",value:e}}fail(e){return"Value must be of type string!"}},se=class{constructor(e="integer"){this.name=e;this.typeName="int";this.name=e}matches(e){return{success:!isNaN(e),value:parseInt(e)}}fail(e){return"Value must be valid number!"}},Fe=class{constructor(e="float"){this.name=e;this.typeName="float";this.name=e}matches(e){return{success:Boolean(e?.match(/^\d+\.\d+$/)?.[0]),value:parseInt(e)}}fail(e){return"Value must be valid float!"}},j=class{constructor(e="location"){this.name=e;this.typeName="location";this.name=e}matches(e){return{success:/^([~^]{0,1}(-\d)?(\d*)?(\.(\d+))?)$/.test(e),value:e}}fail(e){return"Value needs to be a valid number, value can include: [~,^]"}},ae=class{constructor(e="boolean"){this.name=e;this.typeName="boolean";this.name=e}matches(e){return{success:Boolean(e?.match(/^(true|false)$/)?.[0]),value:e=="true"}}fail(e){return`"${e}" can be either "true" or "false"`}},ze=class{constructor(e="player"){this.name=e;this.typeName="playerName";this.name=e}matches(e){return{success:!!Ct(e),value:Ct(e)}}fail(e){return`player: "${e}", is not in this world`}},Ve=class{constructor(e="target"){this.name=e;this.typeName="Target";this.name=e}matches(e){return{success:Boolean(e?.match(/^(@.|"[\s\S]+")$/)?.[0]),value:e}}fail(e){return`${e} is not a valid target`}},me=class{constructor(e="array",n){this.name=e;this.types=n;this.typeName="string";this.name=e,this.types=n,this.typeName=n.join(" | ").replace(/(.{25})..+/,"$1...")}matches(e){return{success:this.types.includes(e),value:e}}fail(e){return`"${e}" must be one of these values: ${this.types.join(" | ")}`}},Ge=class{constructor(e){this.name=e;this.typeName="Duration"}matches(e){return{success:/^(\d+[hdysmw],?)+$/.test(e),value:e}}fail(e){return`"${e}" must be a value like "10d" or "3s" the first part is the length second is unit`}},He=class{constructor(e="playerName"){this.name=e;this.typeName="playerName";this.name=e}matches(e){return{success:!!s.ids.get(e),value:e}}fail(e){return`player: "${e}" has never played this world before! Tip: if the name has spaces in it use quotes around name!`}},f={string:ie,int:se,float:Fe,location:j,boolean:ae,player:ze,target:Ve,array:me,duration:Ge,playerName:He};var ke=class{constructor(e){this.data=e,this.sender=e.sender}reply(e){this.sender.tell(e)}};function wt(t,e){try{return t.slice(e.length).trim().match(/"[^"]+"|[^\s]+/g).map(n=>n.replace(/"(.+)"/,"$1").toString())}catch{return[]}}function Tt(t,e){t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.unknown",with:[`${e}`]}]})}function je(t,e){t.tell({rawtext:[{text:e.data.invaildPermission?e.data.invaildPermission:`\xA7cYou do not have permission to use "${e.data.name}"`}]})}function vt(t,e,n,o,r){if(t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.syntax",with:[`${v}${e.data.name} ${o.slice(0,r).join(" ")}`,o[r]??" ",o.slice(r+1).join(" ")]}]}),n.children.length>1||!o[r]){let i=n.children.map(a=>a.type instanceof F?a.type.name:a.type?.typeName);t.tell(`\xA7c"${o[r]??"undefined"}" is not valid! Argument "${[...new Set(n.children.map(a=>a.type.name))][0]}" can be typeof: "${i.join('", "')}"`)}else t.tell(`\xA7c${n.children[0]?.type?.fail(o[r])}`)}function Un([t,e,n],{location:o,viewVector:r}){if(!t||!e||!t)return null;let i=[o.x,o.y,o.z],a=[r.x,r.y,r.z],c=[t,e,n].map(y=>{let C=parseFloat(y);return isNaN(C)?0:C}),d=[t,e,n].map((y,C)=>y.includes("~")?c[C]+i[C]:y.includes("^")?c[C]+a[C]:c[C]);return{x:d[0],y:d[1],z:d[2]}}function Et(t,e,n,o){let r=e[e.length-1]??o,i=[];for(let[a,c]of e.entries())if(!c.type.name.endsWith("*")){if(c.type instanceof j){i.push(Un([t[a],t[a+1],t[a+2]],n.sender));continue}c.type instanceof F||i.push(c.type.matches(t[a]).value??t[a])}r.callback(new ke(n),...i)}var M=[];Yn.events.beforeChat.subscribe(t=>{if(!t.message.startsWith(v))return;t.cancel=!0;let e=wt(t.message,v),n=M.find(i=>i.depth==0&&(i.data.name==e[0]||i.data?.aliases?.includes(e[0])));if(!n)return Tt(t.sender,e[0]);if(!n.data?.requires(t.sender))return je(t.sender,n);e.shift();let o=[],r=(i,a)=>{if(i.children.length>0){let c=i.children.find(d=>d.type.matches(e[a]).success);return!c&&!e[a]&&i.callback?void 0:c?c.data?.requires(t.sender)?(o.push(c),r(c,a+1)):(je(t.sender,c),"fail"):(vt(t.sender,n,i,e,a),"fail")}};r(n,0)||Et(e,o,t,n)});import{Player as oo,world as We}from"@minecraft/server";var St="rubedo:gui",ce="rubedo:inventory";import{world as $,Player as qn,BlockLocation as Ot,MinecraftBlockTypes as Wn,GameMode as Jn}from"@minecraft/server";var At={doorsAndSwitches:!0,openContainers:!0,pvp:!1,allowedEntitys:["minecraft:player","minecraft:npc","minecraft:item","rubedo:inventory","rubedo:database"]},Pt=["minecraft:acacia_door","minecraft:acacia_trapdoor","minecraft:acacia_button","minecraft:birch_door","minecraft:birch_trapdoor","minecraft:birch_button","minecraft:crimson_door","minecraft:crimson_trapdoor","minecraft:crimson_button","minecraft:dark_oak_door","minecraft:dark_oak_trapdoor","minecraft:dark_oak_button","minecraft:jungle_door","minecraft:jungle_trapdoor","minecraft:jungle_button","minecraft:mangrove_door","minecraft:mangrove_trapdoor","minecraft:mangrove_button","minecraft:spruce_door","minecraft:spruce_trapdoor","minecraft:spruce_button","minecraft:warped_door","minecraft:warped_trapdoor","minecraft:warped_button","minecraft:wooden_door","minecraft:wooden_button","minecraft:trapdoor","minecraft:iron_door","minecraft:iron_trapdoor","minecraft:polished_blackstone_button","minecraft:lever"],xt=["minecraft:chest","minecraft:ender_chest","minecraft:barrel","minecraft:trapped_chest","minecraft:dispenser","minecraft:dropper","minecraft:furnace","minecraft:blast_furnace","minecraft:lit_furnace","minecraft:lit_blast_furnace","minecraft:hopper","minecraft:shulker_box","minecraft:undyed_shulker_box","minecraft:lit_smoker","minecraft:smoker"];var Ue=[],Kn=!1,Nt=-64,Bt=320;function Rt(t,e,n){return n.every((o,r)=>o>=Math.min(t[r],e[r])&&o<=Math.max(t[r],e[r]))}var h=class{static getAllRegions(){if(Kn)return Ue;let e=s.regions.values().map(n=>new h(n.from,n.to,n.dimensionId,n.permissions,n.key));return e.forEach(n=>{Ue.push(n)}),e}static blockLocationInRegion(e,n){return this.getAllRegions().find(o=>o.dimensionId==n&&Rt([o.from.x,Nt,o.from.z],[o.to.x,Bt,o.to.z],[e.x,e.y,e.z]))}static removeRegionAtBlockLocation(e,n){let o=this.blockLocationInRegion(e,n);return o?s.regions.delete(o.key):!1}constructor(e,n,o,r,i){this.from=e,this.to=n,this.dimensionId=o,this.permissions=r??At,this.key=i||Date.now().toString(),i||(this.update(),Ie(),Ue.push(this))}update(){s.regions.set(this.key,{key:this.key,from:this.from,dimensionId:this.dimensionId,permissions:this.permissions,to:this.to})}delete(){return s.regions.delete(this.key)}entityInRegion(e){return this.dimensionId==e.dimension.id&&Rt([this.from.x,Nt,this.from.z],[this.to.x,Bt,this.to.z],[e.location.x,e.location.y,e.location.z])}changePermission(e,n){this.permissions[e]=n,this.update()}};var D=class{static getTasks(){return s.tasks.get("changePlayerRole")??[]}static getPlayersRoleToSet(e){return D.getTasks().find(o=>o.playerName==e)?.role}constructor(e,n){let o=D.getTasks();o.push({playerName:e,role:n}),s.tasks.set("changePlayerRole",o)}};import{MinecraftBlockTypes as le,MinecraftItemTypes as u}from"@minecraft/server";var _t=[u.beehive.id,u.beeNest.id,u.axolotlBucket.id,u.codBucket.id,u.tadpoleBucket.id,u.tropicalFishBucket.id,u.salmonBucket.id,u.pufferfishBucket.id],Lt=[u.allow.id,u.barrier.id,u.borderBlock.id,u.debugStick?.id??"minecraft:debug_stick",u.deny.id,u.jigsaw.id,u.lightBlock.id,u.commandBlock.id,u.repeatingCommandBlock.id,u.chainCommandBlock.id,u.commandBlockMinecart.id,u.structureBlock.id,u.structureVoid.id,u.bedrock.id,u.endPortalFrame.id,"minecraft:info_update","minecraft:info_update2","minecraft:reserved3","minecraft:reserved4","minecraft:reserved6","minecraft:movingBlock","minecraft:moving_block","minecraft:movingblock","minecraft:piston_arm_collision","minecraft:piston_arm_collision","minecraft:pistonarmcollision","minecraft:stickyPistonArmCollision","minecraft:sticky_piston_arm_collision","minecraft:unknown","minecraft:glowingobsidian","minecraft:invisible_bedrock","minecraft:invisiblebedrock","minecraft:netherreactor","minecraft:portal","minecraft:fire","minecraft:water","minecraft:lava","minecraft:flowing_lava","minecraft:flowing_water","minecraft:soul_fire"],Mt=[le.dispenser.id],Dt=[le.bedrock.id,le.barrier.id,"minecraft:invisiblebedrock","minecraft:movingBlock","minecraft:movingblock","minecraft:moving_block"],Ce=[le.chest.id,le.trappedChest.id],Zr=[u.chest.id,u.trappedChest.id,u.barrel.id,u.dispenser.id,u.dropper.id,u.furnace.id,"minecraft:lit_furnace",u.blastFurnace.id,"minecraft:lit_blast_furnace",u.smoker.id,"minecraft:lit_smoker",u.hopper.id,u.shulkerBox.id,u.undyedShulkerBox.id],U={x:7,y:7,z:7};var we={aquaAffinity:1,baneOfArthropods:5,binding:1,blastProtection:4,channeling:1,depthStrider:3,efficiency:5,featherFalling:4,fireAspect:2,fireProtection:4,flame:1,fortune:3,frostWalker:2,impaling:5,infinity:1,knockback:2,looting:3,loyalty:4,luckOfTheSea:3,lure:3,mending:1,multishot:1,piercing:4,power:5,projectileProtection:4,protection:4,punch:2,quickCharge:3,respiration:3,riptide:3,sharpness:5,silkTouch:1,smite:5,soulSpeed:3,swiftSneak:4,thorns:3,unbreaking:3,vanishing:1};var $t="2.6.1-beta";var Te="https://discord.gg/dMa3A5UYKX";function R(t,e=[],n){if(console.warn(e),ve(t))return console.warn("[WARNING]: TRIED TO KICK OWNER"),t.tell("You have been tried to kick, but you cant!"),n?.();try{t.runCommandAsync(`kick @s \xA7r${e.join(`
`)}`),t.triggerEvent("kick")}catch(o){if(t.triggerEvent("kick"),!/"statusCode":-2147352576/.test(o))return;n&&n()}}function m(t){return t instanceof qn?s.roles.get(t.name)??"member":s.roles.get(t)??"member"}function Z(t,e){if(typeof t=="string"){s.roles.set(t,e);let n=[...$.getPlayers()].find(o=>o.name==t);n?n.setDynamicProperty("role",e):new D(t,e)}else s.roles.set(t.name,e),t.setDynamicProperty("role",e)}function ve(t){return $.getDynamicProperty("worldsOwner")==t.id}function Ft(){return $.getDynamicProperty("worldsOwner")}function Ee(t){$.setDynamicProperty("worldsOwner",t.id.toString())}function Se(){return $.getDynamicProperty("isLockDown")??!1}function Ye(t){$.setDynamicProperty("isLockDown",t)}function Ie(){for(let t of h.getAllRegions()){let e=new Ot(t.from.x,t.dimensionId=="minecraft:overworld"?-64:0,t.from.z),n=new Ot(t.to.x,t.dimensionId=="minecraft:overworld"?-64:0,t.to.z);for(let o of e.blocksBetween(n))k[t.dimensionId].getBlock(o)?.setType(Wn.deny)}}var zt=[];function _(t,e=0){zt.push({callback:t,delay:e,lastCall:0})}$.events.tick.subscribe(t=>{let e=[...$.getPlayers()];for(let[n,o]of e.entries())if(!["moderator","admin"].includes(m(o)))for(let r of zt)r.delay!=0&&t.currentTick-r.lastCall<r.delay||(r.callback(o,t),n==e.length-1&&(r.lastCall=t.currentTick))});function p(t){switch(t){case"spam_config":return s.config.get("spam_config")??{repeatedMessages:!0,zalgo:!0,violationCount:0,permMutePlayer:!1};case"cbe_config":return s.config.get("cbe_config")??{clearItem:!0,violationCount:0,banPlayer:!1,canAddEnchantment:!1};case"gamemode_config":return s.config.get("gamemode_config")??{setToSurvival:!0,clearPlayer:!0,violationCount:0,banPlayer:!1};case"nuker_data":return s.config.get("nuker_data")??{violationCount:0,banPlayer:!1};case"banned_items":return s.config.get("banned_items")??Lt;case"banned_blocks":return s.config.get("banned_blocks")??Dt;case"enchantments":return s.config.get("enchantments")??we;case"appealLink":return s.config.get("appealLink")??Te}}function P(t,e){s.config.set(t,e)}function Vt(t){return p("enchantments")[t.type.id]??t.type.maxLevel}function Gt(t){return Object.values(Jn).find(e=>[...$.getPlayers({name:t.name,gameMode:e})].length)}import{world as Ht}from"@minecraft/server";var jt=new Map,de=class{constructor(e,n,o=!1,r=Date.now()){this.callbackTick=null,this.tickDelay=n,this.loop=o,this.callback=e,this.id=r,jt.set(r,this),this.TickCallBack=Ht.events.tick.subscribe(({currentTick:i})=>{if(this.callbackTick||(this.callbackTick=i+this.tickDelay),!(this.callbackTick>i)){if(this.callback(i),!this.loop)return this.expire();this.callbackTick=i+this.tickDelay}})}expire(){Ht.events.tick.unsubscribe(this.TickCallBack),jt.delete(this.id)}};var Ut=t=>new Promise(e=>Ke(e,t));function Ke(t,e){new de(t,e)}function x(t,e){return new de(t,e,!0)}import{world as Jt}from"@minecraft/server";var qe={},Yt={},z={};function Xn(t,e,n){if(e.length!=n.length)return[];let o=[];for(let r=0;r<n.length;r++){if(e[r]?.item?.amount<n[r]?.item?.amount||e[r]?.item?.amount>n[r]?.item?.amount&&e[r]?.item?.amount!=0){let i={slot:r,uid:n[r].uid,oldUid:e[r].uid,item:n[r].item,oldItem:e[r].item,changeType:"fluctuation"};o.push(i),z[t.id]=i;continue}if(n[r].uid!=e[r].uid)if(e[r]?.item&&n[r]?.item){let i={slot:r,uid:n[r].uid,oldUid:e[r].uid,item:n[r].item,oldItem:e[r].item,changeType:"swap"};o.push(i),z[t.id]=i}else if(n[r]?.item){if(n[r]?.item)if(z[t.id]?.changeType=="delete"&&z[t.id]?.uid==n[r].uid){let i={slot:r,uid:n[r].uid,item:n[r].item,changeType:"move"};o.push(i),z[t.id]=i;continue}else{let i={slot:r,uid:n[r].uid,item:n[r].item,changeType:"put"};o.push(i),z[t.id]=i}}else{let i={slot:r,uid:e[r].uid,item:e[r].item,changeType:"delete"};o.push(i),z[t.id]=i}}return o}function Zn(t){if(!t)return"";let e=[];return e.push(t.typeId),e.push(t.nameTag),e.push(t.data),e.push(t.getLore().join("")),e.join("")}function Qn(t){let e=[];for(let n=0;n<t.size;n++){let o=t.getItem(n);e[n]={uid:Zn(o),item:o}}return e}x(()=>{for(let t of Object.values(qe))for(let e of k.overworld.getEntities(t.entities)){let n=Qn(e.getComponent("inventory").container),o=Xn(e,Yt[e.id]??n,n);if(Yt[e.id]=n,o.length!=0){if(e.hasTag("skipCheck")){e.removeTag("skipCheck"),delete z[e.id];continue}for(let r of o)t.callback(e,r)}}},5);var ue=class{static subscribe(e,n){let o=Date.now();return qe[o]={callback:n,entities:e},o}static unsubscribe(e){delete qe[e]}};import{Location as to}from"@minecraft/server";import{world as eo}from"@minecraft/server";var b=class{constructor(){this.data=new Map,this.events={playerLeave:eo.events.playerLeave.subscribe(e=>this.data.delete(e.playerName))}}set(e,n){this.data.set(e.name,n)}get(e){return this.data.get(e.name)}delete(e){this.data.delete(e.name)}clear(){this.data.clear()}playerNames(){return[...this.data.keys()]}includes(e){return this.playerNames().includes(e.name)}};var N={},Q={},pe=new b;function Kt(t){return t.getComponent("minecraft:inventory").container.getItem(t.selectedSlot)}async function qt(t,e){try{let n=t.getComponent("minecraft:inventory").container,o=[];for(let r=0;r<n.size;r++){let i=n.getItem(r);!i||i?.typeId==e?.typeId&&(o.push({slot:r,item:i}),n.setItem,r<9?await t.runCommandAsync(`replaceitem entity @s slot.hotbar ${r} air`):await t.runCommandAsync(`replaceitem entity @s slot.inventory ${r-9} air`))}await t.runCommandAsync(`clear @s ${e?.typeId} ${e.data} ${e.amount}`);for(let r of o)n.setItem(r.slot,r.item)}catch{[...t.dimension.getEntities({type:"minecraft:item",location:new to(t.location.x,t.location.y,t.location.z),maxDistance:2,closest:1})].forEach(o=>o.kill())}}function Wt(t,e){return t.getComponent("minecraft:inventory").container.getItem(e)}var Ae=class{constructor(e,n,o){this.gui=e,this.slot=n,this.change=o}message(e){this.gui.player.tell(e)}getItemAdded(){return this.slot.item?null:this.gui.entity.getComponent("minecraft:inventory").container.getItem(this.change.slot)}GiveAction(e=this.slot.item.itemStack){this.gui.player.getComponent("minecraft:inventory").container.addItem(e)}TakeAction(e=null){this.gui.player.getComponent("minecraft:inventory").container.addItem(this.slot.item.itemStack),this.gui.page.slots[this.change.slot]=null,e&&e.delete(this.slot.item.components.dbKey)}PageAction(e,n){this.gui.setPage(e,n)}CloseAction(){this.gui.despawn()}SetAction(){this.gui.entity.getComponent("minecraft:inventory").container.setItem(this.change.slot,this.slot.item.itemStack)}async FormAction(e){return this.CloseAction(),await Ut(5),await e.show(this.gui.player)}};var ee=class{static spawnEntity(e){try{return e.dimension.spawnEntity(ce,e.headLocation)}catch{return null}}constructor(e){this.player=e,this.entity=ee.spawnEntity(e),this.entity&&(this.hasChestOpen=!1,this.setPage("home")),this.tickEvent=Jt.events.tick.subscribe(()=>{if(!this.entity)return this.despawn();if(pe.get(this.player))this.hasChestOpen||(this.slotChangeEvent=ue.subscribe({type:ce},(n,o)=>{n.id==this.entity.id&&this.onSlotChange(o)})),this.hasChestOpen=!0;else try{this.entity.teleport(this.player.headLocation,this.player.dimension,this.player.rotation.x,this.player.rotation.y,!0)}catch{this.despawn()}})}setPage(e,n){let o=this.entity.getComponent("inventory").container;for(let i=0;i<o.size;i++)o.setItem(i,w);if(!Object.keys(Q).includes(e))throw new Error(`pageId ${e} does not exist!`);let r=Q[e];this.page=r,r.fillType(this.entity,r,n),this.entity.nameTag="size:54"}onSlotChange(e){let n=this.page.slots[e.slot];if(!n)this.entity.getComponent("inventory").container.setItem(e.slot,w);else if(e.changeType=="delete"){if(n.item&&qt(this.player,e.item),!n.item&&!Wt(this.entity,e.slot))return;n.action(new Ae(this,n,e))}}despawn(){try{this.entity?.triggerEvent("despawn")}catch{}try{delete N[this.player.name]}catch{}this.tickEvent&&Jt.events.tick.unsubscribe(this.tickEvent),this.slotChangeEvent&&ue.unsubscribe(this.slotChangeEvent)}};import{ItemStack as no}from"@minecraft/server";var I=class{constructor(e,n={},o){this.itemType=e,this.components=n,this.setItemStack=o}get itemStack(){if(this.setItemStack)return this.setItemStack;let e=new no(this.itemType);if(this.components){e.amount=this.components?.amount??1,e.data=this.components?.data??0,e.nameTag=this.components?.nameTag,e.setLore(this.components?.loreList??[]);let n=e.getComponent("enchantments").enchantments;for(let o of this.components?.enchantments??[])n.addEnchantment(o);e.getComponent("enchantments").enchantments=n}return e}};function Xt(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let r=0;r<o.size;r++){let i=e.slots[r];if(!i||!i.item){o.setItem(r,w);continue}o.setItem(r,i.item.itemStack)}}var V=class{constructor(e,n=Xt){if(Object.keys(Q).includes(e))throw new Error(`Page: ${e}, Already exists!`);this.id=e,this.fillType=n,this.slots=[],Q[e]=this}setSlots(e,n,o){let r=n?{item:n,action:o}:null;for(let i of e)this.slots[i]=r;return this}};import{MinecraftItemTypes as Zt}from"@minecraft/server";var ns=new V("home").setSlots([22],new I(Zt.enderChest,{nameTag:"\xA7l\xA7bInventory Viewer"}),t=>{t.PageAction("moderation:see")}).setSlots([54],new I(Zt.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});We.events.tick.subscribe(t=>{for(let e of We.getPlayers()){if(Kt(e)?.typeId!=St){N[e.name]&&N[e.name].despawn();continue}Object.keys(N).includes(e?.name)||m(e)=="admin"&&(N[e.name]=new ee(e))}});We.events.beforeDataDrivenEntityTriggerEvent.subscribe(t=>{t.entity instanceof oo&&(t.id=="rubedo:has_container_open"?pe.set(t.entity,!0):t.id=="rubedo:dosent_have_container_open"&&pe.set(t.entity,!1))});x(()=>{let t=Object.values(N).map(e=>e.entity.id);for(let e of k.overworld.getEntities({type:ce}))t.includes(e.id)||e.triggerEvent("despawn")},100);var E={"api.name":()=>"Smelly API","api.error.unknown":()=>"An unknown error has occurred.","api.database.error.table_name":(t,e)=>`The display name ${t} is too long for an objective, it can be at most ${e} characters long`,"api.utilities.formatter.error.ms":t=>`${t} is not a string or a number`,"api.Providers.form.invalidType":(t,e)=>`Type ${t} is not a valid type to add a ${e}`,"api.Providers.form.invalidFormtype":(t,e)=>{`${t}${JSON.stringify(e)}`},"api.ChestGUI.error.pagenotfound":t=>`Page ${t} not found!`,"modules.protections.cps.clickingToFast":()=>"You are clicking to fast! Please click slower!","modules.managers.mute.isMuted":()=>"You are muted and cannot send messages please try again later","modules.commands.ban.reply":(t,e,n="")=>`\xA7cBanned \xA7f"\xA7a${t}\xA7f" \xA7cfor ${e} Because: "${n??"No reason Provided"}" \xA7aSuccessfully`,"lockdown.kick.message":()=>["\xA7cYou have been kicked!","\xA7aReason: \xA7fServer is currently under LockDown","\xA7fServer will be up soon, Try to join later"],"commands.ban.list.player":(t,e,n)=>`- "${t}" Because: ${e}, Expiry ${n}`,"commands.freeze.list.player":(t,e)=>`- "${t}" Because: ${e}`,"commands.mutes.list.player":(t,e,n)=>`- "${t}" Because: ${e}, Expiry: ${n}`,"commands.lockdown.confirm":"Are you sure you want to lockdown the server, this will kick all active players and all players who try to join who are not admin"};var l=class{constructor(e,n,o=0,r){this.data=e;this.type=n;this.depth=o;this.parent=r;e.requires||(e.requires=i=>!0),this.data=e,this.type=n??new F(this.data.name),this.children=[],this.depth=o,this.parent=r,this.callback=null,M.push(this)}argument(e){let n=new l(this.data,e,this.depth+1,this);return this.children.push(n),n}string(e){return this.argument(new ie(e))}int(e){return this.argument(new se(e))}array(e,n){return this.argument(new me(e,n))}boolean(e){return this.argument(new ae(e))}location(e){let n=this.argument(new j(e));return e.endsWith("*")?n:n.location(e+"_y*").location(e+"_z*")}literal(e){let n=new l(e,new F(e.name),this.depth+1,this);return this.children.push(n),n}executes(e){return this.callback=e,this}};import{Player as Qt}from"@minecraft/server";var S=class{constructor(e,n,o="No Reason",r="Rubedo Auto Mod"){let i=e instanceof Qt?e.id:s.ids.get(e);if(!i)throw new Error(`"${e}" does not have a saved id!`);let a={key:i,playerName:e instanceof Qt?e.name:e,date:Date.now(),duration:n?re(n):null,expire:n?re(n)+Date.now():null,reason:o,by:r};s.bans.set(i,a)}};function Je(t,e,n,o,r){if(s.bans.get(s.ids.get(e)))return t.reply(`\xA7c${e} is already banned`);t.reply("\xA7aClose chat to confirm"),be(t.sender,`Are you sure you want to ban ${e}, for ${n??"forever"}`,()=>{new S(e,n,o,t.sender.name),t.reply(E["modules.commands.ban.reply"](e,n,o))})}var Xe=new l({name:"ban",description:"Manage bans",requires:t=>["admin","moderator"].includes(m(t))});Xe.literal({name:"add",description:"Bans a player"}).argument(new f.playerName).executes((t,e)=>{Je(t,e,null,null,t.sender.name)}).argument(new f.duration("duration")).executes((t,e,n)=>{Je(t,e,n,null,t.sender.name)}).string("reason").executes((t,e,n,o)=>{Je(t,e,n,o,t.sender.name)});Xe.literal({name:"remove",description:"unbans a player"}).argument(new f.playerName("playerName")).executes((t,e)=>{let n=s.bans.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not banned`);s.bans.delete(n.key)?t.reply(`\xA7a${e}\xA7r has been Unbanned!`):t.reply(`\xA7cFailed to unban ${e}`)});Xe.literal({name:"list",description:"Lists all bans"}).executes(t=>{let e=s.bans.values();if(e.length==0)return t.sender.tell("\xA7cNo one is banned!");t.sender.tell(`\xA72--- Showing Bans (${e.length}) ---`);for(let n of e)t.sender.tell(E["commands.ban.list.player"](n.playerName,n.reason,n.expire?X(n.duration):"Forever"))});var fe=new l({name:"database",description:"Interacts with SA Database",aliases:["db"],requires:t=>m(t)=="admin"});fe.literal({name:"get"}).string("table").string("key").executes((t,e,n)=>{try{let o=s[e].get(n);o?t.reply(JSON.stringify(o)):t.reply(`No data could be found for key ${n}`)}catch(o){t.reply(o+o.stack)}});fe.literal({name:"set"}).string("table").string("key").string("value").executes((t,e,n,o)=>{try{s[e].set(n,o),t.reply(`Set Key: "${n}", to value: "${o}" on table: "${e}"`)}catch(r){t.reply(r+r.stack)}});fe.literal({name:"clear"}).string("table").executes((t,e)=>{try{s[e].clear(),t.reply(`Cleared Table ${e}`)}catch(n){t.reply(n+n.stack)}});fe.literal({name:"keys",description:"Returns all keys on a database"}).string("table").executes((t,e)=>{try{let n=s[e].keys();t.reply(`Keys on database: ${e}: ${n}`)}catch(n){t.reply(n+n.stack)}});fe.literal({name:"values",description:"Returns all values on a database"}).string("table").executes((t,e)=>{try{let n=s[e].values();t.reply(`Values on database: ${e}: ${JSON.stringify(n,null,2)}`)}catch(n){n instanceof TypeError?t.reply(`No values on database ${e}`):t.reply(n+n.stack)}});new l({name:"ecwipe",description:"Clears a players ender chest",requires:t=>m(t)=="admin"}).argument(new f.player("player")).executes(async(t,e)=>{for(let n=0;n<27;n++)await e.runCommandAsync(`replaceitem entity @s slot.enderchest ${n} air`);t.reply(`Cleared ${e.name} Ender chest!`)});var Pe=class{constructor(e,n="No Reason"){let o={playerName:e.name,key:e.id,reason:n,location:{x:e.location.x,y:e.location.y,z:e.location.z,dimension:e.dimension.id}};s.freezes.set(e.id,o)}};var Ze=new l({name:"freeze",description:"Manage Freezes",requires:t=>["admin","moderator"].includes(m(t))});Ze.literal({name:"add",description:"Freezes a player"}).argument(new f.player("player")).string("reason").executes((t,e,n)=>{new Pe(e,n),t.reply(`\xA7cFroze \xA7f"\xA7a${e.name}\xA7f" Because: "${n}" \xA7aSuccessfully`),t.sender.tell(`\xA7cYou have been frozen by \xA7f"\xA7a${t.sender.name}\xA7f" Because: "${n}"`)});Ze.literal({name:"remove",description:"unfreezes a player"}).argument(new f.playerName("playerName")).executes((t,e)=>{let n=s.freezes.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not frozen`);s.freezes.delete(n.key),t.reply(`\xA7a${e}\xA7r has been UnFrozen!`)});Ze.literal({name:"list",description:"Lists all freezes"}).executes(t=>{let e=s.freezes.values();if(e.length==0)return t.sender.tell("\xA7cNo one is frozen!");t.sender.tell(`\xA72--- Showing Freezes (${e.length}) ---`);for(let n of e)t.sender.tell(E["commands.freeze.list.player"](n.playerName,n.reason))});var Qe=class{constructor(e){this.name=e;this.typeName="CommandName"}matches(e){return{success:Boolean(M.find(n=>n.depth==0&&n.data.name==e)),value:e}}fail(e){return`"${e}" is not a valid command`}};function ro(t,e,n){n.tell(`${v}${t.data.name} ${e.map(o=>o.type.typeName=="literal"?o.data.name:`<${o.type.name}: ${o.type.typeName}>`).join(" ")}`)}function xe(t,e,n,o){if(!!e.data?.requires(o)&&(e.callback&&ro(t,e.depth==0?n:n.concat(e),o),e.children.length>0))for(let r of e.children)xe(t,r,e.depth==0?n:n.concat(e),o)}function en(t,e,n){t.tell(`\xA72--- Showing help page ${e} of ${n} (${v}help <page: int>) ---`)}function tn(t){let e=M.filter(n=>n.depth==0&&n.data?.requires(t));return e.length==0?0:Math.ceil(e.length/5)}var nn=new l({name:"help",description:"Provides help/list of commands.",aliases:["?","h"]}).executes(t=>{let e=tn(t.sender),n=M.filter(o=>o.depth==0&&o.data?.requires(t.sender)).slice(1*5-5,1*5);en(t.sender,1,e);for(let o of n)xe(o,o,[],t.sender)});nn.int("page").executes((t,e)=>{let n=tn(t.sender);e>n&&(e=n);let o=M.filter(r=>r.depth==0&&r.data?.requires(t.sender)).slice(e*5-5,e*5);en(t.sender,e,n);for(let r of o)xe(r,r,[],t.sender)});nn.argument(new Qe("command")).executes((t,e)=>{let n=M.filter(o=>o.depth==0&&o.data.name==e)[0];t.sender.tell(`\xA7e${n.data.name}: ${n.data.aliases?`aliases (${n.data.aliases.join(", ")})`:""}`),t.sender.tell(`\xA7e${n.data.description}`),t.sender.tell("Usage:"),xe(n,n,[],t.sender)});import{world as on}from"@minecraft/server";new l({name:"lockdown",description:"Toggles the servers lockdown, meaning no one can join",requires:t=>m(t)=="admin"}).executes(t=>{Se()?(Ye(!1),t.sender.tell("Unlocked the server!")):(t.reply("\xA7aClose chat to confirm lockdown"),be(t.sender,E["commands.lockdown.confirm"],()=>{Ye(!0);for(let e of on.getPlayers())m(e)!="admin"&&R(e,E["lockdown.kick.message"]());on.say("\xA7l\xA7cServer is now LOCKED!")}))});var L=class{static getMuteData(e){return s.mutes.get(e.name)}constructor(e,n,o="No Reason",r="Rubedo Auto Mod"){let i=n?re(n):null,a={playerName:e.name,date:Date.now(),duration:i,expire:i?i+Date.now():null,reason:o,by:r};s.mutes.set(e.name,a)}};var et=new l({name:"mute",description:"Manage Mutes",requires:t=>["admin","moderator"].includes(m(t))});et.literal({name:"add",description:"Mutes a player"}).argument(new f.player("player")).argument(new f.duration("duration")).string("reason").executes((t,e,n,o)=>{new L(e,n,o,t.sender.name),t.reply(`\xA7cMuted \xA7f"\xA7a${e.name}\xA7f" \xA7cfor ${n} Because: "${o}" \xA7aSuccessfully`),e.tell(`\xA7cYou have been muted by \xA7f"${t.sender.name}" \xA7cfor ${n} Because: "${o}"`)});et.literal({name:"remove",description:"unmutes a player"}).argument(new f.playerName("playerName")).executes((t,e)=>{let n=s.mutes.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not muted!`);s.mutes.delete(n.playerName);try{t.sender.runCommandAsync(`ability "${e}" mute false`)}catch{}t.reply(`\xA7a${e}\xA7r has been UnMuted!`)});et.literal({name:"list",description:"Lists all feeezes"}).executes(t=>{let e=s.mutes.values();if(e.length==0)return t.sender.tell("\xA7cNo one is muted!");t.sender.tell(`\xA72--- Showing Mutes (${e.length}) ---`);for(let n of e)t.sender.tell(E["commands.mutes.list.player"](n.playerName,n.reason,n.expire?X(n.expire):"Forever"))});import{Location as io}from"@minecraft/server";var te=class{static isVaild(e){return e.typeId!="minecraft:npc"?!1:Ne.find(n=>n==e.location)?!0:!!s.npcs.keys().find(n=>e.id==n)}constructor(e,n){Ne.push(e);let o=n.spawnEntity("minecraft:npc",e),r={dimension:o.dimension.id,x:o.location.x,y:o.location.y,z:o.location.z};s.npcs.set(o.id,r),rn()}};new l({name:"npc",description:"Spawns a npc at your coordinates",requires:t=>m(t)=="admin"}).executes(t=>{let{x:e,y:n,z:o}=t.sender.location;new te(new io(e,n,o),t.sender.dimension),t.reply("Spawned a verifed npc at your current location")});import{world as sn}from"@minecraft/server";new l({name:"ping",description:"Returns the current TPS of the servers ping"}).executes(t=>{let e=sn.events.tick.subscribe(({deltaTime:n})=>{t.reply(`Pong! Current TPS: ${1/n}`),sn.events.tick.unsubscribe(e)})});import{BlockLocation as ge}from"@minecraft/server";var ye=new l({name:"region",description:"Create a Region",requires:t=>m(t)=="admin"});ye.literal({name:"add",description:"Adds a new protection region"}).int("from_x").int("from_z").int("to_x").int("to_z").executes((t,e,n,o,r)=>{new h({x:e,z:n},{x:o,z:r},t.sender.dimension.id),t.reply(`Created Region From ${e} -64 ${n} ${o} 320 ${r}`)});ye.literal({name:"remove",description:"Removes a region at the players current postion"}).executes(t=>{let e=new ge(t.sender.location.x,t.sender.location.y,t.sender.location.z);h.removeRegionAtBlockLocation(e,t.sender.dimension.id)?t.reply(`Removed Region at ${e.x} ${e.y} ${e.z}`):t.reply(`Failed to find/remove region at ${e.x} ${e.y} ${e.z}`)});ye.literal({name:"removeAll",description:"Removes all regions"}).executes(t=>{h.getAllRegions().forEach(e=>e.delete()),t.reply("Removed All regions")});ye.literal({name:"list",description:"Lists all regions and positions"}).executes(t=>{let e=h.getAllRegions();for(let n of e)t.reply(`Region from ${n.from.x}, ${n.from.z} to ${n.to.x}, ${n.to.z} in dimension ${n.dimensionId}`);if(e.length==0)return t.reply("No regions have been made yet")});var tt=ye.literal({name:"permission",description:"Handels permissions for regions"});tt.literal({name:"set",description:"Sets a certin permission on the region the player is currently in to a value"}).array("key",["doorsAndSwitches","openContainers","pvp"]).boolean("value").executes((t,e,n)=>{let o=h.blockLocationInRegion(new ge(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!o)return t.reply("You are not in a region");o.changePermission(e,n),t.reply(`Changed permision ${e} to ${n}`)});tt.literal({name:"list",description:"Lists the permissions for the current region"}).executes(t=>{let e=h.blockLocationInRegion(new ge(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!e)return t.reply("You are not in a region");t.reply(`Current region permissions ${JSON.stringify(e.permissions)}`)});var an=tt.literal({name:"entities",description:"Holds the subCommands for adding or removing allowedEntitys"});an.literal({name:"add",description:"Adds a entity to the allowed entitys list"}).string("entity").executes((t,e)=>{let n=h.blockLocationInRegion(new ge(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let o=n.permissions.allowedEntitys;o.push(e),n.changePermission("allowedEntitys",o),t.reply(`Added entity ${e} to the allowed entitys of the region your currently standing in`)});an.literal({name:"remove",description:"Removes a entity from the allowed entitys in the region"}).string("entity").executes((t,e)=>{let n=h.blockLocationInRegion(new ge(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let o=n.permissions.allowedEntitys;if(!o.includes(e))return t.reply(`The entity ${e} is not allowed to enter the region`);o=o.filter(r=>r!=e),n.changePermission("allowedEntitys",o),t.reply(`Removed entity ${e} to the allowed entitys of the region your currently standing in`)});var nt=(r=>(r[r.member=0]="member",r[r.admin=1]="admin",r[r.moderator=2]="moderator",r[r.builder=3]="builder",r))(nt||{});var so=t=>isNaN(Number(t))===!1;function ao(t){return Object.keys(t).filter(so).map(e=>t[e])}var ot=new l({name:"role",description:"Changes the role for a player",requires:t=>m(t)=="admin"||ve(t)});ot.literal({name:"set",description:"Sets the role for a player"}).argument(new f.playerName("playerName")).argument(new f.array("role",ao(nt))).executes((t,e,n)=>{Z(e,n),t.reply(`Changed role of ${e} to ${n}`)});ot.literal({name:"get",description:"Gets the role of a player"}).argument(new f.playerName("playerName")).executes((t,e)=>{t.reply(`${e} has role: ${m(e)}`)});var mn=ot.literal({name:"owner",description:"Manages the owner"});mn.literal({name:"get",description:"Gets the owner of the world"}).executes(t=>{let e=Ft(),n=s.ids.getCollection(),o=Object.keys(n).find(r=>n[r]===e);t.reply(`\xA7aServer Owner: ${o} (id: ${e})`)});mn.literal({name:"transfer",description:"Transfers the owner of the world",requires:t=>ve(t)}).argument(new f.player).executes((t,e)=>{Ee(e),t.reply(`\xA7aSet the server Owner to: ${e.name} (id: ${e.id})`)});import{ActionFormData as mo}from"@minecraft/server-ui";var G=class{constructor(e,n){this.title=e,this.body=n,this.form=new mo,e&&this.form.title(e),n&&this.form.body(n),this.buttons=[],this.triedToShow=0}addButton(e,n=null,o){return this.buttons.push({text:e,iconPath:n,callback:o}),this.form.button(e,n),this}show(e){this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e)}return}this.buttons[n.selection].callback?.()})}};import{MinecraftBlockTypes as lo}from"@minecraft/server";import{ModalFormData as co}from"@minecraft/server-ui";var Be=class{constructor(e,n,o){this.form=e,this.player=n,this.callback=o}error(e){new q("Error",e).setButton1("Return to form",()=>{this.form.show(this.player,this.callback)}).setButton2("Cancel",null).show(this.player)}};var A=class{constructor(e){this.title=e,this.form=new co,e&&this.form.title(e),this.args=[],this.triedToShow=0}addDropdown(e,n,o){return this.args.push({type:"dropdown",options:n}),this.form.dropdown(e,n,o),this}addSlider(e,n,o,r,i){return this.args.push({type:"slider"}),this.form.slider(e,n,o,r,i),this}addToggle(e,n){return this.args.push({type:"toggle"}),this.form.toggle(e,n),this}addTextField(e,n,o){return this.args.push({type:"textField"}),this.form.textField(e,n,o),this}show(e,n){this.form.show(e).then(o=>{if(o.canceled){if(o.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e,n)}return}n(new Be(this,e,n),...o.formValues.map((r,i)=>this.args[i].type=="dropdown"?this.args[i].options[r]:r))})}};function cn(t){new G("Remove a Banned Item").addButton("Remove a Banned Item",null,()=>{uo(t)}).addButton("Ban an item",null,()=>{po(t)}).show(t)}function uo(t){new A("Remove Banned Items").addDropdown("Select item to remove",p("banned_items")).show(t,(e,n)=>{let o=p("banned_items");o=o.filter(r=>r!=n),P("banned_items",o),t.tell(`Removed Banned item "${n}"`)})}function po(t){new A("Add Banned Items").addTextField("Item Id","minecraft:string").show(t,(e,n)=>{let o=p("banned_items");if(o.includes(n))return e.error(`\xA7cItem "${n}" is already banned`);o.push(n),P("banned_items",o),t.tell(`Banned the item "${n}"`)})}function ln(t){new A("Manage Banned Blocks").addDropdown("Add/Remove Block",["add","remove"],0).addTextField("Block Id","minecraft:barrier").show(t,(e,n,o)=>{if(!lo.get(o)?.id)return e.error(`\xA7c"${o}" is not a valid block id, note: this item must be either a block in a behavior pack or a default minecraft block`);if(n=="add"){let r=p("banned_blocks");if(r.includes(o))return e.error(`\xA7cBlock "${o}" is already banned`);r.push(o),P("banned_blocks",r),t.tell(`Banned the block "${o}"`)}else{let r=p("banned_blocks");if(!r.includes(o))return e.error(`block: "${o}" is not banned`);r=r.filter(i=>i!=o),P("banned_blocks",r),t.tell(`Removed Banned block "${o}"`)}})}function dn(t){new A("Manage Enchantment Levels").addDropdown("Enchantment to change",Object.keys(we),0).addTextField("Level (number)","5").show(t,(e,n,o)=>{if(isNaN(o))return e.error(`\xA7c"${o}" is not a number, please enter a value like, "3", "9", etc.`);let r=parseInt(o),i=p("enchantments");i[n]=r,P("enchantments",i),t.tell(`Set max level for ${n} to ${r}`)})}function un(t){new A("Manage Appeal Link").addTextField("Appeal Link",Te).show(t,(e,n)=>{P("appealLink",n),t.tell(`Changed the servers appeal link to ${n}`)})}function pn(t){new G("Rubedo Settings").addButton("Anti Spam","textures/ui/permissions_op_crown.png",()=>{go(t)}).addButton("Cbe","textures/blocks/sculk_shrieker_top.png",()=>{yo(t)}).addButton("Gamemode","textures/blocks/barrier.png",()=>{ho(t)}).addButton("Nuker","textures/ui/Feedback.png",()=>{bo(t)}).show(t)}function go(t){let e=p("spam_config");new A("Manage Spam Protection").addToggle("Ban Repeated Messages",e.repeatedMessages).addToggle("Ban Zalgo",e.zalgo).addSlider("Violation Count before ban (if ban is false this does nothing)",0,20,1,e.violationCount).addToggle("Perm Mute Player",e.permMutePlayer).show(t,(n,o,r,i,a)=>{P("spam_config",{repeatedMessages:o,zalgo:r,violationCount:i,permMutePlayer:a}),t.tell("Updated Spam Protection settings!")})}function yo(t){let e=p("cbe_config");new A("Manage CBE Protection").addToggle("Clear Item",e.clearItem).addSlider("Violation Count before ban (if ban is false this does nothing)",0,20,1,e.violationCount).addToggle("Ban Player",e.banPlayer).addToggle("Allow non-enchantable items to be enchanted",e.banPlayer).show(t,(n,o,r,i,a)=>{P("cbe_config",{clearItem:o,violationCount:r,banPlayer:i,canAddEnchantment:a}),t.tell("Updated CBE Protection settings!")})}function ho(t){let e=p("gamemode_config");new A("Manage Gamemode Protection").addToggle("Set to survival",e.setToSurvival).addToggle("Clear Player (Once this players gamemode has been switched back to survival should it clear the inventory?)",e.clearPlayer).addSlider("Violation Count before ban (if ban is false this does nothing)",0,20,1,e.violationCount).addToggle("Ban Player",e.banPlayer).show(t,(n,o,r,i,a)=>{P("gamemode_config",{setToSurvival:o,clearPlayer:r,violationCount:i,banPlayer:a}),t.tell("Updated Gamemode Protection settings!")})}function bo(t){let e=p("nuker_data");new A("Manage Nuker Protection").addSlider("Violation Count before ban (if ban is false this does nothing)",0,20,1,e.violationCount).addToggle("Ban Player",e.banPlayer).show(t,(n,o,r)=>{P("nuker_data",{violationCount:o,banPlayer:r}),t.tell("Updated Nuker Protection settings!")})}function fn(t){new G("Rubedo Settings").addButton("Auto Mod","textures/ui/permissions_op_crown.png",()=>{pn(t)}).addButton("Banned items","textures/blocks/sculk_shrieker_top.png",()=>{cn(t)}).addButton("Banned blocks","textures/blocks/barrier.png",()=>{ln(t)}).addButton("Enchantments","textures/items/book_enchanted.png",()=>{dn(t)}).addButton("Appeal Link","textures/ui/Feedback.png",()=>{un(t)}).show(t)}new l({name:"settings",description:"Opens up the settings menu for the player",requires:t=>["admin","moderator"].includes(m(t))}).executes(t=>{fn(t.sender),t.sender.tell("\xA7aForm request sent, close chat to continue!")});import{world as gn}from"@minecraft/server";function yn(t,e){if(t.hasTag("spectator")){if(t.runCommandAsync("gamemode c"),t.triggerEvent("removeSpectator"),t.removeTag("spectator"),!e)return;gn.say({rawtext:[{translate:"multiplayer.player.joined",with:[`\xA7e${t.name}`]}]})}else{if(t.runCommandAsync("gamemode spectator"),t.triggerEvent("addSpectator"),t.addTag("spectator"),!e)return;gn.say({rawtext:[{translate:"multiplayer.player.left",with:[`\xA7e${t.name}`]}]})}}new l({name:"vanish",description:"Toggles Vanish Mode on the sender",requires:t=>m(t)=="admin"}).executes(t=>{yn(t.sender,!1)}).boolean("say").executes((t,e)=>{yn(t.sender,e)});new l({name:"version",description:"Get Current Version",aliases:["v"]}).executes(t=>{t.reply(`Current Rubedo Version: ${$t}`)});new l({name:"kick",description:"Kicks a player from the game",requires:t=>m(t)=="admin"}).argument(new f.player).string("reason").executes((t,e,n)=>{R(e,[n]),t.reply(`\xA7aKicked ${e.name} from world`)});var Y=class{constructor(e){this.data=e,console.warn(`[LOG]: ${e.message}`),s.logs.set(Date.now().toString(),e)}};function rt(t){var e=6e4,n=e*60,o=n*24,r=o*30,i=o*365,a=Date.now()-t;return a<e?Math.round(a/1e3)+" seconds ago":a<n?Math.round(a/e)+" minutes ago":a<o?Math.round(a/n)+" hours ago":a<r?"approximately "+Math.round(a/o)+" days ago":a<i?"approximately "+Math.round(a/r)+" months ago":"approximately "+Math.round(a/i)+" years ago"}var he=new l({name:"log",description:"Manages the log command",requires:t=>m(t)=="admin"});he.literal({name:"add",description:"Adds a new log"}).string("message").executes((t,e)=>{new Y({message:e}),t.reply(`\xA7aAdded new log: ${e}`)});he.literal({name:"getAll",description:"Gets all logs sorted in decending"}).int("page").array("order",["ascending","descending"]).executes((t,e,n)=>{let o=Object.entries(s.logs.getCollection()).sort((i,a)=>n=="ascending"?parseInt(a[0])-parseInt(i[0]):parseInt(i[0])-parseInt(a[0]));if(o.length==0)return t.reply("\xA7cNo Logs have been made!");let r=Math.ceil(o.length/8);e>r&&(e=r),t.reply(`\xA72--- Showing logs page ${e} of ${r} (${v}log getAll <page: int>) ---`);for(let[i,a]of o.slice(e*8-8,e*8))t.reply(`${rt(parseInt(i))}: ${a.message}`)});he.literal({name:"getPlayersLogs",description:"Gets all logs associated with a player"}).argument(new f.playerName).int("page").array("order",["ascending","descending"]).executes((t,e,n,o)=>{let r=Object.entries(s.logs.getCollection()).filter(a=>a[1].playerName==e).sort((a,c)=>o=="ascending"?parseInt(c[0])-parseInt(a[0]):parseInt(a[0])-parseInt(c[0]));if(r.length==0)return t.reply(`\xA7cNo Logs exists for "${e}"!`);let i=Math.ceil(r.length/8);n>i&&(n=i),t.reply(`\xA72--- Showing logs for "${e}" page ${n} of ${i} ---`);for(let[a,c]of r.slice(n*8-8,n*8))t.reply(`${rt(parseInt(a))}: ${c.message}`)});he.literal({name:"getProtectionLogs",description:"Gets all logs associated with a protection"}).string("protection").int("page").array("order",["ascending","descending"]).executes((t,e,n,o)=>{let r=Object.entries(s.logs.getCollection()).filter(a=>a[1].protection==e).sort((a,c)=>o=="ascending"?parseInt(c[0])-parseInt(a[0]):parseInt(a[0])-parseInt(c[0]));if(r.length==0)return t.reply(`\xA7cNo Logs exists for protection: "${e}"!`);let i=Math.ceil(r.length/8);n>i&&(n=i),t.reply(`\xA72--- Showing logs for Protection: "${e}" page ${n} of ${i} ---`);for(let[a,c]of r.slice(n*8-8,n*8))t.reply(`${rt(parseInt(a))}: ${c.message}`)});he.literal({name:"clearAll",description:"Clears all logs"}).executes(t=>{s.logs.clear(),t.reply("\xA7aCleared All logs!")});var Io=new l({name:"teleport",description:"Teleports entities (players, mobs, etc.).",aliases:["tp"],requires:t=>m(t)=="admin"});Io.argument(new f.player).location("destination").executes((t,e,n)=>{e.addTag("skip-movement-check"),e.teleport(n,e.dimension,0,0),t.reply(`Teleported ${e.name} to ${n.x} ${n.y} ${n.z}`)});_(t=>{try{let e=s.bans.get(t.id);if(!e)return;if(e.expire&&e.expire<Date.now())return s.bans.delete(t.id);R(t,["\xA7cYou have been banned!",`\xA7aReason: \xA7f${e.reason}`,`\xA7fExpiry: \xA7b${e.expire?X(e.expire-Date.now()):"Forever"}`,`\xA7fAppeal at: \xA7b${p("appealLink")}`],()=>{console.warn(new Error("Failed to kick player")),s.bans.delete(t.id)})}catch(e){console.warn(e+e.stack)}},20);import{Location as Co}from"@minecraft/server";_(t=>{let e=s.freezes.get(t.id);!e||t.teleport(new Co(e.location.x,e.location.y,e.location.z),k[e.location.dimension],0,0)},20);import{world as wo}from"@minecraft/server";var it={};wo.events.beforeChat.subscribe(t=>{if(!t.message.startsWith(v))for(let e of Object.values(it))e.callback(t)});var Re=class{static subscribe(e){let n=Date.now();return it[n]={callback:e},n}static unsubscribe(e){delete it[e]}};Re.subscribe(t=>{let e=L.getMuteData(t.sender);if(!!e){if(e.expire&&e.expire<Date.now())return s.mutes.delete(t.sender.name);t.cancel=!0,t.sender.tell(E["modules.managers.mute.isMuted"]())}});import{BlockLocation as To,world as st}from"@minecraft/server";x(()=>{Ie()},6e3);st.events.beforeItemUseOn.subscribe(t=>{if(["moderator","admin"].includes(m(t.source)))return;let e=h.blockLocationInRegion(t.blockLocation,t.source.dimension.id);if(!e)return;let n=t.source.dimension.getBlock(t.blockLocation);Pt.includes(n.typeId)&&e.permissions.doorsAndSwitches||xt.includes(n.typeId)&&e.permissions.openContainers||(t.cancel=!0)});st.events.beforeExplosion.subscribe(t=>{for(let e=0;e<t.impactedBlocks.length;e++){let n=t.impactedBlocks[e];if(h.blockLocationInRegion(n,t.dimension.id))return t.cancel=!0}});st.events.entityCreate.subscribe(t=>{let e=h.blockLocationInRegion(new To(t.entity.location.x,t.entity.location.y,t.entity.location.z),t.entity.dimension.id);!e||e.permissions.allowedEntitys.includes(t.entity.typeId)||(t.entity.teleport({x:0,y:-64,z:0},t.entity.dimension,0,0),t.entity.kill())});x(()=>{for(let t of h.getAllRegions())for(let e of k[t.dimensionId].getEntities({excludeTypes:t.permissions.allowedEntitys}))!t.entityInRegion(e)||(e.teleport({x:0,y:-64,z:0},e.dimension,0,0),e.kill())},100);_(t=>{for(let e of h.getAllRegions())e.entityInRegion(t)?(t.addTag("inRegion"),e.permissions.pvp||t.addTag("region-protected")):(t.removeTag("inRegion"),t.removeTag("region-protected"))},5);import{world as at}from"@minecraft/server";at.events.playerJoin.subscribe(({player:t})=>{if(Se()&&m(t)!="admin")return R(t,E["lockdown.kick.message"]());let e=at.events.tick.subscribe(async n=>{try{await k.overworld.runCommandAsync(`testfor @a[name="${t.name}"]`),at.events.tick.unsubscribe(e),L.getMuteData(t)&&t.runCommandAsync("ability @s mute true"),s.ids.has(t.name)?t.addTag("old"):s.ids.set(t.name,t.id);let o=D.getPlayersRoleToSet(t.name);o&&Z(t,o)}catch{}})});import{Items as vo,MinecraftItemTypes as O,world as mt}from"@minecraft/server";var hn=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],Eo=[10,11,12,13,14,15,16,19,20,21,22,23,24,25,28,29,30,31,32,33,34,37,38,39,40,41,42,43];function So(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let r=0;r<o.size;r++){let i=e.slots[r];if(!i||!i.item){o.setItem(r,w);continue}o.setItem(r,i.item.itemStack)}for(let[r,i]of[...mt.getPlayers()].entries()){let a=hn[r],c=new I(O.skull,{nameTag:i.name,data:3});o.setItem(a,c.itemStack),e.slots[a]={item:c,action:d=>{d.PageAction("moderation:see_inventory",{name:i.name})}}}}function Ao(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let d=0;d<o.size;d++){let y=e.slots[d];if(!y||!y.item){o.setItem(d,w);continue}o.setItem(d,y.item.itemStack)}let r=new I(O.enderChest,{nameTag:`\xA7eView \xA7f${n?.name}\xA7e Ender Chest
\xA7fNote: \xA7cThis will not grab \xA7lANY NBT!\xA7r`});o.setItem(49,r.itemStack),e.slots[49]={item:r,action:d=>{d.PageAction("moderation:see_ender_chest",{name:n.name})}};let i=[...mt.getPlayers()].find(d=>d.name==n.name);i||(Object.values(N).find(y=>y.entity.id==t.id).despawn(),i.tell(`"${n.name}" Could not be found, Gui Crashed`));let a=i.getComponent("inventory").container,c=0;for(let d=0;d<a.size;d++){let y=a.getItem(d),C=hn[c];if(c++,!y){o.setItem(C,w);continue}o.setItem(C,y),e.slots[C]={item:new I(vo.get(y.typeId),{amount:y.amount,data:y.data},y),action:async $n=>{d<9?await i.runCommandAsync(`replaceitem entity @s slot.hotbar ${d} air`):await i.runCommandAsync(`replaceitem entity @s slot.inventory ${d-9} air`),$n.GiveAction(),e.slots[C]={item:null,action:On=>{a.addItem(On.getItemAdded())}}}}}}async function Po(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let c=0;c<o.size;c++){let d=e.slots[c];if(!d||!d.item){o.setItem(c,w);continue}o.setItem(c,d.item.itemStack)}let r=[...mt.getPlayers()].find(c=>c.name==n?.name);r||(Object.values(N).find(d=>d.entity.id==t.id).despawn(),r.tell(`"${n.name}" Could not be found, Gui Crashed`));let i=0,a=Object.values(O);for(let c of a)try{await r.runCommandAsync(`testfor @s[hasitem={item=${c.id},location=slot.enderchest}]`);let d=new I(c,{nameTag:"Note: \xA7l\xA7cThis is not the exzact item"}),y=Eo[i];o.setItem(y,d.itemStack),e.slots[y]={item:d,action:C=>{C.GiveAction(),e.slots[y]=null}},i++}catch{}}new V("moderation:see",So).setSlots([50],new I(O.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("home")}).setSlots([48],new I(O.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});new V("moderation:see_inventory",Ao).setSlots([50],new I(O.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("moderation:see")}).setSlots([48],new I(O.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});new V("moderation:see_ender_chest",Po).setSlots([50],new I(O.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("moderation:see")}).setSlots([48],new I(O.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});import{world as ct,Player as bn,MinecraftBlockTypes as xo}from"@minecraft/server";var No=["minecraft:command_block_minecart","minecraft:npc"];ct.events.entityCreate.subscribe(({entity:t})=>{let e=()=>{try{t.triggerEvent("despawn"),t.kill()}catch{t.kill()}};if(No.includes(t.typeId)||t.typeId=="minecraft:npc"&&!te.isVaild(t))return e()});ct.events.beforeItemUseOn.subscribe(t=>{if(!(t.source instanceof bn)||["moderator","admin"].includes(m(t.source)))return;if(Mt.includes(t.item.typeId)){t.cancel=!0;return}!p("banned_blocks").includes(t.item.typeId)||(t.cancel=!0,new S(t.source,null,"Placing Banned Blocks"))});ct.events.beforeItemUseOn.subscribe(t=>{!(t.source instanceof bn)||!t.item.typeId.endsWith("spawn_egg")||["admin","moderator"].includes(m(t.source))||t.source.dimension.getBlock(t.blockLocation).typeId==xo.mobSpawner.id||(t.cancel=!0,t.source.tell("\xA7c[Rubedo]: You cannot place spawnEggs on the floor!"),t.source.playSound("note.bass"))});var lt=32e4;_(t=>{(Math.abs(t.location.x)>lt||Math.abs(t.location.y)>lt||Math.abs(t.location.z)>lt)&&new S(t,null,"Crasher detected")});import{GameMode as Bo,world as Ro}from"@minecraft/server";var _o=Bo.creative,kn=new b;x(()=>{let t=p("gamemode_config");for(let e of Ro.getPlayers({gameMode:_o})){if(["moderator","admin","builder"].includes(m(e)))continue;try{t.setToSurvival&&e.runCommandAsync("gamemode s"),t.clearPlayer&&e.runCommandAsync("clear @s")}catch{}let n=(kn.get(e)??0)+1;kn.set(e,n),t.banPlayer&&n>=t.violationCount&&new S(e,null,"Illegal Gamemode")}},20);import{world as In}from"@minecraft/server";var Lo="\xA7c\xA7k\xA7m\xA7A\xA7r\xA7cToolbox Gamer\xA7k\xA7mA\xA7r";In.events.playerJoin.subscribe(({player:t})=>{let e=()=>R(t,["\xA7cYou have been kicked!",`\xA7aReason: \xA7f'${t.name}' is Detected for nameSpoof`,"\xA7fThis Server requires you to have a valid gamertag!"]);if(!/^([a-zA-Z0-9]|\_| )+$/gm.test(t.name)||t.name==Lo||[...In.getPlayers()].filter(n=>n.name==t.name).length>1||(s.ids.get(t.name)??t.id)!=t.id||t.name.includes("\xA7"))return e()});import{world as Do,Location as $o}from"@minecraft/server";import{world as Mo}from"@minecraft/server";var _e=class{constructor(e){this.emptySlotsCount=e.emptySlotsCount,this.size=e.size,this.items=[];for(let n=0;n<this.size;n++)this.items[n]=e.getItem(n)}load(e){for(let n=0;n<e.size;n++)!this.items[n]||e.setItem(n,this.items[n])}};var Le={};x(()=>{Le={};for(let t of Mo.getPlayers()){if(t.dimension.id!="minecraft:overworld")continue;let e=It(t.location),n=e.offset(U.x,U.y,U.z),o=e.offset(-U.x,-U.y,-U.z);for(let r of n.blocksBetween(o)){if(r.y<-64)continue;let i=t.dimension.getBlock(r);!i||!Ce.includes(i.typeId)||(Le[JSON.stringify(r)]=new _e(i.getComponent("inventory").container))}}},100);var dt={};Do.events.blockBreak.subscribe(t=>{for(let e of Object.values(dt))e.callback(new ut(t.block,t.brokenBlockPermutation,t.dimension,t.player))});var Me=class{static subscribe(e){let n=Date.now();return dt[n]={callback:e},n}static unsubscribe(e){delete dt[e]}},ut=class{constructor(e,n,o,r){this.block=e;this.brokenBlockPermutation=n;this.dimension=o;this.player=r;this.block=e,this.brokenBlockPermutation=n,this.dimension=o,this.player=r}set cancel(e){if(this.dimension.getBlock(this.block.location).setPermutation(this.brokenBlockPermutation.clone()),Ce.includes(this.brokenBlockPermutation.type.id)){let n=Le[JSON.stringify(this.block.location)];n&&n.load(this.block.getComponent("inventory").container)}Ke(()=>{[...this.dimension.getEntities({maxDistance:2,type:"minecraft:item",location:new $o(this.block.location.x,this.block.location.y,this.block.location.z)})].forEach(n=>n.kill())},0)}};var Cn=new b,Oo=15,Fo=["snow","lush_plants_replaceable","azalea_log_replaceable","minecraft:crop","fertilize_area"],zo=["minecraft:water","minecraft:flowing_water","minecraft:lava","minecraft:flowing_lava","minecraft:bedrock"],wn=new b;Me.subscribe(t=>{if(["moderator","admin"].includes(m(t.player))||t.block.getTags().some(n=>Fo.includes(n)))return;let e=Cn.get(t.player);if(Cn.set(t.player,Date.now()),!!e){if(!zo.includes(t.block.typeId)){if(e<Date.now()-Oo)return;let n=p("nuker_data"),o=(wn.get(t.player)??0)+1;wn.set(t.player,o),n.banPlayer&&o>=n.violationCount&&new S(t.player,null,"Using Nuker")}t.cancel=!0}});import{world as Vo}from"@minecraft/server";var Tn=new b,vn=new b;Vo.events.beforeChat.subscribe(t=>{if(t.message.startsWith(v)||["admin","moderator"].includes(m(t.sender)))return;let e=p("spam_config"),n=()=>{let o=(vn.get(t.sender)??0)+1;vn.set(t.sender,o),e.permMutePlayer&&o>=e.violationCount&&new L(t.sender,null,"Spamming")};if(e.repeatedMessages&&Tn.get(t.sender)==t.message)return t.cancel=!0,n(),t.sender.tell("\xA7cRepeated message detected!");if(e.zalgo&&/%CC%/g.test(encodeURIComponent(t.message)))return t.cancel=!0,n(),t.sender.tell("\xA7cYou message contains some type of zalgo and cannot be sent!");Tn.set(t.sender,t.message)});var En=new b;function De(t,e){let n=t.getComponent("inventory").container,o=n.getItem(e),r=p("cbe_config");if(r.clearItem&&n.setItem(e,w),new Y({playerName:t.name,message:`${t.name} Has obtained a unobtainable item: ${o.typeId}`,protection:"unobtainable"}),!r.banPlayer)return;let i=(En.get(t)??0)+1;En.set(t,i),!(i<r.violationCount)&&new S(t,null,"Possession of Unobtainable item")}_(t=>{let e=p("banned_items"),n=t.getComponent("inventory").container;for(let o=0;o<n.size;o++){let r=n.getItem(o);if(!r)continue;if(e.includes(r.typeId))return De(t,o);if(_t.includes(r.typeId))return new Y({playerName:t.name,message:`${t.name} Has obtained a Forbidden item: ${r.typeId}`,protection:"unobtainable"}),n.setItem(o,w);let i=[];for(let a of r.getComponent("enchantments").enchantments){let c=Vt(a);if(a.level>c)return De(t,o);if(a.level<1||i.includes(a.type.id))return De(t,1);i.push(a.type.id)}}});import{MinecraftBlockTypes as T,MinecraftEntityTypes as Go,MinecraftItemTypes as H,Player as Ho,world as Sn}from"@minecraft/server";var jo=[T.chest.id,T.trappedChest.id,T.barrel.id,T.dispenser.id,T.dropper.id,T.furnace.id,T.litFurnace.id,T.blastFurnace.id,T.litBlastFurnace.id,T.smoker.id,T.litSmoker.id,T.hopper.id,T.beehive.id,T.beeNest.id,T.mobSpawner.id],Uo=[H.chestBoat.id,H.oakChestBoat.id,H.birchChestBoat.id,H.acaciaChestBoat.id,H.jungleChestBoat.id,H.spruceChestBoat.id,H.darkOakChestBoat.id,H.mangroveChestBoat.id];Sn.events.blockPlace.subscribe(async({player:t,block:e})=>{if(!jo.includes(e.typeId))return;let n=e.permutation;await e.dimension.runCommandAsync(`setblock ${e.x} ${e.y} ${e.z} ${e.typeId}`),e.setPermutation(n)});Sn.events.beforeItemUseOn.subscribe(t=>{t.source instanceof Ho&&(!Uo.includes(t.item.typeId)||(t.cancel=!0,t.source.dimension.spawnEntity(Go.chestBoat.id,t.blockLocation.above()),Gt(t.source)!="creative"&&t.source.getComponent("inventory").container.setItem(t.source.selectedSlot,w)))});import{MinecraftEffectTypes as qo,MinecraftItemTypes as Ln,Player as gt,world as yt}from"@minecraft/server";import{world as An}from"@minecraft/server";var pt={};function Yo(t,e){return!(t.x!=e.x||t.y!=e.y||t.z!=e.z)}var ft=new b;An.events.tick.subscribe(t=>{let e=(n,o)=>{for(let r of Object.values(pt))r.callback(n,o)};for(let n of An.getPlayers()){let o=ft.get(n);o&&Yo(n.location,o.location)||(ft.set(n,{location:n.location,dimension:n.dimension,tickSet:t.currentTick}),o&&e(n,o))}});var K=class{static subscribe(e){let n=Date.now();return pt[n]={callback:e},n}static unsubscribe(e){delete pt[e]}static delete(e){ft.delete(e)}};var Pn={walk:{velocity:.14,distance:.21},run:{velocity:.17,distance:.28}},xn=.056,Nn=10,Bn=["gliding","riding"];var Rn=new b;function Wo(t,e){return Math.hypot(e.x-t.x,e.z-t.z)}function Jo(t){return(t.getEffect(qo.speed)?.amplifier??0)*xn}function Xo(t,e){let n=Jo(e),o=Pn.run.distance+.75;return t>n+o}function _n(t,e){t.teleport(e.location,e.dimension,t.rotation.x,t.rotation.y);let n=(Rn.get(t)??0)+1;Rn.set(t,n),K.delete(t)}K.subscribe((t,e)=>{if(m(t)=="admin"||t.dimension.id!=e.dimension.id||t.getTags().some(o=>Bn.includes(o)))return;let n=Wo(t.location,e.location);if(t.hasTag("skip-movement-check"))return t.removeTag("skip-movement-check");if(n>Nn)_n(t,e);else{if(!Xo(n,t))return;_n(t,e)}});yt.events.dataDrivenEntityTriggerEvent.subscribe(t=>{t.entity instanceof gt&&t.id=="on_death"});yt.events.projectileHit.subscribe(({projectile:t,source:e})=>{t.typeId==Ln.enderPearl.id&&e instanceof gt&&K.delete(e)});yt.events.itemCompleteCharge.subscribe(({itemStack:t,source:e})=>{t.typeId==Ln.chorusFruit.id&&e instanceof gt&&K.delete(e)});import{Player as Zo,world as $e}from"@minecraft/server";var Qo=$e.events.beforeDataDrivenEntityTriggerEvent.subscribe(t=>{if($e.getDynamicProperty("roleHasBeenSet"))return $e.events.beforeDataDrivenEntityTriggerEvent.unsubscribe(Qo);t.entity instanceof Zo&&t.id=="rubedo:becomeAdmin"&&(Z(t.entity,"admin"),$e.setDynamicProperty("roleHasBeenSet",!0),Ee(t.entity),t.entity.tell("\xA7l\xA7cYou have been given admin, the function start will not work anymore!!!!"))});import{system as er}from"@minecraft/server";er.events.beforeWatchdogTerminate.subscribe(t=>{t.cancel=!0,console.warn(`WATCHDOG TRIED TO CRASH = ${t.terminateReason}`)});import{DynamicPropertiesDefinition as ht,EntityTypes as tr,MinecraftEntityTypes as nr,world as Dn}from"@minecraft/server";var Mn=[];Dn.events.worldInitialize.subscribe(({propertyRegistry:t})=>{k.overworld.runCommandAsync(`tickingarea add ${B.x} ${B.y} ${B.z} ${B.x} ${B.y} ${B.z} db true`);let e=new ht;e.defineString("name",30),e.defineNumber("index"),t.registerEntityTypeDynamicProperties(e,tr.get(ne));let n=new ht;n.defineString("role",30),t.registerEntityTypeDynamicProperties(n,nr.player);let o=new ht;o.defineBoolean("roleHasBeenSet"),o.defineString("worldsOwner",100),o.defineBoolean("isLockDown"),t.registerWorldDynamicProperties(o);for(let r of Mn)Dn.scoreboard.addObjective(r.objective,r.displayName??"")});var Ne=[];function rn(){Ne=[]}console.warn("----- Importing Plugins -----");console.warn("---- STARTING RUBEDO ----");var Oe=null,w=new or(rr.stick,0);ir.events.tick.subscribe(t=>{Oe?Oe=Oe+1:Oe=t.currentTick});export{w as AIR,Oe as CURRENT_TICK};
//# sourceMappingURL=index.js.map
