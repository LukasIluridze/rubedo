import{ItemStack as qo,MinecraftItemTypes as Wo,world as Jo}from"@minecraft/server";import{world as Fn}from"@minecraft/server";var v="-";import{world as $n}from"@minecraft/server";import{BlockLocation as Rn}from"@minecraft/server";var pt=32e3,ee="rubedo:database",x=new Rn(0,-64,0);import{ItemStack as Ln,MinecraftItemTypes as Dn}from"@minecraft/server";function ft(t,e){return t.match(new RegExp(".{1,"+e+"}","g"))}import{BlockLocation as Mn,MinecraftDimensionTypes as K,world as q}from"@minecraft/server";import{MessageFormData as _n}from"@minecraft/server-ui";var Y=class{constructor(e,n){this.title=e,this.body=n,this.form=new _n,e&&this.form.title(e),n&&this.form.body(n),this.triedToShow=0}setButton1(e,n){return this.button1={text:e,callback:n},this.form.button1(e),this}setButton2(e,n){return this.button2={text:e,callback:n},this.form.button2(e),this}show(e){this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e)}return}n.selection==1&&this.button1?.callback?.(),n.selection==0&&this.button2?.callback?.()})}};var k={overworld:q.getDimension(K.overworld),nether:q.getDimension(K.nether),theEnd:q.getDimension(K.theEnd),"minecraft:overworld":q.getDimension(K.overworld),"minecraft:nether":q.getDimension(K.nether),"minecraft:the_end":q.getDimension(K.theEnd)};function ne(t){let e=t.split(",");console.warn(e.length);let n=0;for(let o of e){let r=parseInt(o.match(/\D+|\d+/g)[0]),i=o.match(/\D+|\d+/g)[1];i=="y"&&(n=n+317098e-16*r),i=="w"&&(n=n+6048e5*r),i=="d"&&(n=n+864e5*r),i=="h"&&(n=n+36e5*r),i=="m"&&(n=n+6e4*r),i=="s"&&(n=n+1e3*r),i=="ms"&&(n=n+r)}return n}function W(t){return new Date(t).toString()}function gt(t){return new Mn(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z))}function he(t,e,n,o=()=>{}){new Y("Confirm To Continue",e).setButton1("Confirm",n).setButton2("Never Mind",o).show(t)}var f=class{static compress(e){return e}static decompress(e){return e}static createEntity(e,n){let o=k.overworld.spawnEntity(ee,x);o.setDynamicProperty("name",e),o.setDynamicProperty("index",n);let r=o.getComponent("inventory").container,i=new Ln(Dn.acaciaBoat,1);return n==0&&(i.nameTag="{}"),r.setItem(0,i),o}static getInventorySlotName(e,n){return e.getComponent("inventory").container.getItem(n)?.nameTag}static setInventorySlotName(e,n,o){let r=e.getComponent("inventory").container,i=r.getItem(n);return i.nameTag=o,r.setItem(n,i)}constructor(e){this.name=e,this.savedEntitys=void 0,this.MEMORY=void 0}get entitys(){if(this.savedEntitys)return this.savedEntitys;let e=k.overworld.getEntitiesAtBlockLocation(x).filter(n=>n.typeId==ee&&n.getDynamicProperty("name")==this.name);return this.savedEntitys=e,e}data(){if(this.MEMORY)return this.MEMORY;if(this.entitys.length==0&&f.createEntity(this.name,0),this.entitys.length==1){let n=JSON.parse(f.decompress(f.getInventorySlotName(this.entitys[0],0)));return this.MEMORY=n,n}let e=new Array(this.entitys.length);for(let n of this.entitys){let o=n.getDynamicProperty("index");e[o]=f.getInventorySlotName(n,0)}try{e=JSON.parse(e.join(""))}catch{e={}}return this.MEMORY=e,e}save(e){this.MEMORY=e;let n=ft(f.compress(JSON.stringify(e)),pt);if(this.entitys&&n.length==this.entitys.length)for(let o=0;o<n.length;o++)f.setInventorySlotName(this.entitys[o],0,n[o]);else{this.entitys?.forEach(o=>o?.triggerEvent("despawn")),this.savedEntitys=void 0;for(let o=0;o<n.length;o++){let r=f.createEntity(this.name,o);f.setInventorySlotName(r,0,n[o])}}}set(e,n){let o=this.data();o[e]=n,this.save(o)}get(e){return this.data()[e]}has(e){return this.keys().includes(e)}delete(e){let n=this.data(),o=delete n[e];return this.save(n),o}size(){return this.keys().length}clear(){this.save({})}keys(){return Object.keys(this.data())}values(){return Object.values(this.data())}getCollection(){return this.data()}};var s={config:new f("config"),freezes:new f("freezes"),mutes:new f("mutes"),bans:new f("bans"),regions:new f("regions"),roles:new f("roles"),tasks:new f("tasks"),npcs:new f("npcs"),ids:new f("ids"),logs:new f("logs")};function yt(t){return[...$n.getPlayers()].find(e=>e.name===t)}var $=class{constructor(e="literal"){this.name=e;this.typeName="literal";this.name=e}matches(e){return{success:this.name==e}}fail(e){return`${e} should be ${this.name}!`}},oe=class{constructor(e="string"){this.name=e;this.typeName="string";this.name=e}matches(e){return{success:e&&e!="",value:e}}fail(e){return"Value must be of type string!"}},re=class{constructor(e="integer"){this.name=e;this.typeName="int";this.name=e}matches(e){return{success:!isNaN(e),value:parseInt(e)}}fail(e){return"Value must be valid number!"}},De=class{constructor(e="float"){this.name=e;this.typeName="float";this.name=e}matches(e){return{success:Boolean(e?.match(/^\d+\.\d+$/)?.[0]),value:parseInt(e)}}fail(e){return"Value must be valid float!"}},G=class{constructor(e="location"){this.name=e;this.typeName="location";this.name=e}matches(e){return{success:/^([~^]{0,1}(-\d)?(\d*)?(\.(\d+))?)$/.test(e),value:e}}fail(e){return"Value needs to be a valid number, value can include: [~,^]"}},ie=class{constructor(e="boolean"){this.name=e;this.typeName="boolean";this.name=e}matches(e){return{success:Boolean(e?.match(/^(true|false)$/)?.[0]),value:e=="true"}}fail(e){return`"${e}" can be either "true" or "false"`}},$e=class{constructor(e="player"){this.name=e;this.typeName="playerName";this.name=e}matches(e){return{success:!!yt(e),value:yt(e)}}fail(e){return`player: "${e}", is not in this world`}},Oe=class{constructor(e="target"){this.name=e;this.typeName="Target";this.name=e}matches(e){return{success:Boolean(e?.match(/^(@.|"[\s\S]+")$/)?.[0]),value:e}}fail(e){return`${e} is not a valid target`}},se=class{constructor(e="array",n){this.name=e;this.types=n;this.typeName="string";this.name=e,this.types=n,this.typeName=n.join(" | ").replace(/(.{25})..+/,"$1...")}matches(e){return{success:this.types.includes(e),value:e}}fail(e){return`"${e}" must be one of these values: ${this.types.join(" | ")}`}},Fe=class{constructor(e){this.name=e;this.typeName="Duration"}matches(e){return{success:/^(\d+[hdysmw],?)+$/.test(e),value:e}}fail(e){return`"${e}" must be a value like "10d" or "3s" the first part is the length second is unit`}},ze=class{constructor(e="playerName"){this.name=e;this.typeName="playerName";this.name=e}matches(e){return{success:!!s.ids.get(e),value:e}}fail(e){return`player: "${e}" has never played this world before! Tip: if the name has spaces in it use quotes around name!`}},g={string:oe,int:re,float:De,location:G,boolean:ie,player:$e,target:Oe,array:se,duration:Fe,playerName:ze};var be=class{constructor(e){this.data=e,this.sender=e.sender}reply(e){this.sender.tell(e)}};function ht(t,e){try{return t.slice(e.length).trim().match(/"[^"]+"|[^\s]+/g).map(n=>n.replace(/"(.+)"/,"$1").toString())}catch{return[]}}function bt(t,e){t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.unknown",with:[`${e}`]}]})}function Ve(t,e){t.tell({rawtext:[{text:e.data.invaildPermission?e.data.invaildPermission:`\xA7cYou do not have permission to use "${e.data.name}"`}]})}function kt(t,e,n,o,r){if(t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.syntax",with:[`${v}${e.data.name} ${o.slice(0,r).join(" ")}`,o[r]??" ",o.slice(r+1).join(" ")]}]}),n.children.length>1||!o[r]){let i=n.children.map(a=>a.type instanceof $?a.type.name:a.type?.typeName);t.tell(`\xA7c"${o[r]??"undefined"}" is not valid! Argument "${[...new Set(n.children.map(a=>a.type.name))][0]}" can be typeof: "${i.join('", "')}"`)}else t.tell(`\xA7c${n.children[0]?.type?.fail(o[r])}`)}function On([t,e,n],{location:o,viewVector:r}){if(!t||!e||!t)return null;let i=[o.x,o.y,o.z],a=[r.x,r.y,r.z],m=[t,e,n].map(y=>{let C=parseFloat(y);return isNaN(C)?0:C}),d=[t,e,n].map((y,C)=>y.includes("~")?m[C]+i[C]:y.includes("^")?m[C]+a[C]:m[C]);return{x:d[0],y:d[1],z:d[2]}}function It(t,e,n,o){let r=e[e.length-1]??o,i=[];for(let[a,m]of e.entries())if(!m.type.name.endsWith("*")){if(m.type instanceof G){i.push(On([t[a],t[a+1],t[a+2]],n.sender));continue}m.type instanceof $||i.push(m.type.matches(t[a]).value??t[a])}r.callback(new be(n),...i)}var M=[];Fn.events.beforeChat.subscribe(t=>{if(!t.message.startsWith(v))return;t.cancel=!0;let e=ht(t.message,v),n=M.find(i=>i.depth==0&&(i.data.name==e[0]||i.data?.aliases?.includes(e[0])));if(!n)return bt(t.sender,e[0]);if(!n.data?.requires(t.sender))return Ve(t.sender,n);e.shift();let o=[],r=(i,a)=>{if(i.children.length>0){let m=i.children.find(d=>d.type.matches(e[a]).success);return!m&&!e[a]&&i.callback?void 0:m?m.data?.requires(t.sender)?(o.push(m),r(m,a+1)):(Ve(t.sender,m),"fail"):(kt(t.sender,n,i,e,a),"fail")}};r(n,0)||It(e,o,t,n)});import{Player as Jn,world as Ke}from"@minecraft/server";var Ct="rubedo:gui",ae="rubedo:inventory";import{world as j,Player as Vn,BlockLocation as _t,MinecraftBlockTypes as Gn,GameMode as Hn}from"@minecraft/server";var Tt={doorsAndSwitches:!0,openContainers:!0,pvp:!1,allowedEntitys:["minecraft:player","minecraft:npc","minecraft:item","rubedo:inventory","rubedo:database"]},wt=["minecraft:acacia_door","minecraft:acacia_trapdoor","minecraft:acacia_button","minecraft:birch_door","minecraft:birch_trapdoor","minecraft:birch_button","minecraft:crimson_door","minecraft:crimson_trapdoor","minecraft:crimson_button","minecraft:dark_oak_door","minecraft:dark_oak_trapdoor","minecraft:dark_oak_button","minecraft:jungle_door","minecraft:jungle_trapdoor","minecraft:jungle_button","minecraft:mangrove_door","minecraft:mangrove_trapdoor","minecraft:mangrove_button","minecraft:spruce_door","minecraft:spruce_trapdoor","minecraft:spruce_button","minecraft:warped_door","minecraft:warped_trapdoor","minecraft:warped_button","minecraft:wooden_door","minecraft:wooden_button","minecraft:trapdoor","minecraft:iron_door","minecraft:iron_trapdoor","minecraft:polished_blackstone_button","minecraft:lever"],vt=["minecraft:chest","minecraft:ender_chest","minecraft:barrel","minecraft:trapped_chest","minecraft:dispenser","minecraft:dropper","minecraft:furnace","minecraft:blast_furnace","minecraft:lit_furnace","minecraft:lit_blast_furnace","minecraft:hopper","minecraft:shulker_box","minecraft:undyed_shulker_box","minecraft:lit_smoker","minecraft:smoker"];var Ge=[],zn=!1,Et=-64,St=320;function At(t,e,n){return n.every((o,r)=>o>=Math.min(t[r],e[r])&&o<=Math.max(t[r],e[r]))}var h=class{static getAllRegions(){if(zn)return Ge;let e=s.regions.values().map(n=>new h(n.from,n.to,n.dimensionId,n.permissions,n.key));return e.forEach(n=>{Ge.push(n)}),e}static blockLocationInRegion(e,n){return this.getAllRegions().find(o=>o.dimensionId==n&&At([o.from.x,Et,o.from.z],[o.to.x,St,o.to.z],[e.x,e.y,e.z]))}static removeRegionAtBlockLocation(e,n){let o=this.blockLocationInRegion(e,n);return o?s.regions.delete(o.key):!1}constructor(e,n,o,r,i){this.from=e,this.to=n,this.dimensionId=o,this.permissions=r??Tt,this.key=i||Date.now().toString(),i||(this.update(),ke(),Ge.push(this))}update(){s.regions.set(this.key,{key:this.key,from:this.from,dimensionId:this.dimensionId,permissions:this.permissions,to:this.to})}delete(){return s.regions.delete(this.key)}entityInRegion(e){return this.dimensionId==e.dimension.id&&At([this.from.x,Et,this.from.z],[this.to.x,St,this.to.z],[e.location.x,e.location.y,e.location.z])}changePermission(e,n){this.permissions[e]=n,this.update()}};var L=class{static getTasks(){return s.tasks.get("changePlayerRole")??[]}static getPlayersRoleToSet(e){return L.getTasks().find(o=>o.playerName==e)?.role}constructor(e,n){let o=L.getTasks();o.push({playerName:e,role:n}),s.tasks.set("changePlayerRole",o)}};import{MinecraftBlockTypes as me,MinecraftItemTypes as u}from"@minecraft/server";var Pt=[u.beehive.id,u.beeNest.id,u.axolotlBucket.id,u.codBucket.id,u.tadpoleBucket.id,u.tropicalFishBucket.id,u.salmonBucket.id,u.pufferfishBucket.id],Nt=[u.allow.id,u.barrier.id,u.borderBlock.id,u.debugStick?.id??"minecraft:debug_stick",u.deny.id,u.jigsaw.id,u.lightBlock.id,u.commandBlock.id,u.repeatingCommandBlock.id,u.chainCommandBlock.id,u.commandBlockMinecart.id,u.structureBlock.id,u.structureVoid.id,u.bedrock.id,u.endPortalFrame.id,"minecraft:info_update","minecraft:info_update2","minecraft:reserved3","minecraft:reserved4","minecraft:reserved6","minecraft:movingBlock","minecraft:moving_block","minecraft:movingblock","minecraft:piston_arm_collision","minecraft:piston_arm_collision","minecraft:pistonarmcollision","minecraft:stickyPistonArmCollision","minecraft:sticky_piston_arm_collision","minecraft:unknown","minecraft:glowingobsidian","minecraft:invisible_bedrock","minecraft:invisiblebedrock","minecraft:netherreactor","minecraft:portal","minecraft:fire","minecraft:water","minecraft:lava","minecraft:flowing_lava","minecraft:flowing_water","minecraft:soul_fire"],xt=[me.dispenser.id],Bt=[me.bedrock.id,me.barrier.id,"minecraft:invisiblebedrock","minecraft:movingBlock","minecraft:movingblock","minecraft:moving_block"],Ie=[me.chest.id,me.trappedChest.id],Hr=[u.chest.id,u.trappedChest.id,u.barrel.id,u.dispenser.id,u.dropper.id,u.furnace.id,"minecraft:lit_furnace",u.blastFurnace.id,"minecraft:lit_blast_furnace",u.smoker.id,"minecraft:lit_smoker",u.hopper.id,u.shulkerBox.id,u.undyedShulkerBox.id],H={x:7,y:7,z:7};var Ce={aquaAffinity:1,baneOfArthropods:5,binding:1,blastProtection:4,channeling:1,depthStrider:3,efficiency:5,featherFalling:4,fireAspect:2,fireProtection:4,flame:1,fortune:3,frostWalker:2,impaling:5,infinity:1,knockback:2,looting:3,loyalty:4,luckOfTheSea:3,lure:3,mending:1,multishot:1,piercing:4,power:5,projectileProtection:4,protection:4,punch:2,quickCharge:3,respiration:3,riptide:3,sharpness:5,silkTouch:1,smite:5,soulSpeed:3,swiftSneak:4,thorns:3,unbreaking:3,vanishing:1};var Rt="2.6.0-beta";var Te="https://discord.gg/dMa3A5UYKX";function B(t,e=[],n){if(console.warn(e),He(t))return console.warn("[WARNING]: TRIED TO KICK OWNER"),t.tell("You have been tried to kick, but you cant!"),n?.();try{t.runCommandAsync(`kick @s \xA7r${e.join(`
`)}`),t.triggerEvent("kick")}catch(o){if(t.triggerEvent("kick"),!/"statusCode":-2147352576/.test(o))return;n&&n()}}function c(t){return t instanceof Vn?s.roles.get(t.name)??"member":s.roles.get(t)??"member"}function J(t,e){if(typeof t=="string"){s.roles.set(t,e);let n=[...j.getPlayers()].find(o=>o.name==t);n?n.setDynamicProperty("role",e):new L(t,e)}else s.roles.set(t.name,e),t.setDynamicProperty("role",e)}function He(t){return j.getDynamicProperty("worldsOwner")==t.id}function we(){return j.getDynamicProperty("isLockDown")??!1}function je(t){j.setDynamicProperty("isLockDown",t)}function ke(){for(let t of h.getAllRegions()){let e=new _t(t.from.x,t.dimensionId=="minecraft:overworld"?-64:0,t.from.z),n=new _t(t.to.x,t.dimensionId=="minecraft:overworld"?-64:0,t.to.z);for(let o of e.blocksBetween(n))k[t.dimensionId].getBlock(o)?.setType(Gn.deny)}}var Mt=[];function R(t,e=0){Mt.push({callback:t,delay:e,lastCall:0})}j.events.tick.subscribe(t=>{let e=[...j.getPlayers()];for(let[n,o]of e.entries())if(!["moderator","admin"].includes(c(o)))for(let r of Mt)r.delay!=0&&t.currentTick-r.lastCall<r.delay||(r.callback(o,t),n==e.length-1&&(r.lastCall=t.currentTick))});function p(t){switch(t){case"spam_config":return s.config.get("spam_config")??{repeatedMessages:!0,zalgo:!0,violationCount:0,permMutePlayer:!1};case"cbe_config":return s.config.get("cbe_config")??{clearItem:!0,violationCount:0,banPlayer:!1,canAddEnchantment:!1};case"gamemode_config":return s.config.get("gamemode_config")??{setToSurvival:!0,clearPlayer:!0,violationCount:0,banPlayer:!1};case"nuker_data":return s.config.get("nuker_data")??{violationCount:0,banPlayer:!1};case"banned_items":return s.config.get("banned_items")??Nt;case"banned_blocks":return s.config.get("banned_blocks")??Bt;case"enchantments":return s.config.get("enchantments")??Ce;case"appealLink":return s.config.get("appealLink")??Te}}function Lt(t){return p("enchantments")[t.type.id]??t.type.maxLevel}function Dt(t){return Object.values(Hn).find(e=>[...j.getPlayers({name:t.name,gameMode:e})].length)}import{world as $t}from"@minecraft/server";var Ot=new Map,ce=class{constructor(e,n,o=!1,r=Date.now()){this.callbackTick=null,this.tickDelay=n,this.loop=o,this.callback=e,this.id=r,Ot.set(r,this),this.TickCallBack=$t.events.tick.subscribe(({currentTick:i})=>{if(this.callbackTick||(this.callbackTick=i+this.tickDelay),!(this.callbackTick>i)){if(this.callback(i),!this.loop)return this.expire();this.callbackTick=i+this.tickDelay}})}expire(){$t.events.tick.unsubscribe(this.TickCallBack),Ot.delete(this.id)}};var Ft=t=>new Promise(e=>Ue(e,t));function Ue(t,e){new ce(t,e)}function P(t,e){return new ce(t,e,!0)}import{world as jt}from"@minecraft/server";var Ye={},zt={},O={};function jn(t,e,n){if(e.length!=n.length)return[];let o=[];for(let r=0;r<n.length;r++){if(e[r]?.item?.amount<n[r]?.item?.amount||e[r]?.item?.amount>n[r]?.item?.amount&&e[r]?.item?.amount!=0){let i={slot:r,uid:n[r].uid,oldUid:e[r].uid,item:n[r].item,oldItem:e[r].item,changeType:"fluctuation"};o.push(i),O[t.id]=i;continue}if(n[r].uid!=e[r].uid)if(e[r]?.item&&n[r]?.item){let i={slot:r,uid:n[r].uid,oldUid:e[r].uid,item:n[r].item,oldItem:e[r].item,changeType:"swap"};o.push(i),O[t.id]=i}else if(n[r]?.item){if(n[r]?.item)if(O[t.id]?.changeType=="delete"&&O[t.id]?.uid==n[r].uid){let i={slot:r,uid:n[r].uid,item:n[r].item,changeType:"move"};o.push(i),O[t.id]=i;continue}else{let i={slot:r,uid:n[r].uid,item:n[r].item,changeType:"put"};o.push(i),O[t.id]=i}}else{let i={slot:r,uid:e[r].uid,item:e[r].item,changeType:"delete"};o.push(i),O[t.id]=i}}return o}function Un(t){if(!t)return"";let e=[];return e.push(t.typeId),e.push(t.nameTag),e.push(t.data),e.push(t.getLore().join("")),e.join("")}function Yn(t){let e=[];for(let n=0;n<t.size;n++){let o=t.getItem(n);e[n]={uid:Un(o),item:o}}return e}P(()=>{for(let t of Object.values(Ye))for(let e of k.overworld.getEntities(t.entities)){let n=Yn(e.getComponent("inventory").container),o=jn(e,zt[e.id]??n,n);if(zt[e.id]=n,o.length!=0){if(e.hasTag("skipCheck")){e.removeTag("skipCheck"),delete O[e.id];continue}for(let r of o)t.callback(e,r)}}},5);var le=class{static subscribe(e,n){let o=Date.now();return Ye[o]={callback:n,entities:e},o}static unsubscribe(e){delete Ye[e]}};import{Location as qn}from"@minecraft/server";import{world as Kn}from"@minecraft/server";var b=class{constructor(){this.data=new Map,this.events={playerLeave:Kn.events.playerLeave.subscribe(e=>this.data.delete(e.playerName))}}set(e,n){this.data.set(e.name,n)}get(e){return this.data.get(e.name)}delete(e){this.data.delete(e.name)}clear(){this.data.clear()}playerNames(){return[...this.data.keys()]}includes(e){return this.playerNames().includes(e.name)}};var N={},X={},de=new b;function Vt(t){return t.getComponent("minecraft:inventory").container.getItem(t.selectedSlot)}async function Gt(t,e){try{let n=t.getComponent("minecraft:inventory").container,o=[];for(let r=0;r<n.size;r++){let i=n.getItem(r);!i||i?.typeId==e?.typeId&&(o.push({slot:r,item:i}),n.setItem,r<9?await t.runCommandAsync(`replaceitem entity @s slot.hotbar ${r} air`):await t.runCommandAsync(`replaceitem entity @s slot.inventory ${r-9} air`))}await t.runCommandAsync(`clear @s ${e?.typeId} ${e.data} ${e.amount}`);for(let r of o)n.setItem(r.slot,r.item)}catch{[...t.dimension.getEntities({type:"minecraft:item",location:new qn(t.location.x,t.location.y,t.location.z),maxDistance:2,closest:1})].forEach(o=>o.kill())}}function Ht(t,e){return t.getComponent("minecraft:inventory").container.getItem(e)}var ve=class{constructor(e,n,o){this.gui=e,this.slot=n,this.change=o}message(e){this.gui.player.tell(e)}getItemAdded(){return this.slot.item?null:this.gui.entity.getComponent("minecraft:inventory").container.getItem(this.change.slot)}GiveAction(e=this.slot.item.itemStack){this.gui.player.getComponent("minecraft:inventory").container.addItem(e)}TakeAction(e=null){this.gui.player.getComponent("minecraft:inventory").container.addItem(this.slot.item.itemStack),this.gui.page.slots[this.change.slot]=null,e&&e.delete(this.slot.item.components.dbKey)}PageAction(e,n){this.gui.setPage(e,n)}CloseAction(){this.gui.despawn()}SetAction(){this.gui.entity.getComponent("minecraft:inventory").container.setItem(this.change.slot,this.slot.item.itemStack)}async FormAction(e){return this.CloseAction(),await Ft(5),await e.show(this.gui.player)}};var Z=class{static spawnEntity(e){try{return e.dimension.spawnEntity(ae,e.headLocation)}catch{return null}}constructor(e){this.player=e,this.entity=Z.spawnEntity(e),this.entity&&(this.hasChestOpen=!1,this.setPage("home")),this.tickEvent=jt.events.tick.subscribe(()=>{if(!this.entity)return this.despawn();if(de.get(this.player))this.hasChestOpen||(this.slotChangeEvent=le.subscribe({type:ae},(n,o)=>{n.id==this.entity.id&&this.onSlotChange(o)})),this.hasChestOpen=!0;else try{this.entity.teleport(this.player.headLocation,this.player.dimension,this.player.rotation.x,this.player.rotation.y,!0)}catch{this.despawn()}})}setPage(e,n){let o=this.entity.getComponent("inventory").container;for(let i=0;i<o.size;i++)o.setItem(i,T);if(!Object.keys(X).includes(e))throw new Error(`pageId ${e} does not exist!`);let r=X[e];this.page=r,r.fillType(this.entity,r,n),this.entity.nameTag="size:54"}onSlotChange(e){let n=this.page.slots[e.slot];if(!n)this.entity.getComponent("inventory").container.setItem(e.slot,T);else if(e.changeType=="delete"){if(n.item&&Gt(this.player,e.item),!n.item&&!Ht(this.entity,e.slot))return;n.action(new ve(this,n,e))}}despawn(){try{this.entity?.triggerEvent("despawn")}catch{}try{delete N[this.player.name]}catch{}this.tickEvent&&jt.events.tick.unsubscribe(this.tickEvent),this.slotChangeEvent&&le.unsubscribe(this.slotChangeEvent)}};import{ItemStack as Wn}from"@minecraft/server";var I=class{constructor(e,n={},o){this.itemType=e,this.components=n,this.setItemStack=o}get itemStack(){if(this.setItemStack)return this.setItemStack;let e=new Wn(this.itemType);if(this.components){e.amount=this.components?.amount??1,e.data=this.components?.data??0,e.nameTag=this.components?.nameTag,e.setLore(this.components?.loreList??[]);let n=e.getComponent("enchantments").enchantments;for(let o of this.components?.enchantments??[])n.addEnchantment(o);e.getComponent("enchantments").enchantments=n}return e}};function Ut(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let r=0;r<o.size;r++){let i=e.slots[r];if(!i||!i.item){o.setItem(r,T);continue}o.setItem(r,i.item.itemStack)}}var F=class{constructor(e,n=Ut){if(Object.keys(X).includes(e))throw new Error(`Page: ${e}, Already exists!`);this.id=e,this.fillType=n,this.slots=[],X[e]=this}setSlots(e,n,o){let r=n?{item:n,action:o}:null;for(let i of e)this.slots[i]=r;return this}};import{MinecraftItemTypes as Yt}from"@minecraft/server";var Ki=new F("home").setSlots([22],new I(Yt.enderChest,{nameTag:"\xA7l\xA7bInventory Viewer"}),t=>{t.PageAction("moderation:see")}).setSlots([54],new I(Yt.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});Ke.events.tick.subscribe(t=>{for(let e of Ke.getPlayers())if(c(e)=="admin"){if(Vt(e)?.typeId!=Ct){N[e.name]&&N[e.name].despawn();continue}Object.keys(N).includes(e?.name)||(N[e.name]=new Z(e))}});Ke.events.beforeDataDrivenEntityTriggerEvent.subscribe(t=>{t.entity instanceof Jn&&(t.id=="rubedo:has_container_open"?de.set(t.entity,!0):t.id=="rubedo:dosent_have_container_open"&&de.set(t.entity,!1))});P(()=>{let t=Object.values(N).map(e=>e.entity.id);for(let e of k.overworld.getEntities({type:ae}))t.includes(e.id)||e.triggerEvent("despawn")},100);var E={"api.name":()=>"Smelly API","api.error.unknown":()=>"An unknown error has occurred.","api.database.error.table_name":(t,e)=>`The display name ${t} is too long for an objective, it can be at most ${e} characters long`,"api.utilities.formatter.error.ms":t=>`${t} is not a string or a number`,"api.Providers.form.invalidType":(t,e)=>`Type ${t} is not a valid type to add a ${e}`,"api.Providers.form.invalidFormtype":(t,e)=>{`${t}${JSON.stringify(e)}`},"api.ChestGUI.error.pagenotfound":t=>`Page ${t} not found!`,"modules.protections.cps.clickingToFast":()=>"You are clicking to fast! Please click slower!","modules.managers.mute.isMuted":()=>"You are muted and cannot send messages please try again later","modules.commands.ban.reply":(t,e,n="")=>`\xA7cBanned \xA7f"\xA7a${t}\xA7f" \xA7cfor ${e} Because: "${n??"No reason Provided"}" \xA7aSuccessfully`,"lockdown.kick.message":()=>["\xA7cYou have been kicked!","\xA7aReason: \xA7fServer is currently under LockDown","\xA7fServer will be up soon, Try to join later"],"commands.ban.list.player":(t,e,n)=>`- "${t}" Because: ${e}, Expiry ${n}`,"commands.freeze.list.player":(t,e)=>`- "${t}" Because: ${e}`,"commands.mutes.list.player":(t,e,n)=>`- "${t}" Because: ${e}, Expiry: ${n}`,"commands.lockdown.confirm":"Are you sure you want to lockdown the server, this will kick all active players and all players who try to join who are not admin"};var l=class{constructor(e,n,o=0,r){this.data=e;this.type=n;this.depth=o;this.parent=r;e.requires||(e.requires=i=>!0),this.data=e,this.type=n??new $(this.data.name),this.children=[],this.depth=o,this.parent=r,this.callback=null,M.push(this)}argument(e){let n=new l(this.data,e,this.depth+1,this);return this.children.push(n),n}string(e){return this.argument(new oe(e))}int(e){return this.argument(new re(e))}array(e,n){return this.argument(new se(e,n))}boolean(e){return this.argument(new ie(e))}location(e){let n=this.argument(new G(e));return e.endsWith("*")?n:n.location(e+"_y*").location(e+"_z*")}literal(e){let n=new l(e,new $(e.name),this.depth+1,this);return this.children.push(n),n}executes(e){return this.callback=e,this}};import{Player as Kt}from"@minecraft/server";var S=class{constructor(e,n,o="No Reason",r="Rubedo Auto Mod"){let i=e instanceof Kt?e.id:s.ids.get(e);if(!i)throw new Error(`"${e}" does not have a saved id!`);let a={key:i,playerName:e instanceof Kt?e.name:e,date:Date.now(),duration:n?ne(n):null,expire:n?ne(n)+Date.now():null,reason:o,by:r};s.bans.set(i,a)}};function qe(t,e,n,o,r){if(s.bans.get(s.ids.get(e)))return t.reply(`\xA7c${e} is already banned`);t.reply("\xA7aClose chat to confirm"),he(t.sender,`Are you sure you want to ban ${e}, for ${n??"forever"}`,()=>{new S(e,n,o,t.sender.name),t.reply(E["modules.commands.ban.reply"](e,n,o))})}var We=new l({name:"ban",description:"Manage bans",requires:t=>["admin","moderator"].includes(c(t))});We.literal({name:"add",description:"Bans a player"}).argument(new g.playerName).executes((t,e)=>{qe(t,e,null,null,t.sender.name)}).argument(new g.duration("duration")).executes((t,e,n)=>{qe(t,e,n,null,t.sender.name)}).string("reason").executes((t,e,n,o)=>{qe(t,e,n,o,t.sender.name)});We.literal({name:"remove",description:"unbans a player"}).argument(new g.playerName("playerName")).executes((t,e)=>{let n=s.bans.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not banned`);s.bans.delete(n.key)?t.reply(`\xA7a${e}\xA7r has been Unbanned!`):t.reply(`\xA7cFailed to unban ${e}`)});We.literal({name:"list",description:"Lists all bans"}).executes(t=>{let e=s.bans.values();if(e.length==0)return t.sender.tell("\xA7cNo one is banned!");t.sender.tell(`\xA72--- Showing Bans (${e.length}) ---`);for(let n of e)t.sender.tell(E["commands.ban.list.player"](n.playerName,n.reason,n.expire?W(n.duration):"Forever"))});var ue=new l({name:"database",description:"Interacts with SA Database",aliases:["db"],requires:t=>c(t)=="admin"});ue.literal({name:"get"}).string("table").string("key").executes((t,e,n)=>{try{let o=s[e].get(n);o?t.reply(JSON.stringify(o)):t.reply(`No data could be found for key ${n}`)}catch(o){t.reply(o+o.stack)}});ue.literal({name:"set"}).string("table").string("key").string("value").executes((t,e,n,o)=>{try{s[e].set(n,o),t.reply(`Set Key: "${n}", to value: "${o}" on table: "${e}"`)}catch(r){t.reply(r+r.stack)}});ue.literal({name:"clear"}).string("table").executes((t,e)=>{try{s[e].clear(),t.reply(`Cleared Table ${e}`)}catch(n){t.reply(n+n.stack)}});ue.literal({name:"keys",description:"Returns all keys on a database"}).string("table").executes((t,e)=>{try{let n=s[e].keys();t.reply(`Keys on database: ${e}: ${n}`)}catch(n){t.reply(n+n.stack)}});ue.literal({name:"values",description:"Returns all values on a database"}).string("table").executes((t,e)=>{try{let n=s[e].values();t.reply(`Values on database: ${e}: ${JSON.stringify(n,null,2)}`)}catch(n){n instanceof TypeError?t.reply(`No values on database ${e}`):t.reply(n+n.stack)}});new l({name:"ecwipe",description:"Clears a players ender chest",requires:t=>c(t)=="admin"}).argument(new g.player("player")).executes(async(t,e)=>{for(let n=0;n<27;n++)await e.runCommandAsync(`replaceitem entity @s slot.enderchest ${n} air`);t.reply(`Cleared ${e.name} Ender chest!`)});var Ee=class{constructor(e,n="No Reason"){let o={playerName:e.name,key:e.id,reason:n,location:{x:e.location.x,y:e.location.y,z:e.location.z,dimension:e.dimension.id}};s.freezes.set(e.id,o)}};var Je=new l({name:"freeze",description:"Manage Freezes",requires:t=>["admin","moderator"].includes(c(t))});Je.literal({name:"add",description:"Freezes a player"}).argument(new g.player("player")).string("reason").executes((t,e,n)=>{new Ee(e,n),t.reply(`\xA7cFroze \xA7f"\xA7a${e.name}\xA7f" Because: "${n}" \xA7aSuccessfully`),t.sender.tell(`\xA7cYou have been frozen by \xA7f"\xA7a${t.sender.name}\xA7f" Because: "${n}"`)});Je.literal({name:"remove",description:"unfreezes a player"}).argument(new g.playerName("playerName")).executes((t,e)=>{let n=s.freezes.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not frozen`);s.freezes.delete(n.key),t.reply(`\xA7a${e}\xA7r has been UnFrozen!`)});Je.literal({name:"list",description:"Lists all freezes"}).executes(t=>{let e=s.freezes.values();if(e.length==0)return t.sender.tell("\xA7cNo one is frozen!");t.sender.tell(`\xA72--- Showing Freezes (${e.length}) ---`);for(let n of e)t.sender.tell(E["commands.freeze.list.player"](n.playerName,n.reason))});var Xe=class{constructor(e){this.name=e;this.typeName="CommandName"}matches(e){return{success:Boolean(M.find(n=>n.depth==0&&n.data.name==e)),value:e}}fail(e){return`"${e}" is not a valid command`}};function Xn(t,e,n){n.tell(`${v}${t.data.name} ${e.map(o=>o.type.typeName=="literal"?o.data.name:`<${o.type.name}: ${o.type.typeName}>`).join(" ")}`)}function Se(t,e,n,o){if(!!e.data?.requires(o)&&(e.callback&&Xn(t,e.depth==0?n:n.concat(e),o),e.children.length>0))for(let r of e.children)Se(t,r,e.depth==0?n:n.concat(e),o)}function qt(t,e,n){t.tell(`\xA72--- Showing help page ${e} of ${n} (${v}help <page: int>) ---`)}function Wt(t){let e=M.filter(n=>n.depth==0&&n.data?.requires(t));return e.length==0?0:Math.ceil(e.length/5)}var Jt=new l({name:"help",description:"Provides help/list of commands.",aliases:["?","h"]}).executes(t=>{let e=Wt(t.sender),n=M.filter(o=>o.depth==0&&o.data?.requires(t.sender)).slice(1*5-5,1*5);qt(t.sender,1,e);for(let o of n)Se(o,o,[],t.sender)});Jt.int("page").executes((t,e)=>{let n=Wt(t.sender);e>n&&(e=n);let o=M.filter(r=>r.depth==0&&r.data?.requires(t.sender)).slice(e*5-5,e*5);qt(t.sender,e,n);for(let r of o)Se(r,r,[],t.sender)});Jt.argument(new Xe("command")).executes((t,e)=>{let n=M.filter(o=>o.depth==0&&o.data.name==e)[0];t.sender.tell(`\xA7e${n.data.name}: ${n.data.aliases?`aliases (${n.data.aliases.join(", ")})`:""}`),t.sender.tell(`\xA7e${n.data.description}`),t.sender.tell("Usage:"),Se(n,n,[],t.sender)});import{world as Xt}from"@minecraft/server";new l({name:"lockdown",description:"Toggles the servers lockdown, meaning no one can join",requires:t=>c(t)=="admin"}).executes(t=>{we()?(je(!1),t.sender.tell("Unlocked the server!")):(t.reply("\xA7aClose chat to confirm lockdown"),he(t.sender,E["commands.lockdown.confirm"],()=>{je(!0);for(let e of Xt.getPlayers())c(e)!="admin"&&B(e,E["lockdown.kick.message"]());Xt.say("\xA7l\xA7cServer is now LOCKED!")}))});var _=class{static getMuteData(e){return s.mutes.get(e.name)}constructor(e,n,o="No Reason",r="Rubedo Auto Mod"){let i=n?ne(n):null,a={playerName:e.name,date:Date.now(),duration:i,expire:i?i+Date.now():null,reason:o,by:r};s.mutes.set(e.name,a)}};var Ze=new l({name:"mute",description:"Manage Mutes",requires:t=>["admin","moderator"].includes(c(t))});Ze.literal({name:"add",description:"Mutes a player"}).argument(new g.player("player")).argument(new g.duration("duration")).string("reason").executes((t,e,n,o)=>{new _(e,n,o,t.sender.name),t.reply(`\xA7cMuted \xA7f"\xA7a${e.name}\xA7f" \xA7cfor ${n} Because: "${o}" \xA7aSuccessfully`),e.tell(`\xA7cYou have been muted by \xA7f"${t.sender.name}" \xA7cfor ${n} Because: "${o}"`)});Ze.literal({name:"remove",description:"unmutes a player"}).argument(new g.playerName("playerName")).executes((t,e)=>{let n=s.mutes.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not muted!`);s.mutes.delete(n.playerName);try{t.sender.runCommandAsync(`ability "${e}" mute false`)}catch{}t.reply(`\xA7a${e}\xA7r has been UnMuted!`)});Ze.literal({name:"list",description:"Lists all feeezes"}).executes(t=>{let e=s.mutes.values();if(e.length==0)return t.sender.tell("\xA7cNo one is muted!");t.sender.tell(`\xA72--- Showing Mutes (${e.length}) ---`);for(let n of e)t.sender.tell(E["commands.mutes.list.player"](n.playerName,n.reason,n.expire?W(n.expire):"Forever"))});import{Location as Zn}from"@minecraft/server";var Q=class{static isVaild(e){return e.typeId!="minecraft:npc"?!1:Ae.find(n=>n==e.location)?!0:!!s.npcs.keys().find(n=>e.id==n)}constructor(e,n){Ae.push(e);let o=n.spawnEntity("minecraft:npc",e),r={dimension:o.dimension.id,x:o.location.x,y:o.location.y,z:o.location.z};s.npcs.set(o.id,r),Zt()}};new l({name:"npc",description:"Spawns a npc at your coordinates",requires:t=>c(t)=="admin"}).executes(t=>{let{x:e,y:n,z:o}=t.sender.location;new Q(new Zn(e,n,o),t.sender.dimension),t.reply("Spawned a verifed npc at your current location")});import{world as Qt}from"@minecraft/server";new l({name:"ping",description:"Returns the current TPS of the servers ping"}).executes(t=>{let e=Qt.events.tick.subscribe(({deltaTime:n})=>{t.reply(`Pong! Current TPS: ${1/n}`),Qt.events.tick.unsubscribe(e)})});import{BlockLocation as pe}from"@minecraft/server";var fe=new l({name:"region",description:"Create a Region",requires:t=>c(t)=="admin"});fe.literal({name:"add",description:"Adds a new protection region"}).int("from_x").int("from_z").int("to_x").int("to_z").executes((t,e,n,o,r)=>{new h({x:e,z:n},{x:o,z:r},t.sender.dimension.id),t.reply(`Created Region From ${e} -64 ${n} ${o} 320 ${r}`)});fe.literal({name:"remove",description:"Removes a region at the players current postion"}).executes(t=>{let e=new pe(t.sender.location.x,t.sender.location.y,t.sender.location.z);h.removeRegionAtBlockLocation(e,t.sender.dimension.id)?t.reply(`Removed Region at ${e.x} ${e.y} ${e.z}`):t.reply(`Failed to find/remove region at ${e.x} ${e.y} ${e.z}`)});fe.literal({name:"removeAll",description:"Removes all regions"}).executes(t=>{h.getAllRegions().forEach(e=>e.delete()),t.reply("Removed All regions")});fe.literal({name:"list",description:"Lists all regions and positions"}).executes(t=>{let e=h.getAllRegions();for(let n of e)t.reply(`Region from ${n.from.x}, ${n.from.z} to ${n.to.x}, ${n.to.z} in dimension ${n.dimensionId}`);if(e.length==0)return t.reply("No regions have been made yet")});var Qe=fe.literal({name:"permission",description:"Handels permissions for regions"});Qe.literal({name:"set",description:"Sets a certin permission on the region the player is currently in to a value"}).array("key",["doorsAndSwitches","openContainers","pvp"]).boolean("value").executes((t,e,n)=>{let o=h.blockLocationInRegion(new pe(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!o)return t.reply("You are not in a region");o.changePermission(e,n),t.reply(`Changed permision ${e} to ${n}`)});Qe.literal({name:"list",description:"Lists the permissions for the current region"}).executes(t=>{let e=h.blockLocationInRegion(new pe(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!e)return t.reply("You are not in a region");t.reply(`Current region permissions ${JSON.stringify(e.permissions)}`)});var en=Qe.literal({name:"entities",description:"Holds the subCommands for adding or removing allowedEntitys"});en.literal({name:"add",description:"Adds a entity to the allowed entitys list"}).string("entity").executes((t,e)=>{let n=h.blockLocationInRegion(new pe(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let o=n.permissions.allowedEntitys;o.push(e),n.changePermission("allowedEntitys",o),t.reply(`Added entity ${e} to the allowed entitys of the region your currently standing in`)});en.literal({name:"remove",description:"Removes a entity from the allowed entitys in the region"}).string("entity").executes((t,e)=>{let n=h.blockLocationInRegion(new pe(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let o=n.permissions.allowedEntitys;if(!o.includes(e))return t.reply(`The entity ${e} is not allowed to enter the region`);o=o.filter(r=>r!=e),n.changePermission("allowedEntitys",o),t.reply(`Removed entity ${e} to the allowed entitys of the region your currently standing in`)});var et=(r=>(r[r.member=0]="member",r[r.admin=1]="admin",r[r.moderator=2]="moderator",r[r.builder=3]="builder",r))(et||{});var Qn=t=>isNaN(Number(t))===!1;function eo(t){return Object.keys(t).filter(Qn).map(e=>t[e])}var tn=new l({name:"role",description:"Changes the role for a player",requires:t=>c(t)=="admin"||He(t)});tn.literal({name:"set",description:"Sets the role for a player"}).argument(new g.playerName("playerName")).argument(new g.array("role",eo(et))).executes((t,e,n)=>{J(e,n),t.reply(`Changed role of ${e} to ${n}`)});tn.literal({name:"get",description:"Gets the role of a player"}).argument(new g.playerName("playerName")).executes((t,e)=>{t.reply(`${e} has role: ${c(e)}`)});import{ActionFormData as to}from"@minecraft/server-ui";var z=class{constructor(e,n){this.title=e,this.body=n,this.form=new to,e&&this.form.title(e),n&&this.form.body(n),this.buttons=[],this.triedToShow=0}addButton(e,n=null,o){return this.buttons.push({text:e,iconPath:n,callback:o}),this.form.button(e,n),this}show(e){this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e)}return}this.buttons[n.selection].callback?.()})}};import{MinecraftBlockTypes as oo}from"@minecraft/server";import{ModalFormData as no}from"@minecraft/server-ui";var Pe=class{constructor(e,n,o){this.form=e,this.player=n,this.callback=o}error(e){new Y("Error",e).setButton1("Return to form",()=>{this.form.show(this.player,this.callback)}).setButton2("Cancel",null).show(this.player)}};var A=class{constructor(e){this.title=e,this.form=new no,e&&this.form.title(e),this.args=[],this.triedToShow=0}addDropdown(e,n,o){return this.args.push({type:"dropdown",options:n}),this.form.dropdown(e,n,o),this}addSlider(e,n,o,r,i){return this.args.push({type:"slider"}),this.form.slider(e,n,o,r,i),this}addToggle(e,n){return this.args.push({type:"toggle"}),this.form.toggle(e,n),this}addTextField(e,n,o){return this.args.push({type:"textField"}),this.form.textField(e,n,o),this}show(e,n){this.form.show(e).then(o=>{if(o.canceled){if(o.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e,n)}return}n(new Pe(this,e,n),...o.formValues.map((r,i)=>this.args[i].type=="dropdown"?this.args[i].options[r]:r))})}};function nn(t){new z("Remove a Banned Item").addButton("Remove a Banned Item",null,()=>{ro(t)}).addButton("Ban an item",null,()=>{io(t)}).show(t)}function ro(t){new A("Remove Banned Items").addDropdown("Select item to remove",p("banned_items")).show(t,(e,n)=>{let o=p("banned_items");o=o.filter(r=>r!=n),s.config.set("banned_items",o),t.tell(`Removed Banned item "${n}"`)})}function io(t){new A("Add Banned Items").addTextField("Item Id","minecraft:string").show(t,(e,n)=>{let o=p("banned_items");if(o.includes(n))return e.error(`\xA7cItem "${n}" is already banned`);o.push(n),s.config.set("banned_items",o),t.tell(`Banned the item "${n}"`)})}function on(t){new A("Manage Banned Blocks").addDropdown("Add/Remove Block",["add","remove"],0).addTextField("Block Id","minecraft:barrier").show(t,(e,n,o)=>{if(!oo.get(o)?.id)return e.error(`\xA7c"${o}" is not a valid block id, note: this item must be either a block in a behavior pack or a default minecraft block`);if(n=="add"){let r=p("banned_blocks");if(r.includes(o))return e.error(`\xA7cBlock "${o}" is already banned`);r.push(o),s.config.set("banned_blocks",r),t.tell(`Banned the block "${o}"`)}else{let r=p("banned_blocks");if(!r.includes(o))return e.error(`block: "${o}" is not banned`);r=r.filter(i=>i!=o),s.config.set("banned_blocks",r),t.tell(`Removed Banned block "${o}"`)}})}function rn(t){new A("Manage Enchantment Levels").addDropdown("Enchantment to change",Object.keys(Ce),0).addTextField("Level (number)","5").show(t,(e,n,o)=>{if(isNaN(o))return e.error(`\xA7c"${o}" is not a number, please enter a value like, "3", "9", etc.`);let r=parseInt(o),i=p("enchantments");i[n]=r,s.config.set("enchantments",i),t.tell(`Set max level for ${n} to ${r}`)})}function sn(t){new A("Manage Appeal Link").addTextField("Appeal Link",Te).show(t,(e,n)=>{s.config.set("appealLink",n),t.tell(`Changed the servers appeal link to ${n}`)})}function an(t){new z("Rubedo Settings").addButton("Anti Spam","textures/ui/permissions_op_crown.png",()=>{ao(t)}).addButton("Cbe","textures/blocks/sculk_shrieker_top.png",()=>{mo(t)}).addButton("Gamemode","textures/blocks/barrier.png",()=>{co(t)}).addButton("Nuker","textures/ui/Feedback.png",()=>{lo(t)}).show(t)}function ao(t){let e=p("spam_config");new A("Manage Spam Protection").addToggle("Ban Repeated Messages",e.repeatedMessages).addToggle("Ban Zalgo",e.zalgo).addSlider("Violation Count before ban (if ban is false this does nothing)",0,20,1,e.violationCount).addToggle("Perm Mute Player",e.permMutePlayer).show(t,(n,o,r,i,a)=>{s.config.set("spam_config",{repeatedMessages:o,zalgo:r,violationCount:i,permMutePlayer:a}),t.tell("Updated Spam Protection settings!")})}function mo(t){let e=p("cbe_config");new A("Manage CBE Protection").addToggle("Clear Item",e.clearItem).addSlider("Violation Count before ban (if ban is false this does nothing)",0,20,1,e.violationCount).addToggle("Ban Player",e.banPlayer).addToggle("Allow non-enchantable items to be enchanted",e.banPlayer).show(t,(n,o,r,i,a)=>{s.config.set("cbe_config",{clearItem:o,violationCount:r,banPlayer:i,canAddEnchantment:a}),t.tell("Updated CBE Protection settings!")})}function co(t){let e=p("gamemode_config");new A("Manage Gamemode Protection").addToggle("Set to survival",e.setToSurvival).addToggle("Clear Player (Once this players gamemode has been switched back to survival should it clear the inventory?)",e.clearPlayer).addSlider("Violation Count before ban (if ban is false this does nothing)",0,20,1,e.violationCount).addToggle("Ban Player",e.banPlayer).show(t,(n,o,r,i,a)=>{s.config.set("gamemode_config",{setToSurvival:o,clearPlayer:r,violationCount:i,banPlayer:a}),t.tell("Updated Gamemode Protection settings!")})}function lo(t){let e=p("nuker_data");new A("Manage Gamemode Protection").addSlider("Violation Count before ban (if ban is false this does nothing)",0,20,1,e.violationCount).addToggle("Ban Player",e.banPlayer).show(t,(n,o,r)=>{s.config.set("nuker_data",{violationCount:o,banPlayer:r}),t.tell("Updated Nuker Protection settings!")})}function mn(t){new z("Rubedo Settings").addButton("Auto Mod","textures/ui/permissions_op_crown.png",()=>{an(t)}).addButton("Banned items","textures/blocks/sculk_shrieker_top.png",()=>{nn(t)}).addButton("Banned blocks","textures/blocks/barrier.png",()=>{on(t)}).addButton("Enchantments","textures/items/book_enchanted.png",()=>{rn(t)}).addButton("Appeal Link","textures/ui/Feedback.png",()=>{sn(t)}).show(t)}new l({name:"settings",description:"Opens up the settings menu for the player",requires:t=>["admin","moderator"].includes(c(t))}).executes(t=>{mn(t.sender),t.sender.tell("\xA7aForm request sent, close chat to continue!")});import{world as cn}from"@minecraft/server";function ln(t,e){if(t.hasTag("spectator")){if(t.runCommandAsync("gamemode c"),t.triggerEvent("removeSpectator"),t.removeTag("spectator"),!e)return;cn.say({rawtext:[{translate:"multiplayer.player.joined",with:[`\xA7e${t.name}`]}]})}else{if(t.runCommandAsync("gamemode spectator"),t.triggerEvent("addSpectator"),t.addTag("spectator"),!e)return;cn.say({rawtext:[{translate:"multiplayer.player.left",with:[`\xA7e${t.name}`]}]})}}new l({name:"vanish",description:"Toggles Vanish Mode on the sender",requires:t=>c(t)=="admin"}).executes(t=>{ln(t.sender,!1)}).boolean("say").executes((t,e)=>{ln(t.sender,e)});new l({name:"version",description:"Get Current Version",aliases:["v"]}).executes(t=>{t.reply(`Current Rubedo Version: ${Rt}`)});new l({name:"kick",description:"Kicks a player from the game",requires:t=>c(t)=="admin"}).argument(new g.player).string("reason").executes((t,e,n)=>{B(e,[n]),t.reply(`\xA7aKicked ${e.name} from world`)});var U=class{constructor(e){this.data=e,console.warn(`[LOG]: ${e.message}`),s.logs.set(Date.now().toString(),e)}};function tt(t){var e=6e4,n=e*60,o=n*24,r=o*30,i=o*365,a=Date.now()-t;return a<e?Math.round(a/1e3)+" seconds ago":a<n?Math.round(a/e)+" minutes ago":a<o?Math.round(a/n)+" hours ago":a<r?"approximately "+Math.round(a/o)+" days ago":a<i?"approximately "+Math.round(a/r)+" months ago":"approximately "+Math.round(a/i)+" years ago"}var ge=new l({name:"log",description:"Manages the log command",requires:t=>c(t)=="admin"});ge.literal({name:"add",description:"Adds a new log"}).string("message").executes((t,e)=>{new U({message:e}),t.reply(`\xA7aAdded new log: ${e}`)});ge.literal({name:"getAll",description:"Gets all logs sorted in decending"}).int("page").array("order",["ascending","descending"]).executes((t,e,n)=>{let o=Object.entries(s.logs.getCollection()).sort((i,a)=>n=="ascending"?parseInt(a[0])-parseInt(i[0]):parseInt(i[0])-parseInt(a[0]));if(o.length==0)return t.reply("\xA7cNo Logs have been made!");let r=Math.ceil(o.length/8);e>r&&(e=r),t.reply(`\xA72--- Showing logs page ${e} of ${r} (${v}log getAll <page: int>) ---`);for(let[i,a]of o.slice(e*8-8,e*8))t.reply(`${tt(parseInt(i))}: ${a.message}`)});ge.literal({name:"getPlayersLogs",description:"Gets all logs associated with a player"}).argument(new g.playerName).int("page").array("order",["ascending","descending"]).executes((t,e,n,o)=>{let r=Object.entries(s.logs.getCollection()).filter(a=>a[1].playerName==e).sort((a,m)=>o=="ascending"?parseInt(m[0])-parseInt(a[0]):parseInt(a[0])-parseInt(m[0]));if(r.length==0)return t.reply(`\xA7cNo Logs exists for "${e}"!`);let i=Math.ceil(r.length/8);n>i&&(n=i),t.reply(`\xA72--- Showing logs for "${e}" page ${n} of ${i} ---`);for(let[a,m]of r.slice(n*8-8,n*8))t.reply(`${tt(parseInt(a))}: ${m.message}`)});ge.literal({name:"getProtectionLogs",description:"Gets all logs associated with a protection"}).string("protection").int("page").array("order",["ascending","descending"]).executes((t,e,n,o)=>{let r=Object.entries(s.logs.getCollection()).filter(a=>a[1].protection==e).sort((a,m)=>o=="ascending"?parseInt(m[0])-parseInt(a[0]):parseInt(a[0])-parseInt(m[0]));if(r.length==0)return t.reply(`\xA7cNo Logs exists for protection: "${e}"!`);let i=Math.ceil(r.length/8);n>i&&(n=i),t.reply(`\xA72--- Showing logs for Protection: "${e}" page ${n} of ${i} ---`);for(let[a,m]of r.slice(n*8-8,n*8))t.reply(`${tt(parseInt(a))}: ${m.message}`)});ge.literal({name:"clearAll",description:"Clears all logs"}).executes(t=>{s.logs.clear(),t.reply("\xA7aCleared All logs!")});R(t=>{try{let e=s.bans.get(t.id);if(!e)return;if(e.expire&&e.expire<Date.now())return s.bans.delete(t.id);B(t,["\xA7cYou have been banned!",`\xA7aReason: \xA7f${e.reason}`,`\xA7fExpiry: \xA7b${e.expire?W(e.expire-Date.now()):"Forever"}`,`\xA7fAppeal at: \xA7b${p("appealLink")}`],()=>{console.warn(new Error("Failed to kick player")),s.bans.delete(t.id)})}catch(e){console.warn(e+e.stack)}},20);import{Location as po}from"@minecraft/server";R(t=>{let e=s.freezes.get(t.id);!e||t.teleport(new po(e.location.x,e.location.y,e.location.z),k[e.location.dimension],0,0)},20);import{world as fo}from"@minecraft/server";var nt={};fo.events.beforeChat.subscribe(t=>{if(!t.message.startsWith(v))for(let e of Object.values(nt))e.callback(t)});var Ne=class{static subscribe(e){let n=Date.now();return nt[n]={callback:e},n}static unsubscribe(e){delete nt[e]}};Ne.subscribe(t=>{let e=_.getMuteData(t.sender);if(!!e){if(e.expire&&e.expire<Date.now())return s.mutes.delete(t.sender.name);t.cancel=!0,t.sender.tell(E["modules.managers.mute.isMuted"]())}});import{BlockLocation as go,world as ot}from"@minecraft/server";P(()=>{ke()},6e3);ot.events.beforeItemUseOn.subscribe(t=>{if(["moderator","admin"].includes(c(t.source)))return;let e=h.blockLocationInRegion(t.blockLocation,t.source.dimension.id);if(!e)return;let n=t.source.dimension.getBlock(t.blockLocation);wt.includes(n.typeId)&&e.permissions.doorsAndSwitches||vt.includes(n.typeId)&&e.permissions.openContainers||(t.cancel=!0)});ot.events.beforeExplosion.subscribe(t=>{for(let e=0;e<t.impactedBlocks.length;e++){let n=t.impactedBlocks[e];if(h.blockLocationInRegion(n,t.dimension.id))return t.cancel=!0}});ot.events.entityCreate.subscribe(t=>{let e=h.blockLocationInRegion(new go(t.entity.location.x,t.entity.location.y,t.entity.location.z),t.entity.dimension.id);!e||e.permissions.allowedEntitys.includes(t.entity.typeId)||(t.entity.teleport({x:0,y:-64,z:0},t.entity.dimension,0,0),t.entity.kill())});P(()=>{for(let t of h.getAllRegions())for(let e of k[t.dimensionId].getEntities({excludeTypes:t.permissions.allowedEntitys}))!t.entityInRegion(e)||(e.teleport({x:0,y:-64,z:0},e.dimension,0,0),e.kill())},100);R(t=>{for(let e of h.getAllRegions())e.entityInRegion(t)?(t.addTag("inRegion"),e.permissions.pvp||t.addTag("region-protected")):(t.removeTag("inRegion"),t.removeTag("region-protected"))},5);import{world as rt}from"@minecraft/server";rt.events.playerJoin.subscribe(({player:t})=>{if(we()&&c(t)!="admin")return B(t,E["lockdown.kick.message"]());let e=rt.events.tick.subscribe(async n=>{try{await k.overworld.runCommandAsync(`testfor @a[name="${t.name}"]`),rt.events.tick.unsubscribe(e),_.getMuteData(t)&&t.runCommandAsync("ability @s mute true"),s.ids.has(t.name)?t.addTag("old"):s.ids.set(t.name,t.id);let o=L.getPlayersRoleToSet(t.name);o&&J(t,o)}catch{}})});import{Items as yo,MinecraftItemTypes as D,world as it}from"@minecraft/server";var dn=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],ho=[10,11,12,13,14,15,16,19,20,21,22,23,24,25,28,29,30,31,32,33,34,37,38,39,40,41,42,43];function bo(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let r=0;r<o.size;r++){let i=e.slots[r];if(!i||!i.item){o.setItem(r,T);continue}o.setItem(r,i.item.itemStack)}for(let[r,i]of[...it.getPlayers()].entries()){let a=dn[r],m=new I(D.skull,{nameTag:i.name,data:3});o.setItem(a,m.itemStack),e.slots[a]={item:m,action:d=>{d.PageAction("moderation:see_inventory",{name:i.name})}}}}function ko(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let d=0;d<o.size;d++){let y=e.slots[d];if(!y||!y.item){o.setItem(d,T);continue}o.setItem(d,y.item.itemStack)}let r=new I(D.enderChest,{nameTag:`\xA7eView \xA7f${n?.name}\xA7e Ender Chest
\xA7fNote: \xA7cThis will not grab \xA7lANY NBT!\xA7r`});o.setItem(49,r.itemStack),e.slots[49]={item:r,action:d=>{d.PageAction("moderation:see_ender_chest",{name:n.name})}};let i=[...it.getPlayers()].find(d=>d.name==n.name);i||(Object.values(N).find(y=>y.entity.id==t.id).despawn(),i.tell(`"${n.name}" Could not be found, Gui Crashed`));let a=i.getComponent("inventory").container,m=0;for(let d=0;d<a.size;d++){let y=a.getItem(d),C=dn[m];if(m++,!y){o.setItem(C,T);continue}o.setItem(C,y),e.slots[C]={item:new I(yo.get(y.typeId),{amount:y.amount,data:y.data},y),action:async xn=>{d<9?await i.runCommandAsync(`replaceitem entity @s slot.hotbar ${d} air`):await i.runCommandAsync(`replaceitem entity @s slot.inventory ${d-9} air`),xn.GiveAction(),e.slots[C]={item:null,action:Bn=>{a.addItem(Bn.getItemAdded())}}}}}}function Io(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let m=0;m<o.size;m++){let d=e.slots[m];if(!d||!d.item){o.setItem(m,T);continue}o.setItem(m,d.item.itemStack)}let r=[...it.getPlayers()].find(m=>m.name==n?.name);r||(Object.values(N).find(d=>d.entity.id==t.id).despawn(),r.tell(`"${n.name}" Could not be found, Gui Crashed`));let i=0,a=Object.values(D);for(let m of a)try{r.runCommandAsync(`testfor @s[hasitem={item=${m.id},location=slot.enderchest}]`),console.warn(`found ${m.id}`);let d=new I(m,{nameTag:"Note: \xA7l\xA7cThis is not the exzact item"}),y=ho[i];o.setItem(y,d.itemStack),e.slots[y]={item:d,action:C=>{C.GiveAction(),e.slots[y]=null}},i++}catch{}}new F("moderation:see",bo).setSlots([50],new I(D.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("home")}).setSlots([48],new I(D.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});new F("moderation:see_inventory",ko).setSlots([50],new I(D.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("moderation:see")}).setSlots([48],new I(D.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});new F("moderation:see_ender_chest",Io).setSlots([50],new I(D.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("moderation:see")}).setSlots([48],new I(D.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});import{world as st,Player as un,MinecraftBlockTypes as Co}from"@minecraft/server";var To=["minecraft:command_block_minecart","minecraft:npc"];st.events.entityCreate.subscribe(({entity:t})=>{let e=()=>{try{t.triggerEvent("despawn"),t.kill()}catch{t.kill()}};if(To.includes(t.typeId)||t.typeId=="minecraft:npc"&&!Q.isVaild(t))return e()});st.events.beforeItemUseOn.subscribe(t=>{if(!(t.source instanceof un)||["moderator","admin"].includes(c(t.source)))return;if(xt.includes(t.item.typeId)){t.cancel=!0;return}let e=p("banned_blocks");console.warn(JSON.stringify(e)),e.includes(t.item.typeId)&&(t.cancel=!0,new S(t.source,null,"Placing Banned Blocks"))});st.events.beforeItemUseOn.subscribe(t=>{!(t.source instanceof un)||!t.item.typeId.endsWith("spawn_egg")||["admin","moderator"].includes(c(t.source))||t.source.dimension.getBlock(t.blockLocation).typeId==Co.mobSpawner.id||(t.cancel=!0,t.source.tell("\xA7c[Rubedo]: You cannot place spawnEggs on the floor!"),t.source.playSound("note.bass"))});var at=32e4;R(t=>{(Math.abs(t.location.x)>at||Math.abs(t.location.y)>at||Math.abs(t.location.z)>at)&&new S(t,null,"Crasher detected")});import{GameMode as wo,world as vo}from"@minecraft/server";var Eo=wo.creative,pn=new b;P(()=>{let t=p("gamemode_config");for(let e of vo.getPlayers({gameMode:Eo})){if(["moderator","admin","builder"].includes(c(e)))continue;try{t.setToSurvival&&e.runCommandAsync("gamemode s"),t.clearPlayer&&e.runCommandAsync("clear @s")}catch{}let n=(pn.get(e)??0)+1;pn.set(e,n),t.banPlayer&&n>=t.violationCount&&new S(e,null,"Illegal Gamemode")}},20);import{world as fn}from"@minecraft/server";var So="\xA7c\xA7k\xA7m\xA7A\xA7r\xA7cToolbox Gamer\xA7k\xA7mA\xA7r";fn.events.playerJoin.subscribe(({player:t})=>{let e=()=>B(t,["\xA7cYou have been kicked!",`\xA7aReason: \xA7f'${t.name}' is Detected for nameSpoof`,"\xA7fThis Server requires you to have a valid gamertag!"]);if(!/^([a-zA-Z0-9]|\_| )+$/gm.test(t.name)||t.name==So||[...fn.getPlayers()].filter(n=>n.name==t.name).length>1||(s.ids.get(t.name)??t.id)!=t.id||t.name.includes("\xA7"))return e()});import{world as Po,Location as No}from"@minecraft/server";import{world as Ao}from"@minecraft/server";var xe=class{constructor(e){this.emptySlotsCount=e.emptySlotsCount,this.size=e.size,this.items=[];for(let n=0;n<this.size;n++)this.items[n]=e.getItem(n)}load(e){for(let n=0;n<e.size;n++)!this.items[n]||e.setItem(n,this.items[n])}};var Be={};P(()=>{Be={};for(let t of Ao.getPlayers()){if(t.dimension.id!="minecraft:overworld")continue;let e=gt(t.location),n=e.offset(H.x,H.y,H.z),o=e.offset(-H.x,-H.y,-H.z);for(let r of n.blocksBetween(o)){if(r.y<-64)continue;let i=t.dimension.getBlock(r);!i||!Ie.includes(i.typeId)||(Be[JSON.stringify(r)]=new xe(i.getComponent("inventory").container))}}},100);var mt={};Po.events.blockBreak.subscribe(t=>{for(let e of Object.values(mt))e.callback(new ct(t.block,t.brokenBlockPermutation,t.dimension,t.player))});var Re=class{static subscribe(e){let n=Date.now();return mt[n]={callback:e},n}static unsubscribe(e){delete mt[e]}},ct=class{constructor(e,n,o,r){this.block=e;this.brokenBlockPermutation=n;this.dimension=o;this.player=r;this.block=e,this.brokenBlockPermutation=n,this.dimension=o,this.player=r}set cancel(e){if(this.dimension.getBlock(this.block.location).setPermutation(this.brokenBlockPermutation.clone()),Ie.includes(this.brokenBlockPermutation.type.id)){let n=Be[JSON.stringify(this.block.location)];n&&n.load(this.block.getComponent("inventory").container)}Ue(()=>{[...this.dimension.getEntities({maxDistance:2,type:"minecraft:item",location:new No(this.block.location.x,this.block.location.y,this.block.location.z)})].forEach(n=>n.kill())},0)}};var gn=new b,xo=15,Bo=["snow","lush_plants_replaceable","azalea_log_replaceable","minecraft:crop","fertilize_area"],Ro=["minecraft:water","minecraft:flowing_water","minecraft:lava","minecraft:flowing_lava","minecraft:bedrock"],yn=new b;Re.subscribe(t=>{if(["moderator","admin"].includes(c(t.player))||t.block.getTags().some(n=>Bo.includes(n)))return;let e=gn.get(t.player);if(gn.set(t.player,Date.now()),!!e){if(!Ro.includes(t.block.typeId)){if(e<Date.now()-xo)return;let n=p("nuker_data"),o=(yn.get(t.player)??0)+1;yn.set(t.player,o),n.banPlayer&&o>=n.violationCount&&new S(t.player,null,"Using Nuker")}t.cancel=!0}});import{world as _o}from"@minecraft/server";var hn=new b,bn=new b;_o.events.beforeChat.subscribe(t=>{if(t.message.startsWith(v)||["admin","moderator"].includes(c(t.sender)))return;let e=p("spam_config"),n=()=>{let o=(bn.get(t.sender)??0)+1;bn.set(t.sender,o),e.permMutePlayer&&o>=e.violationCount&&new _(t.sender,null,"Spamming")};if(e.repeatedMessages&&hn.get(t.sender)==t.message)return t.cancel=!0,n(),t.sender.tell("\xA7cRepeated message detected!");if(e.zalgo&&/%CC%/g.test(encodeURIComponent(t.message)))return t.cancel=!0,n(),t.sender.tell("\xA7cYou message contains some type of zalgo and cannot be sent!");hn.set(t.sender,t.message)});var kn=new b;function _e(t,e){let n=t.getComponent("inventory").container,o=n.getItem(e),r=p("cbe_config");if(r.clearItem&&n.setItem(e,T),new U({playerName:t.name,message:`${t.name} Has obtained a unobtainable item: ${o.typeId}`,protection:"unobtainable"}),!r.banPlayer)return;let i=(kn.get(t)??0)+1;kn.set(t,i),!(i<r.violationCount)&&new S(t,null,"Possession of Unobtainable item")}R(t=>{let e=p("banned_items"),n=t.getComponent("inventory").container;for(let o=0;o<n.size;o++){let r=n.getItem(o);if(!r)continue;if(e.includes(r.typeId))return _e(t,o);if(Pt.includes(r.typeId))return new U({playerName:t.name,message:`${t.name} Has obtained a Forbidden item: ${r.typeId}`,protection:"unobtainable"}),n.setItem(o,T);let i=[];for(let a of r.getComponent("enchantments").enchantments){let m=Lt(a);if(a.level>m)return _e(t,o);if(a.level<1||i.includes(a.type.id))return _e(t,1);i.push(a.type.id)}}});import{MinecraftBlockTypes as w,MinecraftEntityTypes as Mo,MinecraftItemTypes as V,Player as Lo,world as In}from"@minecraft/server";var Do=[w.chest.id,w.trappedChest.id,w.barrel.id,w.dispenser.id,w.dropper.id,w.furnace.id,w.litFurnace.id,w.blastFurnace.id,w.litBlastFurnace.id,w.smoker.id,w.litSmoker.id,w.hopper.id,w.beehive.id,w.beeNest.id,w.mobSpawner.id],$o=[V.chestBoat.id,V.oakChestBoat.id,V.birchChestBoat.id,V.acaciaChestBoat.id,V.jungleChestBoat.id,V.spruceChestBoat.id,V.darkOakChestBoat.id,V.mangroveChestBoat.id];In.events.blockPlace.subscribe(async({player:t,block:e})=>{if(!Do.includes(e.typeId))return;let n=e.permutation;await e.dimension.runCommandAsync(`setblock ${e.x} ${e.y} ${e.z} ${e.typeId}`),e.setPermutation(n)});In.events.beforeItemUseOn.subscribe(t=>{t.source instanceof Lo&&(!$o.includes(t.item.typeId)||(t.cancel=!0,t.source.dimension.spawnEntity(Mo.chestBoat.id,t.blockLocation.above()),Dt(t.source)!="creative"&&t.source.getComponent("inventory").container.setItem(t.source.selectedSlot,T)))});import{MinecraftEffectTypes as Fo,Player as zo,world as Vo}from"@minecraft/server";import{world as Cn}from"@minecraft/server";var lt={},Tn=new b;Cn.events.tick.subscribe(t=>{let e=(n,o)=>{for(let r of Object.values(lt))r.callback(n,o)};for(let n of Cn.getPlayers()){let o=Tn.get(n);o&&n.location==o?.location||(Tn.set(n,{location:n.location,dimension:n.dimension,tickSet:t.currentTick}),o&&e(n,o))}});var Me=class{static subscribe(e){let n=Date.now();return lt[n]={callback:e},n}static unsubscribe(e){delete lt[e]}};var wn={walk:{velocity:.14,distance:.21},run:{velocity:.17,distance:.28}},vn=3,En=.056,Sn=10,An=["gliding","riding"];function Go(t,e){return Math.hypot(e.x-t.x,e.z-t.z)}var dt=new b;Me.subscribe((t,e)=>{if(c(t)=="admin"||t.dimension.id!=e.dimension.id)return;if(t.hasTag("skip-movement-check"))return t.removeTag("skip-movement-check");if(t.getTags().some(i=>An.includes(i)))return;let n=(t.getEffect(Fo.speed)?.amplifier??0)*En,o=Go(t.location,e.location);if(o>Sn){t.teleport(e.location,e.dimension,t.rotation.x,t.rotation.y),t.addTag("skip-movement-check");return}if(o<wn.run.distance+.7+n)return;let r=(dt.get(t)??0)+1;dt.set(t,r),!(r<vn)&&(dt.set(t,0),t.teleport(e.location,e.dimension,t.rotation.x,t.rotation.y),t.addTag("skip-movement-check"))});Vo.events.dataDrivenEntityTriggerEvent.subscribe(t=>{t.entity instanceof zo&&t.id=="on_death"&&t.entity.addTag("skip-movement-check")});import{Player as Ho,world as ye}from"@minecraft/server";var jo=ye.events.beforeDataDrivenEntityTriggerEvent.subscribe(t=>{if(ye.getDynamicProperty("roleHasBeenSet"))return ye.events.beforeDataDrivenEntityTriggerEvent.unsubscribe(jo);t.entity instanceof Ho&&t.id=="rubedo:becomeAdmin"&&(J(t.entity,"admin"),ye.setDynamicProperty("roleHasBeenSet",!0),ye.setDynamicProperty("worldsOwner",t.entity.id),t.entity.tell("\xA7l\xA7cYou have been given admin, the function start will not work anymore!!!!"))});import{system as Uo}from"@minecraft/server";Uo.events.beforeWatchdogTerminate.subscribe(t=>{t.cancel=!0,console.warn(`WATCHDOG TRIED TO CRASH = ${t.terminateReason}`)});import{DynamicPropertiesDefinition as ut,EntityTypes as Yo,MinecraftEntityTypes as Ko,world as Nn}from"@minecraft/server";var Pn=[];Nn.events.worldInitialize.subscribe(({propertyRegistry:t})=>{k.overworld.runCommandAsync(`tickingarea add ${x.x} ${x.y} ${x.z} ${x.x} ${x.y} ${x.z} db true`);let e=new ut;e.defineString("name",30),e.defineNumber("index"),t.registerEntityTypeDynamicProperties(e,Yo.get(ee));let n=new ut;n.defineString("role",30),t.registerEntityTypeDynamicProperties(n,Ko.player);let o=new ut;o.defineBoolean("roleHasBeenSet"),o.defineString("worldsOwner",100),o.defineBoolean("isLockDown"),t.registerWorldDynamicProperties(o);for(let r of Pn)Nn.scoreboard.addObjective(r.objective,r.displayName??"")});var Ae=[];function Zt(){Ae=[]}console.warn("----- Importing Plugins -----");console.warn("---- STARTING RUBEDO ----");var Le=null,T=new qo(Wo.stick,0);Jo.events.tick.subscribe(t=>{Le?Le=Le+1:Le=t.currentTick});export{T as AIR,Le as CURRENT_TICK};
//# sourceMappingURL=index.js.map
