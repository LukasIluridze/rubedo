import{ItemStack as mr,MinecraftItemTypes as cr,world as lr}from"@minecraft/server";import{world as on}from"@minecraft/server";var w="-";import{Location as nn}from"@minecraft/server";import{world as tn}from"@minecraft/server";import{BlockLocation as Jt}from"@minecraft/server";var Ye=32e3,j="rubedo:database",Ce=new Jt(0,-64,0);import{ItemStack as Qt,MinecraftItemTypes as en}from"@minecraft/server";function qe(t,e){return t.match(new RegExp(".{1,"+e+"}","g"))}import{world as P,Player as Xt,BlockLocation as Te,MinecraftBlockTypes as Zt,MinecraftDimensionTypes as $}from"@minecraft/server";var Ke={doorsAndSwitches:!0,openContainers:!0,pvp:!1,allowedEntitys:["minecraft:player","minecraft:npc","minecraft:item"]},Je=["minecraft:acacia_door","minecraft:acacia_trapdoor","minecraft:acacia_button","minecraft:birch_door","minecraft:birch_trapdoor","minecraft:birch_button","minecraft:crimson_door","minecraft:crimson_trapdoor","minecraft:crimson_button","minecraft:dark_oak_door","minecraft:dark_oak_trapdoor","minecraft:dark_oak_button","minecraft:jungle_door","minecraft:jungle_trapdoor","minecraft:jungle_button","minecraft:mangrove_door","minecraft:mangrove_trapdoor","minecraft:mangrove_button","minecraft:spruce_door","minecraft:spruce_trapdoor","minecraft:spruce_button","minecraft:warped_door","minecraft:warped_trapdoor","minecraft:warped_button","minecraft:wooden_door","minecraft:wooden_button","minecraft:trapdoor","minecraft:iron_door","minecraft:iron_trapdoor","minecraft:polished_blackstone_button","minecraft:lever"],We=["minecraft:chest","minecraft:ender_chest","minecraft:barrel","minecraft:trapped_chest","minecraft:dispenser","minecraft:dropper","minecraft:furnace","minecraft:blast_furnace","minecraft:lit_furnace","minecraft:lit_blast_furnace","minecraft:hopper","minecraft:shulker_box","minecraft:undyed_shulker_box"];var ve=[],Wt=!1,Xe=-64,Ze=320;function Qe(t,e,n){return n.every((r,o)=>r>=Math.min(t[o],e[o])&&r<=Math.max(t[o],e[o]))}var p=class{static getAllRegions(){if(Wt)return ve;let e=a.regions.values().map(n=>new p(n.from,n.to,n.dimensionId,n.permissions,n.key));return e.forEach(n=>{ve.push(n)}),e}static blockLocationInRegion(e,n){return this.getAllRegions().find(r=>r.dimensionId==n&&Qe([r.from.x,Xe,r.from.z],[r.to.x,Ze,r.to.z],[e.x,e.y,e.z]))}static removeRegionAtBlockLocation(e,n){let r=this.blockLocationInRegion(e,n);return r?a.regions.delete(r.key):!1}constructor(e,n,r,o,i){this.from=e,this.to=n,this.dimensionId=r,this.permissions=o??Ke,this.key=i||Date.now().toString(),i||(this.update(),ae(),ve.push(this))}update(){a.regions.set(this.key,{key:this.key,from:this.from,dimensionId:this.dimensionId,permissions:this.permissions,to:this.to})}delete(){return a.regions.delete(this.key)}entityInRegion(e){return this.dimensionId==e.dimension.id&&Qe([this.from.x,Xe,this.from.z],[this.to.x,Ze,this.to.z],[e.location.x,e.location.y,e.location.z])}changePermission(e,n){this.permissions[e]=n,this.update()}};var E=class{static getTasks(){return a.tasks.get("changePlayerRole")??[]}static getPlayersRoleToSet(e){return E.getTasks().find(r=>r.playerName==e)?.role}constructor(e,n){let r=E.getTasks();r.push({playerName:e,role:n}),a.tasks.set("changePlayerRole",r)}};var _={overworld:P.getDimension($.overworld),nether:P.getDimension($.nether),theEnd:P.getDimension($.theEnd),"minecraft:overworld":P.getDimension($.overworld),"minecraft:nether":P.getDimension($.nether),"minecraft:the_end":P.getDimension($.theEnd)};function se(t,e=[],n){try{t.runCommand(`kick "${t.nameTag}" \xA7r${e.join(`
`)}`),t.triggerEvent("kick")}catch(r){if(!/"statusCode":-2147352576/.test(r))return;n&&n()}}function c(t){return t instanceof Xt?a.roles.get(t.name)??"member":a.roles.get(t)??"member"}function O(t,e){if(typeof t=="string"){a.roles.set(t,e);let n=[...P.getPlayers()].find(r=>r.name==t);n?n.setDynamicProperty("role",e):new E(t,e)}else a.roles.set(t.name,e),t.setDynamicProperty("role",e)}function ae(){for(let t of p.getAllRegions()){let e=new Te(t.from.x,-64,t.from.z),n=new Te(t.to.x,-64,t.to.z);for(let r of e.blocksBetween(n))_[t.dimensionId].getBlock(r)?.setType(Zt.deny)}}var et=[];function I(t,e=0){et.push({callback:t,delay:e,lastCall:0})}P.events.tick.subscribe(t=>{let e=[...P.getPlayers()];for(let[n,r]of e.entries())if(!["moderator","admin"].includes(c(r)))for(let o of et)o.delay!=0&&t.currentTick-o.lastCall<o.delay||(o.callback(r,t),n==e.length-1&&(o.lastCall=t.currentTick))});function tt(t,e="overworld",n=!1){try{return n?console.warn(JSON.stringify(this.runCommand(t))):_.overworld.runCommand(t)}catch{return{error:!0}}}function me(t){let e=t.split(",");console.warn(e.length);let n=0;for(let r of e){let o=parseInt(r.match(/\D+|\d+/g)[0]),i=r.match(/\D+|\d+/g)[1];i=="y"&&(n=n+317098e-16*o),i=="w"&&(n=n+6048e5*o),i=="d"&&(n=n+864e5*o),i=="h"&&(n=n+36e5*o),i=="m"&&(n=n+6e4*o),i=="s"&&(n=n+1e3*o),i=="ms"&&(n=n+o)}return n}function nt(t){let e=t%1e3/100,n=Math.floor(t/1e3%60),r=Math.floor(t/(1e3*60)%60),o=Math.floor(t/(1e3*60*60)%24);return o=o<10?"0"+o:o,r=r<10?"0"+r:r,n=n<10?"0"+n:n,o+":"+r+":"+n+"."+e}function rt(t){return new Te(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z))}var u=class{static compress(e){return e}static decompress(e){return e}static createEntity(e,n){let r=_.overworld.spawnEntity(j,Ce);r.setDynamicProperty("name",e),r.setDynamicProperty("index",n);let o=r.getComponent("inventory").container,i=new Qt(en.acaciaBoat,1);return n==0&&(i.nameTag="{}"),o.setItem(0,i),r}static getInventorySlotName(e,n){return e.getComponent("inventory").container.getItem(n)?.nameTag}static setInventorySlotName(e,n,r){let o=e.getComponent("inventory").container,i=o.getItem(n);return i.nameTag=r,o.setItem(n,i)}constructor(e){this.name=e,this.savedEntitys=void 0,this.MEMORY=void 0}get entitys(){if(this.savedEntitys)return this.savedEntitys;let e=_.overworld.getEntitiesAtBlockLocation(Ce).filter(n=>n.typeId==j&&n.getDynamicProperty("name")==this.name);return this.savedEntitys=e,e}data(){if(this.MEMORY)return this.MEMORY;if(this.entitys.length==0&&u.createEntity(this.name,0),this.entitys.length==1){let n=JSON.parse(u.decompress(u.getInventorySlotName(this.entitys[0],0)));return this.MEMORY=n,n}let e=new Array(this.entitys.length);for(let n of this.entitys){let r=n.getDynamicProperty("index");e[r]=u.getInventorySlotName(n,0)}try{e=JSON.parse(e.join(""))}catch{e={}}return this.MEMORY=e,e}save(e){this.MEMORY=e;let n=qe(u.compress(JSON.stringify(e)),Ye);if(this.entitys&&n.length==this.entitys.length)for(let r=0;r<n.length;r++)u.setInventorySlotName(this.entitys[r],0,n[r]);else{this.entitys?.forEach(r=>r?.triggerEvent("despawn")),this.savedEntitys=void 0;for(let r=0;r<n.length;r++){let o=u.createEntity(this.name,r);u.setInventorySlotName(o,0,n[r])}}}set(e,n){let r=this.data();r[e]=n,this.save(r)}get(e){return this.data()[e]}has(e){return this.keys().includes(e)}delete(e){let n=this.data(),r=delete n[e];return this.save(n),r}size(){return this.keys().length}clear(){this.save({})}keys(){return Object.keys(this.data())}values(){return Object.values(this.data())}getCollection(){return this.data()}};var a={config:new u("config"),freezes:new u("freezes"),mutes:new u("mutes"),bans:new u("bans"),regions:new u("regions"),roles:new u("roles"),tasks:new u("tasks"),npcs:new u("npcs"),ids:new u("ids")};function ot(t){return[...tn.getPlayers()].find(e=>e.name===t)}var x=class{constructor(e="literal"){this.name=e;this.typeName="literal";this.name=e}matches(e){return{success:this.name==e}}fail(e){return`${e} should be ${this.name}!`}},H=class{constructor(e="string"){this.name=e;this.typeName="string";this.name=e}matches(e){return{success:e&&e!="",value:e}}fail(e){return"Value must be of type string!"}},Y=class{constructor(e="integer"){this.name=e;this.typeName="int";this.name=e}matches(e){return{success:!isNaN(e),value:parseInt(e)}}fail(e){return"Value must be vaild number!"}},Se=class{constructor(e="float"){this.name=e;this.typeName="float";this.name=e}matches(e){return{success:Boolean(e?.match(/^\d+\.\d+$/)?.[0]),value:parseInt(e)}}fail(e){return"Value must be vaild float!"}},M=class{constructor(e="location"){this.name=e;this.typeName="location";this.name=e}matches(e){return{success:/^([~^]{0,1}(-\d)?(\d*)?(\.(\d+))?)$/.test(e),value:e}}fail(e){return"Value needs to be a vaild number, value can include: [~,^]"}},q=class{constructor(e="boolean"){this.name=e;this.typeName="boolean";this.name=e}matches(e){return{success:Boolean(e?.match(/^(true|false)$/)?.[0]),value:e=="true"}}fail(e){return`"${e}" can be either "true" or "false"`}},Ee=class{constructor(e="player"){this.name=e;this.typeName="playerName";this.name=e}matches(e){return{success:!!ot(e),value:ot(e)}}fail(e){return`player: "${e}", is not in this world`}},Pe=class{constructor(e="target"){this.name=e;this.typeName="Target";this.name=e}matches(e){return{success:Boolean(e?.match(/^(@.|"[\s\S]+")$/)?.[0]),value:e}}fail(e){return`${e} is not a vaild target`}},K=class{constructor(e="array",n){this.name=e;this.types=n;this.typeName="string";this.name=e,this.types=n,this.typeName=n.join(" | ").replace(/(.{25})..+/,"$1...")}matches(e){return{success:this.types.includes(e),value:e}}fail(e){return`"${e}" must be one of these values: ${this.types.join(" | ")}`}},Ae=class{constructor(e){this.name=e;this.typeName="UnitValueType"}matches(e){return{success:/^(\d+[hdysmw],?)+$/.test(e),value:e}}fail(e){return`"${e}" must be a value like "10d" or "3s" the first part is the length second is unit}`}},xe=class{constructor(e="playerName"){this.name=e;this.typeName="playerName";this.name=e}matches(e){return{success:!!a.ids.get(e),value:e}}fail(e){return`player: "${e}" has never played this world before! Tip: if the name has spaces in it use quotes around name!`}},g={string:H,int:Y,float:Se,location:M,boolean:q,player:Ee,target:Pe,array:K,duration:Ae,playerName:xe};var ce=class{constructor(e){this.data=e,this.sender=e.sender}reply(e){this.sender.tell(e)}};function it(t,e){return t.slice(e.length).trim().match(/"[^"]+"|[^\s]+/g).map(n=>n.replace(/"(.+)"/,"$1").toString())}function at(t,e){t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.unknown",with:[`${e}`]}]})}function Re(t,e){t.tell({rawtext:[{text:e.data.invaildPermission?e.data.invaildPermission:`\xA7cYou do not have perrmission to use "${e.data.name}"`}]})}function st(t,e,n,r,o){if(t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.syntax",with:[`${w}${e.data.name} ${r.slice(0,o).join(" ")}`,r[o]??" ",r.slice(o+1).join(" ")]}]}),n.children.length>1){let i=n.children.map(s=>s.type instanceof x?s.type.name:s.type?.typeName);t.tell({rawtext:[{text:`\xA7c"${r[o]??" "}" can be: ${i.join(", ")}`}]})}else t.tell({rawtext:[{text:`\xA7c${n.children[0]?.type?.fail(r[o]??"undefined")}`}]})}function rn([t,e,n],{location:r,viewVector:o}){if(!t||!e||!t)return null;let i=[r.x,r.y,r.z],s=[o.x,o.y,o.z],m=[t,e,n].map(y=>{let d=parseInt(y.replace(/\D/g,""));return isNaN(d)?0:d}),f=[t,e,n].map((y,d)=>y.includes("~")?m[d]+i[d]:y.includes("^")?m[d]+s[d]:m[d]);return new nn(f[0],f[1],f[2])}function mt(t,e,n,r){let o=e[e.length-1]??r,i=[];for(let[s,m]of e.entries())if(!m.type.name.endsWith("*")){if(m.type instanceof M){i.push(rn([t[s],t[s+1],t[s+2]],n.sender));continue}m.type instanceof x||i.push(m.type.matches(t[s]).value??t[s])}o.callback(new ce(n),...i)}var A=[];on.events.beforeChat.subscribe(t=>{if(!t.message.startsWith(w))return;t.cancel=!0;let e=it(t.message,w),n=A.find(i=>i.depth==0&&(i.data.name==e[0]||i.data?.aliases?.includes(e[0])));if(!n)return at(t.sender,e[0]);if(!n.data?.requires(t.sender))return Re(t.sender,n);e.shift();let r=[],o=(i,s)=>{if(i.children.length>0){let m=i.children.find(f=>f.type.matches(e[s]).success);return!m&&!e[s]&&i.callback?void 0:m?m.data?.requires(t.sender)?(r.push(m),o(m,s+1)):(Re(t.sender,m),"fail"):(st(t.sender,n,i,e,s),"fail")}};o(n,0)||mt(e,r,t,n)});import{Player as fn,world as Me}from"@minecraft/server";var ct="rubedo:gui",J="rubedo:inventory";import{world as lt}from"@minecraft/server";var ft=new Map,W=class{constructor(e,n,r=!1,o=Date.now()){this.callbackTick=null,this.tickDelay=n,this.loop=r,this.callback=e,this.id=o,ft.set(o,this),this.TickCallBack=lt.events.tick.subscribe(({currentTick:i})=>{if(this.callbackTick||(this.callbackTick=i+this.tickDelay),!(this.callbackTick>i)){if(this.callback(i),!this.loop)return this.expire();this.callbackTick=i+this.tickDelay}})}expire(){lt.events.tick.unsubscribe(this.TickCallBack),ft.delete(this.id)}};var dt=t=>new Promise(e=>Ne(e,t));function Ne(t,e){new W(t,e)}function T(t,e){return new W(t,e,!0)}import{world as ht}from"@minecraft/server";var Be={},pt={},R={};function an(t,e,n){if(e.length!=n.length)return[];let r=[];for(let o=0;o<n.length;o++){if(e[o]?.item?.amount<n[o]?.item?.amount||e[o]?.item?.amount>n[o]?.item?.amount&&e[o]?.item?.amount!=0){let i={slot:o,uid:n[o].uid,oldUid:e[o].uid,item:n[o].item,oldItem:e[o].item,changeType:"fluctuation"};r.push(i),R[t.id]=i;continue}if(n[o].uid!=e[o].uid)if(e[o]?.item&&n[o]?.item){let i={slot:o,uid:n[o].uid,oldUid:e[o].uid,item:n[o].item,oldItem:e[o].item,changeType:"swap"};r.push(i),R[t.id]=i}else if(n[o]?.item){if(n[o]?.item)if(R[t.id]?.changeType=="delete"&&R[t.id]?.uid==n[o].uid){let i={slot:o,uid:n[o].uid,item:n[o].item,changeType:"move"};r.push(i),R[t.id]=i;continue}else{let i={slot:o,uid:n[o].uid,item:n[o].item,changeType:"put"};r.push(i),R[t.id]=i}}else{let i={slot:o,uid:e[o].uid,item:e[o].item,changeType:"delete"};r.push(i),R[t.id]=i}}return r}function sn(t){if(!t)return"";let e=[];return e.push(t.typeId),e.push(t.nameTag),e.push(t.data),e.push(t.getLore().join("")),e.join("")}function mn(t){let e=[];for(let n=0;n<t.size;n++){let r=t.getItem(n);e[n]={uid:sn(r),item:r}}return e}T(()=>{for(let t of Object.values(Be))for(let e of _.overworld.getEntities(t.entities)){let n=mn(e.getComponent("inventory").container),r=an(e,pt[e.id]??n,n);if(pt[e.id]=n,r.length!=0){if(e.hasTag("skipCheck")){e.removeTag("skipCheck"),delete R[e.id];continue}for(let o of r)t.callback(e,o)}}},5);var X=class{static subscribe(e,n){let r=Date.now();return Be[r]={callback:n,entities:e},r}static unsubscribe(e){delete Be[e]}};import{world as cn}from"@minecraft/server";var b=class{constructor(){this.data=new Map,this.events={playerLeave:cn.events.playerLeave.subscribe(e=>this.data.delete(e.playerName))}}set(e,n){this.data.set(e.name,n)}get(e){return this.data.get(e.name)}delete(e){this.data.delete(e.name)}clear(){this.data.clear()}playerNames(){return[...this.data.keys()]}};var N={},F={},Z=new b;function ut(t){return t.getComponent("minecraft:inventory").container.getItem(t.selectedSlot)}async function gt(t,e){try{let n=t.getComponent("minecraft:inventory").container,r=[];for(let o=0;o<n.size;o++){let i=n.getItem(o);!i||i?.typeId==e?.typeId&&(r.push({slot:o,item:i}),n.setItem,o<9?t.runCommand(`replaceitem entity @s slot.hotbar ${o} air`):t.runCommand(`replaceitem entity @s slot.inventory ${o-9} air`))}t.runCommand(`clear @s ${e?.typeId} ${e.data} ${e.amount}`);for(let o of r)n.setItem(o.slot,o.item)}catch{[...t.dimension.getEntities({type:"minecraft:item",location:t.location,maxDistance:2,closest:1})].forEach(r=>r.kill())}}function yt(t,e){return t.getComponent("minecraft:inventory").container.getItem(e)}var le=class{constructor(e,n,r){this.gui=e,this.slot=n,this.change=r}message(e){this.gui.player.tell(e)}getItemAdded(){return this.slot.item?null:this.gui.entity.getComponent("minecraft:inventory").container.getItem(this.change.slot)}GiveAction(e=this.slot.item.itemStack){this.gui.player.getComponent("minecraft:inventory").container.addItem(e)}TakeAction(e=null){this.gui.player.getComponent("minecraft:inventory").container.addItem(this.slot.item.itemStack),this.gui.page.slots[this.change.slot]=null,e&&e.delete(this.slot.item.components.dbKey)}PageAction(e,n){this.gui.setPage(e,n)}CloseAction(){this.gui.despawn()}SetAction(){this.gui.entity.getComponent("minecraft:inventory").container.setItem(this.change.slot,this.slot.item.itemStack)}async FormAction(e){return this.CloseAction(),await dt(5),await e.show(this.gui.player)}};var z=class{static spawnEntity(e){try{return e.dimension.spawnEntity(J,e.headLocation)}catch{return null}}constructor(e){this.player=e,this.entity=z.spawnEntity(e),this.entity&&(this.hasChestOpen=!1,this.setPage("home")),this.tickEvent=ht.events.tick.subscribe(()=>{if(!this.entity)return this.despawn();if(Z.get(this.player))this.hasChestOpen||(this.slotChangeEvent=X.subscribe({type:J},(n,r)=>{n.id==this.entity.id&&this.onSlotChange(r)})),this.hasChestOpen=!0;else try{this.entity.teleport(this.player.headLocation,this.player.dimension,0,0)}catch{this.despawn()}})}setPage(e,n){if(!Object.keys(F).includes(e))throw new Error(`pageId ${e} does not exist!`);let r=F[e];this.page=r,r.fillType(this.entity,r,n),this.entity.nameTag="size:54"}onSlotChange(e){let n=this.page.slots[e.slot];if(!n)this.entity.getComponent("inventory").container.setItem(e.slot,B);else if(e.changeType=="delete"){if(n.item&&gt(this.player,e.item),!n.item&&!yt(this.entity,e.slot))return;n.action(new le(this,n,e))}}despawn(){try{this.entity?.triggerEvent("despawn")}catch{}try{delete N[this.player.name]}catch{}this.tickEvent&&ht.events.tick.unsubscribe(this.tickEvent),this.slotChangeEvent&&X.unsubscribe(this.slotChangeEvent)}};import{ItemStack as ln}from"@minecraft/server";var h=class{constructor(e,n={},r){this.itemType=e,this.components=n,this.setItemStack=r}get itemStack(){if(this.setItemStack)return this.setItemStack;let e=new ln(this.itemType);if(this.components){e.amount=this.components?.amount??1,e.data=this.components?.data??0,e.nameTag=this.components?.nameTag,e.setLore(this.components?.loreList??[]);let n=e.getComponent("enchantments").enchantments;for(let r of this.components?.enchantments??[])n.addEnchantment(r);e.getComponent("enchantments").enchantments=n}return e}};function bt(t,e,n){let r=t.getComponent("minecraft:inventory").container;for(let o=0;o<r.size;o++){let i=e.slots[o];if(!i||!i.item){r.setItem(o,B);continue}r.setItem(o,i.item.itemStack)}}var L=class{constructor(e,n=bt){if(Object.keys(F).includes(e))throw new Error(`Page: ${e}, Already exists!`);this.id=e,this.fillType=n,this.slots=[],F[e]=this}setSlots(e,n,r){let o=n?{item:n,action:r}:null;for(let i of e)this.slots[i]=o;return this}};import{MinecraftItemTypes as Le}from"@minecraft/server";var Uo=new L("home").setSlots([0,1,2,3,4,5,6,7,8,9,17,18,26,27,35,36,44,45,46,47,48,50,51,52,53],new h(Le.stainedGlassPane,{data:15,nameTag:"\xA7r"}),t=>{t.SetAction()}).setSlots([22],new h(Le.enderChest,{nameTag:"\xA7l\xA7bInventory Viewer"}),t=>{t.PageAction("moderation:see")}).setSlots([54],new h(Le.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});Me.events.tick.subscribe(t=>{for(let e of Me.getPlayers()){if(ut(e)?.typeId!=ct){N[e.name]&&N[e.name].despawn();continue}Object.keys(N).includes(e?.name)||(N[e.name]=new z(e))}});Me.events.beforeDataDrivenEntityTriggerEvent.subscribe(t=>{t.entity instanceof fn&&(t.id=="rubedo:has_container_open"?Z.set(t.entity,!0):t.id=="rubedo:dosent_have_container_open"&&Z.set(t.entity,!1))});T(()=>{let t=Object.values(N).map(e=>e.entity.id);for(let e of _.overworld.getEntities({type:J}))t.includes(e.id)||e.triggerEvent("despawn")},100);var fe={"api.name":()=>"Smelly API","api.error.unknown":()=>"An unknown error has occured.","api.database.error.table_name":(t,e)=>`The display name ${t} is too long for an objective, it can be at most ${e} characters long`,"api.utilities.formatter.error.ms":t=>`${t} is not a string or a number`,"api.Providers.form.invaildtype":(t,e)=>`Type ${t} is not a vaild type to add a ${e}`,"api.Providers.form.invaildFormtype":(t,e)=>{`${t}${JSON.stringify(e)}`},"api.ChestGUI.error.pagenotfound":t=>`Page ${t} not found!`,"modules.protections.cps.clickingToFast":()=>"You are clicking to fast! Please click slower!","modules.managers.mute.isMuted":()=>"You are muted and cannot send messages please try again later","modules.commands.ban.reply":(t,e,n="")=>`\xA7cBanned \xA7f"\xA7a${t}\xA7f" \xA7cfor ${length} Because: "${n??"No reason Provided"}" \xA7aSuccessfully`};var l=class{constructor(e,n,r=0,o){this.data=e;this.type=n;this.depth=r;this.parent=o;e.requires||(e.requires=i=>!0),this.data=e,this.type=n??new x(this.data.name),this.children=[],this.depth=r,this.parent=o,this.callback=null,A.push(this)}argument(e){let n=new l(this.data,e,this.depth+1,this);return this.children.push(n),n}string(e){return this.argument(new H(e))}int(e){return this.argument(new Y(e))}array(e,n){return this.argument(new K(e,n))}boolean(e){return this.argument(new q(e))}location(e){let n=this.argument(new M(e));return e.endsWith("*")?n:n.location(e+"_y*").location(e+"_z*")}literal(e){let n=new l(e,new x(e.name),this.depth+1,this);return this.children.push(n),n}executes(e){return this.callback=e,this}};import{Player as _t}from"@minecraft/server";var k=class{constructor(e,n,r="No Reason",o="Smelly Anti Cheat"){let i=e instanceof _t?e.id:a.ids.get(e);if(!i)throw new Error(`"${e}" does not have a saved id!`);length=length?me(n):null;let s={key:i,playerName:e instanceof _t?e.name:e,date:Date.now(),length,expire:length?length+Date.now():null,reason:r,by:o};a.bans.set(i,s)}};function De(t,e,n,r,o){if(a.bans.get(a.ids.get(e)))return t.reply(`\xA7c${e} is already banned`);new k(e,n,r,t.sender.name),t.reply(fe["modules.commands.ban.reply"](e,n,r))}new l({name:"ban",description:"Bans a player for lengths",requires:t=>c(t)=="admin"}).argument(new g.playerName).executes((t,e)=>{De(t,e,null,null,t.sender.name)}).argument(new g.duration("duration")).executes((t,e,n)=>{De(t,e,n,null,t.sender.name)}).string("reason").executes((t,e,n,r)=>{De(t,e,n,r,t.sender.name)});var $e=new l({name:"database",description:"Interacts with SA Database",aliases:["db"],requires:t=>c(t)=="admin"});$e.literal({name:"get"}).string("table").string("key").executes((t,e,n)=>{try{let r=a[e].get(n);r?t.reply(r):t.reply(`No data could be found for key ${n}`)}catch(r){t.reply(r+r.stack)}});$e.literal({name:"set"}).string("table").string("key").string("value").executes((t,e,n,r)=>{try{a[e].set(n,r),t.reply(`Set Key: "${n}", to value: "${r}" on table: "${e}"`)}catch(o){t.reply(o+o.stack)}});$e.literal({name:"clear"}).string("table").executes((t,e)=>{try{a[e].clear(),t.reply(`Cleared Table ${e}`)}catch(n){t.reply(n+n.stack)}});new l({name:"ecwipe",description:"Clears a players ender chest",requires:t=>c(t)=="admin"}).argument(new g.player("player")).executes((t,e)=>{for(let n=0;n<27;n++)e.runCommand(`replaceitem entity @s slot.enderchest ${n} air`);t.reply(`Cleared ${e.name} Ender chest!`)});var de=class{constructor(e,n="No Reason"){let r={player:e.name,key:e.id,reason:n,location:{x:e.location.x,y:e.location.y,z:e.location.z,dimension:e.dimension.id}};a.freezes.set(e.id,r)}};new l({name:"freeze",description:"Freeze a player",requires:t=>c(t)=="admin"}).argument(new g.player("player")).string("reason").executes((t,e,n)=>{new de(e,n),t.reply(`\xA7cFroze \xA7f"\xA7a${e.name}\xA7f" Because: "${n}" \xA7aSuccessfully`),t.sender.tell(`\xA7cYou have been frozen by \xA7f"\xA7a${t.sender.name}\xA7f" Because: "${n}"`)});var Oe=class{constructor(e){this.name=e;this.typeName="CommandName"}matches(e){return{success:Boolean(A.find(n=>n.depth==0&&n.data.name==e)),value:e}}fail(e){return`"${e}" is not a vaild command`}};function dn(t,e,n){n.tell(`${w}${t.data.name} ${e.map(r=>r.type.typeName=="literal"?r.data.name:`<${r.type.name}: ${r.type.typeName}>`).join(" ")}`)}function pe(t,e,n,r){if(!e.data?.requires(r))return console.warn(`no perm ${e.data.name}`);if(e.callback&&dn(t,e.depth==0?n:n.concat(e),r),e.children.length>0)for(let o of e.children)pe(t,o,e.depth==0?n:n.concat(e),r)}function wt(t,e,n){t.tell({rawtext:[{text:`\xA72--- Showing help page ${e} of ${n} (${w}help <page: int>) ---`}]})}function It(t){let e=A.filter(n=>n.depth==0&&n.data?.requires(t));return e.length==0?0:Math.ceil(e.length/5)}var kt=new l({name:"help",description:"Provides help/list of commands.",aliases:["?","h"]}).executes(t=>{let e=It(t.sender),n=A.filter(r=>r.depth==0&&r.data?.requires(t.sender)).slice(1*5-5,1*5);wt(t.sender,1,e);for(let r of n)pe(r,r,[],t.sender)});kt.int("page").executes((t,e)=>{let n=It(t.sender);e>n&&(e=n);let r=A.filter(o=>o.depth==0&&o.data?.requires(t.sender)).slice(e*5-5,e*5);wt(t.sender,e,n);for(let o of r)pe(o,o,[],t.sender)});kt.argument(new Oe("command")).executes((t,e)=>{let n=A.filter(r=>r.depth==0&&r.data.name==e)[0];pe(n,n,[],t.sender)});var S=class{static getMuteData(e){return a.mutes.get(e.name)}constructor(e,n,r="No Reason",o="Smelly Anti Cheat"){e.runCommand("ability @s mute true");let i=n?me(n):null,s={player:e.name,date:Date.now(),duration:i,expire:i?i+Date.now():null,reason:r,by:o};a.mutes.set(e.name,s)}};new l({name:"mute",description:"Mute a player for lengths",requires:t=>["admin","moderator"].includes(c(t))}).argument(new g.player("player")).argument(new g.duration("duration")).string("reason").executes((t,e,n,r)=>{new S(e,n,r,t.sender.name),t.reply(`\xA7cMuted \xA7f"\xA7a${e.name}\xA7f" \xA7cfor ${n} Because: "${r}" \xA7aSuccessfully`),e.tell(`\xA7cYou have been muted by \xA7f"${t.sender.name}" \xA7cfor ${n} Because: "${r}"`)});var G=class{static isVaild(e){return e.typeId!="minecraft:npc"?!1:ue.find(n=>n.equals(e.location))?!0:!!a.npcs.keys().find(n=>e.id==n)}constructor(e,n){ue.push(e);let r=n.spawnEntity("minecraft:npc",e),o={dimension:r.dimension.id,x:r.location.x,y:r.location.y,z:r.location.z};a.npcs.set(r.id,o),Ct()}};new l({name:"npc",description:"Spawns a npc at your coordinates",requires:t=>c(t)=="admin"}).executes(t=>{new G(t.sender.location,t.sender.dimension),t.reply("Spawned a verifed npc at your current location")});import{world as vt}from"@minecraft/server";new l({name:"ping",description:"Returns the current TPS of the servers ping"}).executes(t=>{let e=vt.events.tick.subscribe(({deltaTime:n})=>{t.reply(`Pong! Current TPS: ${1/n}`),vt.events.tick.unsubscribe(e)})});import{BlockLocation as Q}from"@minecraft/server";var ee=new l({name:"region",description:"Create a Region",requires:t=>c(t)=="admin"});ee.literal({name:"add",description:"Adds a new protection region"}).int("from_x").int("from_z").int("to_x").int("to_z").executes((t,e,n,r,o)=>{new p({x:e,z:n},{x:r,z:o},t.sender.dimension.id),t.reply(`Created Region From ${e} -64 ${n} ${r} 320 ${o}`)});ee.literal({name:"remove",description:"Removes a region at the players current postion"}).executes(t=>{let e=new Q(t.sender.location.x,t.sender.location.y,t.sender.location.z);p.removeRegionAtBlockLocation(e,t.sender.dimension.id)?t.reply(`Removed Region at ${e.x} ${e.y} ${e.z}`):t.reply(`Failed to find/remove region at ${e.x} ${e.y} ${e.z}`)});ee.literal({name:"removeAll",description:"Removes all regions"}).executes(t=>{p.getAllRegions().forEach(e=>e.delete()),t.reply("Removed All regions")});ee.literal({name:"list",description:"Lists all regions and positions"}).executes(t=>{let e=p.getAllRegions();for(let n of e)t.reply(`Region from ${n.from.x}, ${n.from.z} to ${n.to.x}, ${n.to.z} in dimension ${n.dimensionId}`);if(e.length==0)return t.reply("No regions have been made yet")});var Fe=ee.literal({name:"permission",description:"Handels permissions for regions"});Fe.literal({name:"set",description:"Sets a certin permission on the region the player is currently in to a value"}).array("key",["doorsAndSwitches","openContainers","pvp"]).boolean("value").executes((t,e,n)=>{let r=p.blockLocationInRegion(new Q(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!r)return t.reply("You are not in a region");r.changePermission(e,n),t.reply(`Changed permision ${e} to ${n}`)});Fe.literal({name:"list",description:"Lists the permissions for the current region"}).executes(t=>{let e=p.blockLocationInRegion(new Q(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!e)return t.reply("You are not in a region");t.reply(`Current region permissions ${JSON.stringify(e.permissions)}`)});var Tt=Fe.literal({name:"entities",description:"Holds the subCommands for adding or removing allowedEntitys"});Tt.literal({name:"add",description:"Adds a entity to the allowed entitys list"}).string("entity").executes((t,e)=>{let n=p.blockLocationInRegion(new Q(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let r=n.permissions.allowedEntitys;r.push(e),n.changePermission("allowedEntitys",r),t.reply(`Added entity ${e} to the allowed entitys of the region your currently standing in`)});Tt.literal({name:"remove",description:"Removes a entity from the allowed entitys in the region"}).string("entity").executes((t,e)=>{let n=p.blockLocationInRegion(new Q(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let r=n.permissions.allowedEntitys;if(!r.includes(e))return t.reply(`The entity ${e} is not allowed to enter the region`);r=r.filter(o=>o!=e),n.changePermission("allowedEntitys",r),t.reply(`Removed entity ${e} to the allowed entitys of the region your currently standing in`)});import{world as pn}from"@minecraft/server";var ze=(o=>(o[o.member=0]="member",o[o.admin=1]="admin",o[o.moderator=2]="moderator",o[o.builder=3]="builder",o))(ze||{});var un=t=>isNaN(Number(t))===!1;function gn(t){return Object.keys(t).filter(un).map(e=>t[e])}var St=new l({name:"role",description:"Changes the role for a player",requires:t=>c(t)=="admin"||pn.getDynamicProperty("worldsOwner")==t.id});St.literal({name:"set",description:"Sets the role for a player"}).argument(new g.playerName("playerName")).argument(new g.array("role",gn(ze))).executes((t,e,n)=>{O(e,n),t.reply(`Changed role of ${e} to ${n}`)});St.literal({name:"get",description:"Gets the role of a player"}).argument(new g.playerName("playerName")).executes((t,e)=>{t.reply(`${e} has role: ${c(e)}`)});import{ActionFormData as yn}from"@minecraft/server-ui";var V=class{constructor(e,n){this.title=e,this.body=n,this.form=new yn,e&&this.form.title(e),n&&this.form.body(n),this.buttons=[],this.triedToShow=0}addButton(e,n=null,r){return this.buttons.push({text:e,iconPath:n,callback:r}),this.form.button(e,n),this}show(e){this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e)}return}this.buttons[n.selection].callback?.()})}};import{ItemTypes as _n,MinecraftBlockTypes as wn}from"@minecraft/server";var Et="2.4.7-beta";var ge="https://discord.gg/dMa3A5UYKX";var ne={aquaAffinity:1,baneOfArthropods:5,binding:1,blastProtection:4,channeling:1,depthStrider:3,efficiency:5,featherFalling:4,fireAspect:2,fireProtection:4,flame:1,fortune:3,frostWalker:2,impaling:5,infinity:1,knockback:2,looting:3,loyalty:4,luckOfTheSea:3,lure:3,mending:1,multishot:1,piercing:4,power:5,projectileProtection:4,protection:4,punch:2,quickCharge:3,respiration:3,riptide:3,sharpness:5,silkTouch:1,smite:5,soulSpeed:3,swiftSneak:4,thorns:3,unbreaking:3,vanishing:1};var re=["minecraft:beehive","minecraft:bee_nest","minecraft:acacia_standing_sign","minecraft:acacia_wall_sign","minecraft:agent_spawn_egg","minecraft:allay_spawn_egg","minecraft:allow","minecraft:axolotl_bucket","minecraft:axolotl_spawn_egg","minecraft:balloon","minecraft:bamboo_sapling","minecraft:barrier","minecraft:barrier","minecraft:bat_spawn_egg","minecraft:bedrock","minecraft:bee_nest","minecraft:bee_spawn_egg","minecraft:beehive","minecraft:birch_standing_sign","minecraft:birch_wall_sign","minecraft:blackstone_double_slab","minecraft:blaze_spawn_egg","minecraft:border_block","minecraft:brewingstandblock","minecraft:bubble_column","minecraft:camera","minecraft:carrots","minecraft:cat_spawn_egg","minecraft:cave_spider_spawn_egg","minecraft:cave_vines","minecraft:cave_vines_body_with_berries","minecraft:chain_command_block","minecraft:chemical_heat","minecraft:chemistry_table","minecraft:chicken_spawn_egg","minecraft:client_request_placeholder_block","minecraft:cobbled_deepslate_double_slab","minecraft:cod_bucket","minecraft:cod_spawn_egg","minecraft:colored_torch","minecraft:colored_torch_bp","minecraft:colored_torch_rg","minecraft:command_block","minecraft:command_block_minecart","minecraft:compound","minecraft:compoundcreator","minecraft:cow_spawn_egg","minecraft:creeper_spawn_egg","minecraft:crimson_double_slab","minecraft:crimson_standing_sign","minecraft:crimson_wall_sign","minecraft:darkoak_standing_sign","minecraft:darkoak_wall_sign","minecraft:daylight_detector_inverted","minecraft:debug_stick","minecraft:deepslate_brick_double_slab","minecraft:deepslate_tile_double_slab","minecraft:deny","minecraft:dolphin_spawn_egg","minecraft:donkey_spawn_egg","minecraft:double_cut_copper_slab","minecraft:double_wooden_slab","minecraft:drowned_spawn_egg","minecraft:elder_guardian_spawn_egg","minecraft:end_gateway","minecraft:end_portal","minecraft:end_portal_frame","minecraft:enderman_spawn_egg","minecraft:endermite_spawn_egg","minecraft:evoker_spawn_egg","minecraft:exposed_double_cut_copper_slab","minecraft:fire","minecraft:flowing_lava","minecraft:flowing_water","minecraft:fox_spawn_egg","minecraft:frog_spawn_egg","minecraft:frosted_ice","minecraft:ghast_spawn_egg","minecraft:glow_squid_spawn_egg","minecraft:glow_stick","minecraft:glowingobsidian","minecraft:goat_spawn_egg","minecraft:guardian_spawn_egg","minecraft:hard_glass","minecraft:hard_glass_pane","minecraft:hard_stained_glass","minecraft:hard_stained_glass_pane","minecraft:hoglin_spawn_egg","minecraft:horse_spawn_egg","minecraft:husk_spawn_egg","minecraft:ice_bomb","minecraft:info_update","minecraft:info_update2","minecraft:invisible_bedrock","minecraft:invisiblebedrock","minecraft:item.acacia_door","minecraft:item.bed","minecraft:item.beetroot","minecraft:item.birch_door","minecraft:item.cake","minecraft:item.campfire","minecraft:item.cauldron","minecraft:item.chain","minecraft:item.crimson_door","minecraft:item.dark_oak_door","minecraft:item.flower_pot","minecraft:item.frame","minecraft:item.glow_frame","minecraft:item.hopper","minecraft:item.iron_door","minecraft:item.jungle_door","minecraft:item.kelp","minecraft:item.nether_sprouts","minecraft:item.nether_wart","minecraft:item.reeds","minecraft:item.skull","minecraft:item.soul_campfire","minecraft:item.spruce_door","minecraft:item.warped_door","minecraft:item.wheat","minecraft:item.wooden_door","minecraft:jigsaw","minecraft:jungle_standing_sign","minecraft:jungle_wall_sign","minecraft:lava","minecraft:lava_cauldron","minecraft:light_block","minecraft:lit_blast_furnace","minecraft:lit_deepslate_redstone_ore","minecraft:lit_furnace","minecraft:lit_redstone_lamp","minecraft:lit_redstone_ore","minecraft:lit_smoker","minecraft:llama_spawn_egg","minecraft:magma_cube_spawn_egg","minecraft:medicine","minecraft:melon_stem","minecraft:mob_spawner","minecraft:mooshroom_spawn_egg","minecraft:movingBlock","minecraft:moving_block","minecraft:movingblock","minecraft:mule_spawn_egg","minecraft:netherreactor","minecraft:npc_spawn","minecraft:npc_spawn_egg","minecraft:ocelot_spawn_egg","minecraft:oxidized_double_cut_copper_slab","minecraft:panda_spawn_egg","minecraft:parrot_spawn_egg","minecraft:phantom_spawn_egg","minecraft:pig_spawn_egg","minecraft:piglin_brute_spawn_egg","minecraft:piglin_spawn_egg","minecraft:pillager_spawn_egg","minecraft:piston_arm_collision","minecraft:piston_arm_collision","minecraft:pistonarmcollision","minecraft:polar_bear_spawn_egg","minecraft:polished_blackstone_brick_double_slab","minecraft:polished_blackstone_double_slab","minecraft:polished_deepslate_double_slab","minecraft:portal","minecraft:potatoes","minecraft:powder_snow","minecraft:powder_snow_bucket","minecraft:powered_comparator","minecraft:powered_repeater","minecraft:pufferfish_bucket","minecraft:pufferfish_spawn_egg","minecraft:pumpkin_stem","minecraft:rabbit_spawn_egg","minecraft:rapid_fertilizer","minecraft:ravager_spawn_egg","minecraft:real_double_stone_slab","minecraft:real_double_stone_slab2","minecraft:real_double_stone_slab3","minecraft:real_double_stone_slab4","minecraft:redstone_wire","minecraft:repeating_command_block","minecraft:reserved3","minecraft:reserved4","minecraft:reserved6","minecraft:salmon_bucket","minecraft:salmon_spawn_egg","minecraft:sea_turtle_spawn_egg","minecraft:sheep_spawn_egg","minecraft:shulker_spawn_egg","minecraft:silverfish_spawn_egg","minecraft:skeleton_horse_spawn_egg","minecraft:skeleton_spawn_egg","minecraft:slime_spawn_egg","minecraft:soul_fire","minecraft:soul_fire","minecraft:sparkler","minecraft:spawn_egg","minecraft:spawn_egg","minecraft:spawner","minecraft:spider_spawn_egg","minecraft:spruce_standing_sign","minecraft:spruce_wall_sign","minecraft:squid_spawn_egg","minecraft:standing_banner","minecraft:standing_sign","minecraft:stickyPistonArmCollision","minecraft:sticky_piston_arm_collision","minecraft:stonecutter","minecraft:stray_spawn_egg","minecraft:strider_spawn_egg","minecraft:structure_block","minecraft:structure_void","minecraft:tadpole_bucket","minecraft:tadpole_spawn_egg","minecraft:tripwire","minecraft:tropical_fish_bucket","minecraft:tropical_fish_spawn_egg","minecraft:underwater_torch","minecraft:unknown","minecraft:unlit_redstone_ore","minecraft:unpowered_comparator","minecraft:unpowered_repeater","minecraft:vex_spawn_egg","minecraft:villager_spawn_egg","minecraft:vindicator_spawn_egg","minecraft:wall_banner","minecraft:wall_sign","minecraft:wandering_trader_spawn_egg","minecraft:warden_spawn_egg","minecraft:warped_double_slab","minecraft:warped_standing_sign","minecraft:warped_wall_sign","minecraft:water","minecraft:waxed_double_cut_copper_slab","minecraft:waxed_exposed_double_cut_copper_slab","minecraft:waxed_oxidized_double_cut_copper_slab","minecraft:waxed_weathered_double_cut_copper_slab","minecraft:weathered_double_cut_copper_slab","minecraft:witch_spawn_egg","minecraft:wither_spawn_egg","minecraft:wolf_spawn_egg","minecraft:zoglin_spawn_egg","minecraft:zombie_horse_spawn_egg","minecraft:zombie_spawn_egg","minecraft:zombie_villager_spawn_egg","minecraft:zombified_piglin_spawn_egg"],oe=["minecraft:moving_block","minecraft:beehive","minecraft:beenest"],ye=["minecraft:chest","minecraft:trapped_chest"],D={x:7,y:7,z:7};import{ModalFormData as bn}from"@minecraft/server-ui";import{MessageFormData as hn}from"@minecraft/server-ui";var he=class{constructor(e,n){this.title=e,this.body=n,this.form=new hn,e&&this.form.title(e),n&&this.form.body(n),this.triedToShow=0}setButton1(e,n){return this.button1={text:e,callback:n},this.form.button1(e),this}setButton2(e,n){return this.button2={text:e,callback:n},this.form.button2(e),this}show(e){this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e)}return}n.selection==1&&this.button1?.callback?.(),n.selection==0&&this.button2?.callback?.()})}};var be=class{constructor(e,n,r){this.form=e,this.player=n,this.callback=r}error(e){new he("Error",e).setButton1("Return to form",()=>{this.form.show(this.player,this.callback)}).setButton2("Cancel",null).show(this.player)}};var C=class{constructor(e){this.title=e,this.form=new bn,e&&this.form.title(e),this.args=[],this.triedToShow=0}addDropdown(e,n,r){return this.args.push({type:"dropdown",options:n}),this.form.dropdown(e,n,r),this}addSlider(e,n,r,o,i){return this.args.push({type:"slider"}),this.form.slider(e,n,r,o,i),this}addToggle(e,n){return this.args.push({type:"toggle"}),this.form.toggle(e,n),this}addTextField(e,n,r){return this.args.push({type:"textField"}),this.form.textField(e,n,r),this}show(e,n){this.form.show(e).then(r=>{if(r.canceled){if(r.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e,n)}return}n(new be(this,e,n),...r.formValues.map((o,i)=>this.args[i].type=="dropdown"?this.args[i].options[o]:o))})}};function Pt(t){new C("Manage Banned Items").addDropdown("Add/Remove Item",["add","remove"],0).addTextField("Item Id","minecraft:string").show(t,(e,n,r)=>{if(!_n.get(r)?.id)return e.error(`\xA7c"${r}" is not a vaild item id, note: this item must be either a item in a behavior pack or a default minecraft item`);if(n=="add"){let o=a.config.get("banned_items")??re;if(o.includes(r))return e.error(`\xA7cItem "${r}" is already banned`);o.push(r),a.config.set("banned_items",o),t.tell(`Banned the item "${r}"`)}else{let o=a.config.get("banned_items")??re;if(!o.includes(r))return e.error(`\xA7cItem: "${r}" is not banned`);o=o.filter(i=>i!=r),a.config.set("banned_items",o),t.tell(`Removed Banned item "${r}"`)}})}function At(t){new C("Manage Banned Blocks").addDropdown("Add/Remove Block",["add","remove"],0).addTextField("Block Id","minecraft:barrier").show(t,(e,n,r)=>{if(!wn.get(r)?.id)return e.error(`\xA7c"${r}" is not a vaild block id, note: this item must be either a block in a behavior pack or a default minecraft block`);if(n=="add"){let o=a.config.get("banned_blocks")??oe;if(o.includes(r))return e.error(`\xA7cBlock "${r}" is already banned`);o.push(r),a.config.set("banned_blocks",r),t.tell(`Banned the block "${r}"`)}else{let o=a.config.get("banned_blocks")??oe;if(!o.includes(r))return e.error(`block: "${r}" is not banned`);o=o.filter(i=>i!=r),a.config.set("banned_blocks",r),t.tell(`Removed Banned block "${r}"`)}})}function xt(t){new C("Manage Enchantment Levels").addDropdown("Enchantment to change",Object.keys(ne),0).addTextField("Level (number)","5").show(t,(e,n,r)=>{if(isNaN(r))return e.error(`\xA7c"${r}" is not a number, please enter a value like, "3", "9", etc.`);let o=parseInt(r),i=a.config.get("enchantments")??ne;i[n]=o,a.config.set("enchantments",i),t.tell(`Set max level for ${n} to ${o}`)})}function Rt(t){new C("Manage Appeal Link").addTextField("Appeal Link",ge).show(t,(e,n)=>{a.config.set("appealLink",n),t.tell(`Changed the servers appeal link to ${n}`)})}function Nt(t){new V("Rubedo Settings").addButton("Anti Spam","textures/ui/permissions_op_crown.png",()=>{kn(t)}).addButton("Cbe","textures/blocks/sculk_shrieker_top.png",()=>{Cn(t)}).addButton("Gamemode","textures/blocks/barrier.png",()=>{vn(t)}).addButton("Nuker","textures/ui/Feedback.png",()=>{Tn(t)}).show(t)}function kn(t){let e=a.config.get("spam_config")??{repeatedMessages:!0,zalgo:!0,violationCount:0,permMutePlayer:!1};new C("Manage Spam Protection").addToggle("Ban Repeated Messages",e.repeatedMessages).addToggle("Ban Zalgo",e.zalgo).addSlider("Violation Count before ban (if ban is false this does nothing)",0,20,1,e.violationCount).addToggle("Perm Mute Player",e.permMutePlayer).show(t,(n,r,o,i,s)=>{a.config.set("spam_config",{repeatedMessages:r,zalgo:o,violationCount:i,permMutePlayer:s}),t.tell("Updated Spam Protection settings!")})}function Cn(t){let e=a.config.get("cbe_config")??{clearItem:!0,violationCount:0,banPlayer:!1};new C("Manage CBE Protection").addToggle("Clear Item",e.clearItem).addSlider("Violation Count before ban (if ban is false this does nothing)",0,20,1,e.violationCount).addToggle("Ban Player",e.banPlayer).show(t,(n,r,o,i)=>{a.config.set("cbe_config",{clearItem:r,violationCount:o,banPlayer:i}),t.tell("Updated CBE Protection settings!")})}function vn(t){let e=a.config.get("gamemode_config")??{setToSurvival:!0,clearPlayer:!0,violationCount:0,banPlayer:!1};new C("Manage Gamemode Protection").addToggle("Set to survival",e.setToSurvival).addToggle("Clear Player (Once this players gamemode has been switched back to survival should it clear the inventory?)",e.clearPlayer).addSlider("Violation Count before ban (if ban is false this does nothing)",0,20,1,e.violationCount).addToggle("Ban Player",e.banPlayer).show(t,(n,r,o,i,s)=>{a.config.set("gamemode_config",{setToSurvival:r,clearPlayer:o,violationCount:i,banPlayer:s}),t.tell("Updated Gamemode Protection settings!")})}function Tn(t){let e=a.config.get("nuker_data")??{violationCount:0,banPlayer:!1};new C("Manage Gamemode Protection").addSlider("Violation Count before ban (if ban is false this does nothing)",0,20,1,e.violationCount).addToggle("Ban Player",e.banPlayer).show(t,(n,r,o)=>{a.config.set("nuker_data",{violationCount:r,banPlayer:o}),t.tell("Updated Nuker Protection settings!")})}function Bt(t){new V("Rubedo Settings").addButton("Auto Mod","textures/ui/permissions_op_crown.png",()=>{Nt(t)}).addButton("Banned items","textures/blocks/sculk_shrieker_top.png",()=>{Pt(t)}).addButton("Banned blocks","textures/blocks/barrier.png",()=>{At(t)}).addButton("Enchantments","textures/items/book_enchanted.png",()=>{xt(t)}).addButton("Appeal Link","textures/ui/Feedback.png",()=>{Rt(t)}).show(t)}new l({name:"settings",description:"Opens up the settings menu for the player",requires:t=>["admin","moderator"].includes(c(t))}).executes(t=>{Bt(t.sender),t.sender.tell("\xA7aForm request sent, close chat to continue!")});import{world as Lt}from"@minecraft/server";new l({name:"vanish",description:"Toggles Vanish Mode on the sender",requires:t=>c(t)=="admin"}).boolean("say").executes((t,e)=>{if(t.sender.hasTag("spectator")){if(t.sender.runCommand("gamemode c"),t.sender.runCommand("event entity @s removeSpectator"),t.sender.removeTag("spectator"),!e)return;Lt.say({rawtext:[{translate:"multiplayer.player.joined",with:[`\xA7e${t.sender.name}`]}]})}else{if(t.sender.runCommand("gamemode spectator"),t.sender.runCommand("event entity @s addSpectator"),t.sender.addTag("spectator"),!e)return;Lt.say({rawtext:[{translate:"multiplayer.player.left",with:[`\xA7e${t.sender.name}`]}]})}});new l({name:"unban",description:"Unban a banned player",requires:t=>c(t)=="admin"}).argument(new g.playerName("playerName")).executes((t,e)=>{let n=a.bans.values().find(r=>r.playerName==e);if(!n)return t.reply(`${e} is not banned`);a.bans.delete(n.key)?t.reply(`\xA7a${e}\xA7r has been Unbanned!`):t.reply(`\xA7cFailed to unban ${e}`)});new l({name:"unfreeze",description:"Unfreeze a frozen player",requires:t=>c(t)=="admin"}).argument(new g.playerName("playerName")).executes((t,e)=>{let n=a.freezes.values().find(r=>r.player==e);if(!n)return t.reply(`${e} is not frozen`);a.freezes.delete(n.key),t.reply(`\xA7a${e}\xA7r has been UnFrozen!`)});new l({name:"unmute",description:"Unmutes a muted player",requires:t=>["admin","moderator"].includes(c(t))}).argument(new g.playerName("playerName")).executes((t,e)=>{let n=a.mutes.values().find(r=>r.player==e);if(!n)return t.reply(`${e} is not muted!`);a.mutes.delete(n.player);try{t.sender.runCommand(`ability "${e}" mute false`)}catch{}t.reply(`\xA7a${e}\xA7r has been UnMuted!`)});new l({name:"version",description:"Get Current Version",aliases:["v"]}).executes(t=>{t.reply(`Current Rubedo Version: ${Et}`)});I(t=>{try{let e=a.bans.get(t.id);if(!e)return;if(console.warn(t.name),e.expire&&e.expire<Date.now())return a.bans.delete(t.id);se(t,["\xA7cYou have been banned!",`\xA7aReason: \xA7f${e.reason}`,`\xA7fExpiry: \xA7b${e.expire?nt(e.length):"Forever"}`,`\xA7fAppeal at: \xA7b${a.config.get("appealLink")??ge}`],()=>{console.warn(new Error("Failed to kick player")),a.bans.delete(t.id)})}catch(e){console.warn(e+e.stack)}},20);import{Location as En}from"@minecraft/server";I(t=>{let e=a.freezes.get(t.id);!e||t.teleport(new En(e.location.x,e.location.y,e.location.z),_[e.location.dimension],0,0)},20);import{world as Pn}from"@minecraft/server";Pn.events.beforeChat.subscribe(t=>{if(t.message.startsWith(w))return;let e=S.getMuteData(t.sender);if(!!e){if(e.expire&&e.expire<Date.now())return a.mutes.delete(t.sender.name);t.cancel=!0,t.sender.tell(fe["modules.managers.mute.isMuted"]())}});import{BlockLocation as An,world as Ge}from"@minecraft/server";T(()=>{ae()},6e3);Ge.events.beforeItemUseOn.subscribe(t=>{if(["moderator","admin"].includes(c(t.source)))return;let e=p.blockLocationInRegion(t.blockLocation,t.source.dimension.id);if(!e)return;let n=t.source.dimension.getBlock(t.blockLocation);Je.includes(n.typeId)&&e.permissions.doorsAndSwitches||We.includes(n.typeId)&&e.permissions.openContainers||(t.cancel=!0)});Ge.events.beforeExplosion.subscribe(t=>{for(let e=0;e<t.impactedBlocks.length;e++){let n=t.impactedBlocks[e];if(p.blockLocationInRegion(n,t.dimension.id))return t.cancel=!0}});Ge.events.entityCreate.subscribe(t=>{let e=p.blockLocationInRegion(new An(t.entity.location.x,t.entity.location.y,t.entity.location.z),t.entity.dimension.id);!e||e.permissions.allowedEntitys.includes(t.entity.typeId)||(t.entity.teleport({x:0,y:-64,z:0},t.entity.dimension,0,0),t.entity.kill())});T(()=>{for(let t of p.getAllRegions())for(let e of _[t.dimensionId].getEntities({excludeTypes:t.permissions.allowedEntitys}))!t.entityInRegion(e)||(e.teleport({x:0,y:-64,z:0},e.dimension,0,0),e.kill())},100);I(t=>{for(let e of p.getAllRegions())e.entityInRegion(t)?(t.addTag("inRegion"),e.permissions.pvp||t.addTag("region-protected")):(t.removeTag("inRegion"),t.removeTag("region-protected"))},5);import{world as Ve}from"@minecraft/server";Ve.events.playerJoin.subscribe(({player:t})=>{let e=Ve.events.tick.subscribe(n=>{try{_.overworld.runCommand(`testfor @a[name="${t.name}"]`),Ve.events.tick.unsubscribe(e),S.getMuteData(t)&&t.runCommand("ability @s mute true"),t.hasTag("old")?t.addTag("old"):a.ids.set(t.name,t.id);let r=E.getPlayersRoleToSet(t.name);r&&O(t,r)}catch{}})});import{Items as xn,MinecraftItemTypes as v,world as Ue}from"@minecraft/server";var Mt=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],Rn=[10,11,12,13,14,15,16,19,20,21,22,23,24,25,28,29,30,31,32,33,34,37,38,39,40,41,42,43];function Nn(t,e,n){let r=t.getComponent("minecraft:inventory").container;for(let o=0;o<r.size;o++){let i=e.slots[o];if(!i||!i.item){r.setItem(o,B);continue}r.setItem(o,i.item.itemStack)}for(let[o,i]of[...Ue.getPlayers()].entries()){let s=Mt[o],m=new h(v.skull,{nameTag:i.name,data:3});r.setItem(s,m.itemStack),e.slots[s]={item:m,action:f=>{f.PageAction("moderation:see_inventory",{name:i.name})}}}}function Bn(t,e,n){let r=t.getComponent("minecraft:inventory").container;for(let f=0;f<r.size;f++){let y=e.slots[f];if(!y||!y.item){r.setItem(f,B);continue}r.setItem(f,y.item.itemStack)}let o=new h(v.enderChest,{nameTag:`\xA7eView \xA7f${n?.name}\xA7e Ender Chest
\xA7fNote: \xA7cThis will not grab \xA7lANY NBT!\xA7r`});r.setItem(49,o.itemStack),e.slots[49]={item:o,action:f=>{f.PageAction("moderation:see_ender_chest",{name:n.name})}};let i=[...Ue.getPlayers()].find(f=>f.name==n.name);if(!i)return;let s=i.getComponent("inventory").container,m=0;for(let f=0;f<s.size;f++){let y=s.getItem(f);if(!y)continue;let d=Mt[m];m++,r.setItem(d,y),e.slots[d]={item:new h(xn.get(y.typeId),{amount:y.amount,data:y.data},y),action:ke=>{f<9?i.runCommand(`replaceitem entity @s slot.hotbar ${f} air`):i.runCommand(`replaceitem entity @s slot.inventory ${f-9} air`),ke.GiveAction(),e.slots[d]={item:null,action:Kt=>{s.addItem(Kt.getItemAdded())}}}}}}function Ln(t,e,n){let r=t.getComponent("minecraft:inventory").container;for(let s=0;s<r.size;s++){let m=e.slots[s];if(!m||!m.item){r.setItem(s,B);continue}r.setItem(s,m.item.itemStack)}let o=[...Ue.getPlayers()].find(s=>s.name==n?.name);if(!o)return;let i=0;for(let s of Object.values(v))try{o.runCommand(`testfor @s[hasitem={item=${s.id},location=slot.enderchest}]`);let m=new h(s.id,{nameTag:"Note: \xA7l\xA7cThis is not the exzact item"}),f=Rn[i];r.setItem(f,m.itemStack),e.slots[f]={item:m,action:y=>{y.GiveAction(),e.slots[f]=null}},i++}catch{}}new L("moderation:see",Nn).setSlots([45,46,47,49,51,52,53],new h(v.stainedGlassPane,{nameTag:"\xA7r",data:15}),t=>{t.SetAction()}).setSlots([50],new h(v.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("home")}).setSlots([48],new h(v.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});new L("moderation:see_inventory",Bn).setSlots([45,46,47,49,51,52,53],new h(v.stainedGlassPane,{nameTag:"\xA7r",data:15}),t=>{t.SetAction()}).setSlots([50],new h(v.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("moderation:see")}).setSlots([48],new h(v.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});new L("moderation:see_ender_chest",Ln).setSlots([0,1,2,3,4,5,6,7,8,9,17,18,26,27,35,36,44,45,46,47,49,51,52,53],new h(v.stainedGlassPane,{nameTag:"\xA7r",data:15}),t=>{t.SetAction()}).setSlots([50],new h(v.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("moderation:see")}).setSlots([48],new h(v.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});import{ItemStack as Mn,MinecraftBlockTypes as Dn,MinecraftItemTypes as $n,world as $t}from"@minecraft/server";var On=new Mn($n.stick,0),Fn=["minecraft:command_block_minecart"],Dt=new b;I(t=>{let e=a.config.get("cbe_config")??{clearItem:!0,violationCount:0,banPlayer:!1},n=t.getComponent("inventory").container;for(let r=0;r<n.size;r++){let o=n.getItem(r);if(!o)continue;let i=()=>{console.warn(`[Protection: CBE]: ${t.name} Has a CBE item!`),e.clearItem&&t.getComponent("inventory").container.setItem(r,On);let d=(Dt.get(t)??0)+1;Dt.set(t,d),e.banPlayer&&d>=e.violationCount&&new k(t,null,null,"Cbe Detection")};if((a.config.get("banned_items")??re).includes(o.typeId))return i();let m=o.getComponent("enchantments").enchantments,f=a.config.get("enchantments")??ne,y=[];for(let d of m){let ke=f[d.type.id]??d.type.maxLevel;if(m.slot==0&&!m.canAddEnchantment(d)||d.level>ke||y.includes(d.type.id))return i();y.push(d.type.id)}}});$t.events.beforeDataDrivenEntityTriggerEvent.subscribe(({id:t,entity:e})=>{if(t!="minecraft:entity_spawned")return;let n=()=>{try{e.triggerEvent("despawn"),e.kill()}catch{e.kill()}};if(Fn.includes(e.typeId)||!G.isVaild(e))return n()});$t.events.blockPlace.subscribe(({block:t,player:e})=>{if(["moderator","admin"].includes(c(e)))return;(a.config.get("banned_blocks")??oe).includes(t.typeId)&&t.setType(Dn.air)});var je=32e4;I(t=>{(Math.abs(t.location.x)>je||Math.abs(t.location.y)>je||Math.abs(t.location.z)>je)&&new k(t,null,null,"Hacking: Crasher")});import{world as Ot}from"@minecraft/server";var _e=class{constructor(e,n,r){this.player=e,this.location=e.location,this.dimension=e.dimension,this.rotation=e.rotation,this.tick=n,this.storage=r,this.events={playerLeave:Ot.events.playerLeave.subscribe(({playerName:o})=>{o==this.player.name&&this.expire()})},this.storage.set(e,this)}back(){this.player.teleport(this.location,this.dimension,this.rotation.x,this.rotation.y)}update(){this.tick=U,this.location=this.player.location,this.dimension=this.player.dimension,this.rotation=this.player.rotation}expire(){this.storage.delete(this.player);for(let e in this.events)Ot.events[e].unsubscribe(this.events[e])}};var Ft=new b,zn=.9,Gn=20,Vn=!0,Un=["gliding","riding","levitating","swimming"];function jn(t){return t.getComponent("minecraft:inventory").container.getItem(t.selectedSlot)}I((t,{currentTick:e})=>{if(t.getTags().some(o=>Un.includes(o)))return;let n=()=>Ft.get(t)??new _e(t,e,Ft),r=Math.sqrt(t.velocity.x**2+t.velocity.z**2);if(t.hasTag("on_ground"))return n().update();if(!(r<zn)&&jn(t)?.typeId!="minecraft:trident"&&!(e-n().tick<Gn)&&(n().back(),Vn))try{t.runCommand("damage @s 4 fly_into_wall")}catch{}},20);import{GameMode as Hn,world as Yn}from"@minecraft/server";var qn=Hn.creative,zt=new b;T(()=>{let t=a.config.get("gamemode_config")??{setToSurvival:!0,clearPlayer:!0,violationCount:0,banPlayer:!1};for(let e of Yn.getPlayers({gameMode:qn})){if(["moderator","admin","builder"].includes(c(e)))continue;try{t.setToSurvival&&e.runCommand("gamemode s"),t.clearPlayer&&e.runCommand("clear @s")}catch{}let n=(zt.get(e)??0)+1;zt.set(e,n),t.banPlayer&&n>=t.violationCount&&new k(e,null,null,"Invaild Gamemode")}},20);import{world as Gt}from"@minecraft/server";var Kn=/^([\p{L}])([\p{L}\d\s#'()-_]{1,20})([\p{L}\d\)])$/isu,Jn="\xA7c\xA7k\xA7m\xA7A\xA7r\xA7cToolbox Gamer\xA7k\xA7mA\xA7r";Gt.events.playerJoin.subscribe(({player:t})=>{let e=t.name,n=()=>se(t,["\xA7cYou have been kicked!",`\xA7aReason: \xA7f'${e}' is Invalid`,"\xA7fThis Server requires you to have a valid gamertag!"]);if(e==Jn||!Kn.test(e)||[...Gt.getPlayers()].filter(r=>r.name==t.name).length>1)return n()});import{world as Xn,Location as Zn}from"@minecraft/server";import{world as Wn}from"@minecraft/server";var we=class{constructor(e){this.emptySlotsCount=e.emptySlotsCount,this.size=e.size,this.items=[];for(let n=0;n<this.size;n++)this.items[n]=e.getItem(n)}load(e){for(let n=0;n<e.size;n++)!this.items[n]||e.setItem(n,this.items[n])}};var Ie={};T(()=>{Ie={};for(let t of Wn.getPlayers()){let e=rt(t.location),n=e.offset(D.x,D.y,D.z),r=e.offset(-D.x,-D.y,-D.z);for(let o of n.blocksBetween(r)){if(o.y<-64)continue;let i=t.dimension.getBlock(o);!ye.includes(i.typeId)||(Ie[JSON.stringify(o)]=new we(i.getComponent("inventory").container))}}},100);var Vt=new b,Qn=70,er=["snow","lush_plants_replaceable","azalea_log_replaceable","minecraft:crop","fertilize_area"],tr=["minecraft:water","minecraft:flowing_water","minecraft:lava","minecraft:flowing_lava","minecraft:bedrock"],Ut=new b;Xn.events.blockBreak.subscribe(({block:t,brokenBlockPermutation:e,dimension:n,player:r})=>{if(["moderator","admin"].includes(c(r))||t.getTags().some(m=>er.includes(m)))return;let o=Vt.get(r);if(Vt.set(r,Date.now()),!o||tr.includes(t.typeId)||o<Date.now()-Qn)return;let i=a.config.get("nuker_data")??{violationCount:0,banPlayer:!1},s=(Ut.get(r)??0)+1;if(Ut.set(r,s),i.banPlayer&&s>=i.violationCount&&new k(r,null,null,"Using Nuker"),n.getBlock(t.location).setPermutation(e.clone()),ye.includes(e.type.id)){let m=Ie[JSON.stringify(t.location)];m&&m.load(t.getComponent("inventory").container)}Ne(()=>{[...n.getEntities({maxDistance:2,type:"minecraft:item",location:new Zn(t.location.x,t.location.y,t.location.z)})].forEach(m=>m.kill())},0)});import{world as nr}from"@minecraft/server";var jt=new b,Ht=new b;nr.events.beforeChat.subscribe(t=>{if(t.message.startsWith(w)||["admin","moderator"].includes(c(t.sender)))return;let e=a.config.get("spam_config")??{repeatedMessages:!0,zalgo:!0,violationCount:0,permMutePlayer:!1},n=()=>{let r=(Ht.get(t.sender)??0)+1;Ht.set(t.sender,r),e.permMutePlayer&&r>=e.violationCount&&new S(t.sender,null,null,"Reached Violation count")};if(e.repeatedMessages&&jt.get(t.sender)==t.message)return t.cancel=!0,n(),t.sender.tell("\xA7cRepeated message detected!");if(e.zalgo&&/%CC%/g.test(encodeURIComponent(t.message)))return t.cancel=!0,n(),t.sender.tell("\xA7cYou message contains some type of zalgo and cannot be sent!");jt.set(t.sender,t.message)});import{Player as rr,world as ie}from"@minecraft/server";var or=ie.events.beforeDataDrivenEntityTriggerEvent.subscribe(t=>{if(ie.getDynamicProperty("roleHasBeenSet"))return ie.events.beforeDataDrivenEntityTriggerEvent.unsubscribe(or);t.entity instanceof rr&&t.id=="rubedo:becomeAdmin"&&(O(t.entity,"admin"),ie.setDynamicProperty("roleHasBeenSet",!0),ie.setDynamicProperty("worldsOwner",t.entity.id),t.entity.tell("\xA7l\xA7cYou have been given admin, the function start will not work anymore!!!!"))});import{system as ir}from"@minecraft/server";ir.events.beforeWatchdogTerminate.subscribe(t=>{t.cancel=!0,console.warn(`WATCHDOG TRIED TO CRASH = ${t.terminateReason}`)});import{DynamicPropertiesDefinition as He,EntityTypes as ar,MinecraftEntityTypes as sr,world as qt}from"@minecraft/server";var Yt=[];qt.events.worldInitialize.subscribe(({propertyRegistry:t})=>{tt("tickingarea add 0 0 0 0 0 0 db true");let e=new He;e.defineString("name",30),e.defineNumber("index"),t.registerEntityTypeDynamicProperties(e,ar.get(j));let n=new He;n.defineString("role",30),t.registerEntityTypeDynamicProperties(n,sr.player);let r=new He;r.defineBoolean("roleHasBeenSet"),r.defineString("worldsOwner",100),t.registerWorldDynamicProperties(r);for(let o of Yt)qt.scoreboard.addObjective(o.objective,o.displayName??"")});console.warn("---- STARTING RUBEDO ----");var ue=[];function Ct(){ue=[]}var U=null,B=new mr(cr.stick,0);lr.events.tick.subscribe(t=>{U?U=U+1:U=t.currentTick});export{B as AIR,U as CURRENT_TICK,ue as NPC_LOCATIONS,Ct as clearNpcLocations};
//# sourceMappingURL=index.js.map
