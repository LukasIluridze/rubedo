import{ItemStack as Gn,MinecraftItemTypes as Vn,world as jn}from"@minecraft/server";import{world as Ot}from"@minecraft/server";var k="-";import{Location as Mt}from"@minecraft/server";import{world as Dt}from"@minecraft/server";function ze(t){return[...Dt.getPlayers()].find(e=>e.name===t)}var T=class{constructor(e="literal"){this.name=e;this.typeName="literal";this.name=e}matches(e){return{success:this.name==e}}fail(e){return`${e} should be ${this.name}!`}},Y=class{constructor(e="string"){this.name=e;this.typeName="string";this.name=e}matches(e){return{success:e&&e!="",value:e}}fail(e){return"Value must be of type string!"}},U=class{constructor(e="integer"){this.name=e;this.typeName="int";this.name=e}matches(e){return{success:!isNaN(e),value:parseInt(e)}}fail(e){return"Value must be vaild number!"}},ge=class{constructor(e="float"){this.name=e;this.typeName="float";this.name=e}matches(e){return{success:Boolean(e?.match(/^\d+\.\d+$/)?.[0]),value:parseInt(e)}}fail(e){return"Value must be vaild float!"}},N=class{constructor(e="location"){this.name=e;this.typeName="location";this.name=e}matches(e){return{success:/^([~^]{0,1}(-\d)?(\d*)?(\.(\d+))?)$/.test(e),value:e}}fail(e){return"Value needs to be a vaild number, value can include: [~,^]"}},H=class{constructor(e="boolean"){this.name=e;this.typeName="boolean";this.name=e}matches(e){return{success:Boolean(e?.match(/^(true|false)$/)?.[0]),value:e=="true"}}fail(e){return`"${e}" can be either "true" or "false"`}},ye=class{constructor(e="player"){this.name=e;this.typeName="playerName";this.name=e}matches(e){return{success:!!ze(e),value:ze(e)}}fail(e){return`player: "${e}", is not in this world`}},he=class{constructor(e="target"){this.name=e;this.typeName="Target";this.name=e}matches(e){return{success:Boolean(e?.match(/^(@.|"[\s\S]+")$/)?.[0]),value:e}}fail(e){return`${e} is not a vaild target`}},q=class{constructor(e="array",n){this.name=e;this.types=n;this.typeName="string";this.name=e,this.types=n,this.typeName=n.join(" | ").replace(/(.{25})..+/,"$1...")}matches(e){return{success:this.types.includes(e),value:e}}fail(e){return`"${e}" must be one of these values: ${this.types.join(" | ")}`}},be=class{constructor(e){this.name=e;this.typeName="UnitValueType";this.types=["years","yrs","weeks","days","hours","hrs","minutes","mins","seconds","secs","milliseconds","msecs","ms"]}matches(e){return this.types.includes(e)?{success:e&&e!="",value:e}:{success:!1}}fail(e){return`"${e}" must be one of these values: ${this.types.join(" | ")}`}},b={string:Y,int:U,float:ge,location:N,boolean:H,player:ye,target:he,array:q,unit:be};var ie=class{constructor(e){this.data=e,this.sender=e.sender}reply(e){this.sender.tell(e)}};function Fe(t,e){return t.slice(e.length).trim().match(/"[^"]+"|[^\s]+/g).map(n=>n.replace(/"(.+)"/,"$1").toString())}function Ge(t,e){t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.unknown",with:[`${e}`]}]})}function _e(t,e){t.tell({rawtext:[{text:e.data.invaildPermission?e.data.invaildPermission:`\xA7cYou do not have perrmission to use "${e.data.name}"`}]})}function Ve(t,e,n,r,i){if(t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.syntax",with:[`${k}${e.data.name} ${r.slice(0,i).join(" ")}`,r[i]??" ",r.slice(i+1).join(" ")]}]}),n.children.length>1){let o=n.children.map(a=>a.type instanceof T?a.type.name:a.type?.typeName);t.tell({rawtext:[{text:`\xA7c"${r[i]??" "}" can be: ${o.join(", ")}`}]})}else t.tell({rawtext:[{text:`\xA7c${n.children[0]?.type?.fail(r[i]??"undefined")}`}]})}function Bt([t,e,n],{location:r,viewVector:i}){if(!t||!e||!t)return null;let o=[r.x,r.y,r.z],a=[i.x,i.y,i.z],l=[t,e,n].map(f=>{let h=parseInt(f.replace(/\D/g,""));return isNaN(h)?0:h}),m=[t,e,n].map((f,h)=>f.includes("~")?l[h]+o[h]:f.includes("^")?l[h]+a[h]:l[h]);return new Mt(m[0],m[1],m[2])}function je(t,e,n,r){let i=e[e.length-1]??r,o=[];for(let[a,l]of e.entries())if(!l.type.name.endsWith("*")){if(l.type instanceof N){o.push(Bt([t[a],t[a+1],t[a+2]],n.sender));continue}l.type instanceof T||o.push(l.type.matches(t[a]).value??t[a])}i.callback(new ie(n),...o)}var C=[];Ot.events.beforeChat.subscribe(t=>{if(!t.message.startsWith(k))return;t.cancel=!0;let e=Fe(t.message,k),n=C.find(o=>o.depth==0&&(o.data.name==e[0]||o.data?.aliases?.includes(e[0])));if(!n)return Ge(t.sender,e[0]);if(!n.data?.requires(t.sender))return _e(t.sender,n);e.shift();let r=[],i=(o,a)=>{if(o.children.length>0){let l=o.children.find(m=>m.type.matches(e[a]).success);return!l&&!e[a]&&o.callback?void 0:l?l.data?.requires(t.sender)?(r.push(l),i(l,a+1)):(_e(t.sender,l),"fail"):(Ve(t.sender,n,o,e,a),"fail")}};i(n,0)||je(e,r,t,n)});import{Player as Zt,world as Te}from"@minecraft/server";var Ye="rubedo:gui",K="rubedo:inventory";import{world as E,Player as jt,BlockLocation as ke,MinecraftBlockTypes as Yt,MinecraftDimensionTypes as M}from"@minecraft/server";var L={"api.name":()=>"Smelly API","api.error.unknown":()=>"An unknown error has occured.","api.database.error.table_name":(t,e)=>`The display name ${t} is too long for an objective, it can be at most ${e} characters long`,"api.utilities.formatter.error.ms":t=>`${t} is not a string or a number`,"api.Providers.form.invaildtype":(t,e)=>`Type ${t} is not a vaild type to add a ${e}`,"api.Providers.form.invaildFormtype":(t,e)=>{`${t}${JSON.stringify(e)}`},"api.ChestGUI.error.pagenotfound":t=>`Page ${t} not found!`,"modules.protections.cps.clickingToFast":()=>"You are clicking to fast! Please click slower!","modules.managers.mute.isMuted":()=>"You are muted and cannot send messages please try again later","modules.commands.ban.reply":(t,e=0,n="",r="")=>`\xA7cBanned \xA7f"\xA7a${t}\xA7f" \xA7cfor ${e} ${n} Because: "${r??"No reason Provided"}" \xA7aSuccessfully`};import{BlockLocation as zt}from"@minecraft/server";var Ue=32e3,J="rubedo:database",Ie=new zt(0,-64,0);import{ItemStack as Ft,MinecraftItemTypes as Gt}from"@minecraft/server";function He(t,e){return t.match(new RegExp(".{1,"+e+"}","g"))}var d=class{static compress(e){return e}static decompress(e){return e}static createEntity(e,n){let r=y.overworld.spawnEntity(J,Ie);r.setDynamicProperty("name",e),r.setDynamicProperty("index",n);let i=r.getComponent("inventory").container,o=new Ft(Gt.acaciaBoat,1);return n==0&&(o.nameTag="{}"),i.setItem(0,o),r}static getInventorySlotName(e,n){return e.getComponent("inventory").container.getItem(n)?.nameTag}static setInventorySlotName(e,n,r){let i=e.getComponent("inventory").container,o=i.getItem(n);return o.nameTag=r,i.setItem(n,o)}constructor(e){this.name=e,this.savedEntitys=void 0,this.MEMORY=void 0}get entitys(){if(this.savedEntitys)return this.savedEntitys;let e=y.overworld.getEntitiesAtBlockLocation(Ie).filter(n=>n.typeId==J&&n.getDynamicProperty("name")==this.name);return this.savedEntitys=e,e}data(){if(this.MEMORY)return this.MEMORY;if(this.entitys.length==0&&d.createEntity(this.name,0),this.entitys.length==1){let n=JSON.parse(d.decompress(d.getInventorySlotName(this.entitys[0],0)));return this.MEMORY=n,n}let e=new Array(this.entitys.length);for(let n of this.entitys){let r=n.getDynamicProperty("index");e[r]=d.getInventorySlotName(n,0)}try{e=JSON.parse(e.join(""))}catch{e={}}return this.MEMORY=e,e}save(e){this.MEMORY=e;let n=He(d.compress(JSON.stringify(e)),Ue);if(this.entitys&&n.length==this.entitys.length)for(let r=0;r<n.length;r++)d.setInventorySlotName(this.entitys[r],0,n[r]);else{this.entitys?.forEach(r=>r?.triggerEvent("despawn")),this.savedEntitys=void 0;for(let r=0;r<n.length;r++){let i=d.createEntity(this.name,r);d.setInventorySlotName(i,0,n[r])}}}set(e,n){let r=this.data();r[e]=n,this.save(r)}get(e){return this.data()[e]}has(e){return this.keys().includes(e)}delete(e){let n=this.data(),r=delete n[e];return this.save(n),r}size(){return this.keys().length}clear(){this.save({})}keys(){return Object.keys(this.data())}values(){return Object.values(this.data())}getCollection(){return this.data()}};var s={config:new d("config"),freezes:new d("freezes"),mutes:new d("mutes"),bans:new d("bans"),regions:new d("regions"),roles:new d("roles"),tasks:new d("tasks"),npcs:new d("npcs"),ids:new d("ids")};var qe={doorsAndSwitches:!0,openContainers:!0,pvp:!1,allowedEntitys:["minecraft:player","minecraft:npc","minecraft:item"]},Ke=["minecraft:acacia_door","minecraft:acacia_trapdoor","minecraft:acacia_button","minecraft:birch_door","minecraft:birch_trapdoor","minecraft:birch_button","minecraft:crimson_door","minecraft:crimson_trapdoor","minecraft:crimson_button","minecraft:dark_oak_door","minecraft:dark_oak_trapdoor","minecraft:dark_oak_button","minecraft:jungle_door","minecraft:jungle_trapdoor","minecraft:jungle_button","minecraft:mangrove_door","minecraft:mangrove_trapdoor","minecraft:mangrove_button","minecraft:spruce_door","minecraft:spruce_trapdoor","minecraft:spruce_button","minecraft:warped_door","minecraft:warped_trapdoor","minecraft:warped_button","minecraft:wooden_door","minecraft:wooden_button","minecraft:trapdoor","minecraft:iron_door","minecraft:iron_trapdoor","minecraft:polished_blackstone_button","minecraft:lever"],Je=["minecraft:chest","minecraft:ender_chest","minecraft:barrel","minecraft:trapped_chest","minecraft:dispenser","minecraft:dropper","minecraft:furnace","minecraft:blast_furnace","minecraft:lit_furnace","minecraft:lit_blast_furnace","minecraft:hopper","minecraft:shulker_box","minecraft:undyed_shulker_box"];var we=[],Vt=!1,We=-64,Xe=320;function Qe(t,e,n){return n.every((r,i)=>r>=Math.min(t[i],e[i])&&r<=Math.max(t[i],e[i]))}var u=class{static getAllRegions(){if(Vt)return we;let e=s.regions.values().map(n=>new u(n.from,n.to,n.dimensionId,n.permissions,n.key));return e.forEach(n=>{we.push(n)}),e}static blockLocationInRegion(e,n){return this.getAllRegions().find(r=>r.dimensionId==n&&Qe([r.from.x,We,r.from.z],[r.to.x,Xe,r.to.z],[e.x,e.y,e.z]))}static removeRegionAtBlockLocation(e,n){let r=this.blockLocationInRegion(e,n);return r?s.regions.delete(r.key):!1}constructor(e,n,r,i,o){this.from=e,this.to=n,this.dimensionId=r,this.permissions=i??qe,this.key=o||Date.now().toString(),o||(this.update(),oe(),we.push(this))}update(){s.regions.set(this.key,{key:this.key,from:this.from,dimensionId:this.dimensionId,permissions:this.permissions,to:this.to})}delete(){return s.regions.delete(this.key)}entityInRegion(e){return this.dimensionId==e.dimension.id&&Qe([this.from.x,We,this.from.z],[this.to.x,Xe,this.to.z],[e.location.x,e.location.y,e.location.z])}changePermission(e,n){this.permissions[e]=n,this.update()}};var v=class{static getTasks(){return s.tasks.get("changePlayerRole")??[]}static getPlayersRoleToSet(e){return v.getTasks().find(r=>r.playerName==e)?.role}constructor(e,n){let r=v.getTasks();r.push({playerName:e,role:n}),s.tasks.set("changePlayerRole",r)}};var y={overworld:E.getDimension(M.overworld),nether:E.getDimension(M.nether),theEnd:E.getDimension(M.theEnd),"minecraft:overworld":E.getDimension(M.overworld),"minecraft:nether":E.getDimension(M.nether),"minecraft:the_end":E.getDimension(M.theEnd)};function se(t,e=[],n){try{t.runCommand(`kick "${t.nameTag}" \xA7r${e.join(`
`)}`),t.triggerEvent("kick")}catch(r){if(!/"statusCode":-2147352576/.test(r))return;n&&n()}}function p(t){return t instanceof jt?s.roles.get(t.name)??"member":s.roles.get(t)??"member"}function B(t,e){if(typeof t=="string"){s.roles.set(t,e);let n=[...E.getPlayers()].find(r=>r.name==t);n?n.setDynamicProperty("role",e):new v(t,e)}else s.roles.set(t.name,e),t.setDynamicProperty("role",e)}function oe(){for(let t of u.getAllRegions()){let e=new ke(t.from.x,-64,t.from.z),n=new ke(t.to.x,-64,t.to.z);for(let r of e.blocksBetween(n))y[t.dimensionId].getBlock(r)?.setType(Yt.deny)}}var Ze=[];function _(t,e=0){Ze.push({callback:t,delay:e,lastCall:0})}E.events.tick.subscribe(t=>{let e=[...E.getPlayers()];for(let[n,r]of e.entries()){if(["moderator","admin"].includes(p(r)))return;for(let i of Ze)i.delay!=0&&t.currentTick-i.lastCall<i.delay||(i.callback(r,t),n==e.length-1&&(i.lastCall=t.currentTick))}});function et(t,e="overworld",n=!1){try{return n?console.warn(JSON.stringify(this.runCommand(t))):y.overworld.runCommand(t)}catch{return{error:!0}}}function O(t,{compactDuration:e,fullDuration:n,avoidDuration:r}={}){try{if(typeof t=="string"){if(/^\d+$/.test(t))return Number(t);let i=t.match(/-?\d*\.?\d+\s*?(years?|yrs?|weeks?|days?|hours?|hrs?|minutes?|mins?|seconds?|secs?|milliseconds?|msecs?|ms|[smhdwy])/gi);return i?i.reduce((o,a)=>o+Ut(a),0):null}if(typeof t=="number")return Ht(t,{compactDuration:e,fullDuration:n,avoidDuration:r});throw new Error(L["api.utilities.formatter.error.ms"](t))}catch(i){let o=qt(i)?`${i.message}. Value = ${JSON.stringify(t)}`:L["api.error.unknown"]();throw new Error(o)}}function Ut(t){let e=Number(t.replace(/[^-.0-9]+/g,""));return t=t.replace(/\s+/g,""),/\d+(?=y)/i.test(t)?e*3154e7:/\d+(?=w)/i.test(t)?e*6048e5:/\d+(?=d)/i.test(t)?e*864e5:/\d+(?=h)/i.test(t)?e*36e5:/\d+(?=m)/i.test(t)?e*6e4:/\d+(?=s)/i.test(t)?e*1e3:/\d+(?=ms|milliseconds?)/i.test(t)?e:0}function Ht(t,{compactDuration:e,fullDuration:n,avoidDuration:r}={}){let i=Math.abs(t),a=[{short:"w",long:"week",duration:Math.floor(i/6048e5)},{short:"d",long:"day",duration:Math.floor(i/864e5)%7},{short:"h",long:"hour",duration:Math.floor(i/36e5)%24},{short:"m",long:"minute",duration:Math.floor(i/6e4)%60},{short:"s",long:"second",duration:Math.floor(i/1e3)%60},{short:"ms",long:"millisecond",duration:i%1e3}].filter(m=>m.duration!==0&&r?n&&!r.map(f=>f.toLowerCase()).includes(m.short):m.duration).map(m=>`${Math.sign(t)===-1?"-":""}${e?`${Math.floor(m.duration)}${m.short}`:`${Math.floor(m.duration)} ${m.long}${m.duration===1?"":"s"}`}`);return(n?a.join(e?" ":", "):a[0])||`${i}`}function qt(t){return typeof t=="object"&&t!==null&&"message"in t}function tt(t){return new ke(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z))}import{world as nt}from"@minecraft/server";var rt=new Map,W=class{constructor(e,n,r=!1,i=Date.now()){this.callbackTick=null,this.tickDelay=n,this.loop=r,this.callback=e,this.id=i,rt.set(i,this),this.TickCallBack=nt.events.tick.subscribe(({currentTick:o})=>{if(this.callbackTick||(this.callbackTick=o+this.tickDelay),!(this.callbackTick>o)){if(this.callback(o),!this.loop)return this.expire();this.callbackTick=o+this.tickDelay}})}expire(){nt.events.tick.unsubscribe(this.TickCallBack),rt.delete(this.id)}};var it=t=>new Promise(e=>Ce(e,t));function Ce(t,e){new W(t,e)}function w(t,e){return new W(t,e,!0)}import{world as ct}from"@minecraft/server";var ve={},ot={};function Kt(t,e){if(t.length!=e.length)return[];let n=[];for(let r=0;r<e.length;r++){if(t[r]?.item?.amount<e[r]?.item?.amount||t[r]?.item?.amount>e[r]?.item?.amount&&t[r]?.item?.amount!=0){n.push({slot:r,uid:e[r].uid,oldUid:t[r].uid,item:e[r].item,oldItem:t[r].item,moveType:"fluctuation"});continue}e[r].uid!=t[r].uid&&(t[r]?.item&&e[r]?.item?n.push({slot:r,uid:e[r].uid,oldUid:t[r].uid,item:e[r].item,oldItem:t[r].item,moveType:"swap"}):e[r]?.item?e[r]?.item&&n.push({slot:r,uid:e[r].uid,item:e[r].item,moveType:"put"}):n.push({slot:r,uid:t[r].uid,item:t[r].item,moveType:"delete"}))}return n}function Jt(t){if(!t)return"";let e=[];return e.push(t.typeId),e.push(t.nameTag),e.push(t.data),e.join("")}function Wt(t){let e=[];for(let n=0;n<t.size;n++){let r=t.getItem(n);e[n]={uid:Jt(r),item:r}}return e}w(()=>{for(let t of Object.values(ve))for(let e of y.overworld.getEntities(t.entities)){let n=Wt(e.getComponent("inventory").container),r=Kt(ot[e.id]??n,n);if(ot[e.id]=n,r.length!=0)for(let i of r)t.callback(e,i)}},5);var X=class{static subscribe(e,n){let r=Date.now();return ve[r]={callback:n,entities:e},r}static unsubscribe(e){delete ve[e]}};import{world as Xt}from"@minecraft/server";var S=class{constructor(){this.data=new Map,this.events={playerLeave:Xt.events.playerLeave.subscribe(e=>this.data.delete(e.playerName))}}set(e,n){this.data.set(e.name,n)}get(e){return this.data.get(e.name)}delete(e){this.data.delete(e.name)}clear(){this.data.clear()}playerNames(){return[...this.data.keys()]}};var A={},z={},Q=new S;function st(t){return t.getComponent("minecraft:inventory").container.getItem(t.selectedSlot)}async function at(t,e){try{let n=t.getComponent("minecraft:inventory").container,r=[];for(let i=0;i<n.size;i++){let o=n.getItem(i);!o||o?.typeId==e?.typeId&&(r.push({slot:i,item:o}),n.setItem,i<9?t.runCommand(`replaceitem entity @s slot.hotbar ${i} air`):t.runCommand(`replaceitem entity @s slot.inventory ${i-9} air`))}t.runCommand(`clear @s ${e?.typeId} ${e.data} ${e.amount}`);for(let i of r)n.setItem(i.slot,i.item)}catch{[...t.dimension.getEntities({type:"minecraft:item",location:t.location,maxDistance:2,closest:1})].forEach(r=>r.kill())}}function mt(t,e){return t.getComponent("minecraft:inventory").container.getItem(e)}var ae=class{constructor(e,n,r){this.gui=e,this.slot=n,this.change=r}message(e){this.gui.player.tell(e)}getItemAdded(){return this.slot.item?null:this.gui.entity.getComponent("minecraft:inventory").container.getItem(this.change.slot)}GiveAction(e=this.slot.item.itemStack){this.gui.player.getComponent("minecraft:inventory").container.addItem(e)}TakeAction(e=null){this.gui.player.getComponent("minecraft:inventory").container.addItem(this.slot.item.itemStack),this.gui.page.slots[this.change.slot]=null,e&&e.delete(this.slot.item.components.dbKey)}PageAction(e,n){this.gui.setPage(e,n)}CloseAction(){this.gui.despawn()}SetAction(){this.gui.entity.getComponent("minecraft:inventory").container.setItem(this.change.slot,this.slot.item.itemStack)}async FormAction(e){return this.CloseAction(),await it(5),await e.show(this.gui.player)}};var F=class{static spawnEntity(e){try{return e.dimension.spawnEntity(K,e.headLocation)}catch{return null}}constructor(e){this.player=e,this.entity=F.spawnEntity(e),this.entity&&(this.hasChestOpen=!1,this.setPage("home")),this.tickEvent=ct.events.tick.subscribe(()=>{if(!this.entity)return this.despawn();if(Q.get(this.player))this.hasChestOpen||(this.slotChangeEvent=X.subscribe({type:K},(n,r)=>{n.id==this.entity.id&&this.onSlotChange(r)})),this.hasChestOpen=!0;else try{this.entity.teleport(this.player.headLocation,this.player.dimension,0,0)}catch{this.despawn()}})}setPage(e,n){if(!Object.keys(z).includes(e))throw new Error(`pageId ${e} does not exist!`);let r=z[e];this.page=r,r.fillType(this.entity,r,n),this.entity.nameTag="size:54"}onSlotChange(e){let n=this.page.slots[e.slot];if(!n)this.entity.getComponent("inventory").container.setItem(e.slot,x);else if(e.moveType=="delete"){if(n.item&&at(this.player,e.item),!n.item&&!mt(this.entity,e.slot))return;n.action(new ae(this,n,e))}}despawn(){try{this.entity?.triggerEvent("despawn")}catch{}try{delete A[this.player.name]}catch{}this.tickEvent&&ct.events.tick.unsubscribe(this.tickEvent),this.slotChangeEvent&&X.unsubscribe(this.slotChangeEvent)}};import{ItemStack as Qt}from"@minecraft/server";var g=class{constructor(e,n={},r){this.itemType=e,this.components=n,this.setItemStack=r}get itemStack(){if(this.setItemStack)return this.setItemStack;let e=new Qt(this.itemType);if(this.components){e.amount=this.components?.amount??1,e.data=this.components?.data??0,e.nameTag=this.components?.nameTag,e.setLore(this.components?.loreList??[]);let n=e.getComponent("enchantments").enchantments;for(let r of this.components?.enchantments??[])n.addEnchantment(r);e.getComponent("enchantments").enchantments=n}return e}};function lt(t,e,n){let r=t.getComponent("minecraft:inventory").container;for(let i=0;i<r.size;i++){let o=e.slots[i];if(!o||!o.item){r.setItem(i,x);continue}r.setItem(i,o.item.itemStack)}}var R=class{constructor(e,n=lt){if(Object.keys(z).includes(e))throw new Error(`Page: ${e}, Already exists!`);this.id=e,this.fillType=n,this.slots=[],z[e]=this}setSlots(e,n,r){let i=n?{item:n,action:r}:null;for(let o of e)this.slots[o]=i;return this}};import{MinecraftItemTypes as Ee}from"@minecraft/server";var ki=new R("home").setSlots([0,1,2,3,4,5,6,7,8,9,17,18,26,27,35,36,44,45,46,47,48,50,51,52,53],new g(Ee.stainedGlassPane,{data:15,nameTag:"\xA7r"}),t=>{t.SetAction()}).setSlots([22],new g(Ee.enderChest,{nameTag:"\xA7l\xA7bInventory Viewer"}),t=>{t.PageAction("moderation:see")}).setSlots([54],new g(Ee.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});Te.events.tick.subscribe(t=>{for(let e of Te.getPlayers()){if(st(e)?.typeId!=Ye){A[e.name]&&A[e.name].despawn();continue}Object.keys(A).includes(e?.name)||(A[e.name]=new F(e))}});Te.events.beforeDataDrivenEntityTriggerEvent.subscribe(t=>{t.entity instanceof Zt&&(t.id=="rubedo:has_container_open"?Q.set(t.entity,!0):t.id=="rubedo:dosent_have_container_open"&&Q.set(t.entity,!1))});w(()=>{let t=Object.values(A).map(e=>e.entity.id);for(let e of y.overworld.getEntities({type:K}))t.includes(e.id)||e.triggerEvent("despawn")},100);var c=class{constructor(e,n,r=0,i){this.data=e;this.type=n;this.depth=r;this.parent=i;e.requires||(e.requires=o=>!0),this.data=e,this.type=n??new T(this.data.name),this.children=[],this.depth=r,this.parent=i,this.callback=null,C.push(this)}argument(e){let n=new c(this.data,e,this.depth+1,this);return this.children.push(n),n}string(e){return this.argument(new Y(e))}int(e){return this.argument(new U(e))}array(e,n){return this.argument(new q(e,n))}boolean(e){return this.argument(new H(e))}location(e){let n=this.argument(new N(e));return e.endsWith("*")?n:n.location(e+"_y*").location(e+"_z*")}literal(e){let n=new c(e,new T(e.name),this.depth+1,this);return this.children.push(n),n}executes(e){return this.callback=e,this}};import{Player as pt}from"@minecraft/server";var G=class{constructor(e,n,r,i="No Reason",o="Smelly Anti Cheat"){let a=e instanceof pt?e.id:s.ids.get(e);if(!a)throw new Error(`"${e}" does not have a saved id!`);n=n?O(`${n} ${r}`):null;let l={key:a,playerName:e instanceof pt?e.name:e,date:Date.now(),length:n,expire:n?n+Date.now():null,reason:i,by:o};s.bans.set(a,l)}};var Ae=class{constructor(e="playerName"){this.name=e;this.typeName="playerName";this.name=e}matches(e){return{success:!!s.ids.get(e),value:e}}fail(e){return`player: "${e}" has never played this world before!`}};function Se(t,e,n,r,i,o){if(s.bans.get(s.ids.get(e)))return t.reply(`\xA7c${e} is already banned`);new G(e,n,r,i,t.sender.name),t.reply(L["modules.commands.ban.reply"](e,n,r,i))}new c({name:"ban",description:"Bans a player for lengths",requires:t=>p(t)=="admin"}).argument(new Ae).executes((t,e)=>{Se(t,e,null,null,null,t.sender.name)}).argument(new b.int("length")).argument(new b.unit("unit")).executes((t,e,n,r)=>{Se(t,e,n,r,null,t.sender.name)}).string("reason").executes((t,e,n,r,i)=>{Se(t,e,n,r,i,t.sender.name)});var $={aquaAffinity:1,baneOfArthropods:5,binding:1,blastProtection:4,channeling:1,depthStrider:3,efficiency:5,featherFalling:4,fireAspect:2,fireProtection:4,flame:1,fortune:3,frostWalker:2,impaling:5,infinity:1,knockback:2,looting:3,loyalty:4,luckOfTheSea:3,lure:3,mending:1,multishot:1,piercing:4,power:5,projectileProtection:4,protection:4,punch:2,quickCharge:3,respiration:3,riptide:3,sharpness:5,silkTouch:1,smite:5,soulSpeed:3,swiftSneak:4,thorns:3,unbreaking:3,vanishing:1};var Z=["minecraft:beehive","minecraft:bee_nest","minecraft:acacia_standing_sign","minecraft:acacia_wall_sign","minecraft:agent_spawn_egg","minecraft:allay_spawn_egg","minecraft:allow","minecraft:axolotl_bucket","minecraft:axolotl_spawn_egg","minecraft:balloon","minecraft:bamboo_sapling","minecraft:barrier","minecraft:barrier","minecraft:bat_spawn_egg","minecraft:bedrock","minecraft:bee_nest","minecraft:bee_spawn_egg","minecraft:beehive","minecraft:birch_standing_sign","minecraft:birch_wall_sign","minecraft:blackstone_double_slab","minecraft:blaze_spawn_egg","minecraft:border_block","minecraft:brewingstandblock","minecraft:bubble_column","minecraft:camera","minecraft:carrots","minecraft:cat_spawn_egg","minecraft:cave_spider_spawn_egg","minecraft:cave_vines","minecraft:cave_vines_body_with_berries","minecraft:chain_command_block","minecraft:chemical_heat","minecraft:chemistry_table","minecraft:chicken_spawn_egg","minecraft:client_request_placeholder_block","minecraft:cobbled_deepslate_double_slab","minecraft:cod_bucket","minecraft:cod_spawn_egg","minecraft:colored_torch","minecraft:colored_torch_bp","minecraft:colored_torch_rg","minecraft:command_block","minecraft:command_block_minecart","minecraft:compound","minecraft:compoundcreator","minecraft:cow_spawn_egg","minecraft:creeper_spawn_egg","minecraft:crimson_double_slab","minecraft:crimson_standing_sign","minecraft:crimson_wall_sign","minecraft:darkoak_standing_sign","minecraft:darkoak_wall_sign","minecraft:daylight_detector_inverted","minecraft:debug_stick","minecraft:deepslate_brick_double_slab","minecraft:deepslate_tile_double_slab","minecraft:deny","minecraft:dolphin_spawn_egg","minecraft:donkey_spawn_egg","minecraft:double_cut_copper_slab","minecraft:double_wooden_slab","minecraft:drowned_spawn_egg","minecraft:elder_guardian_spawn_egg","minecraft:end_gateway","minecraft:end_portal","minecraft:end_portal_frame","minecraft:enderman_spawn_egg","minecraft:endermite_spawn_egg","minecraft:evoker_spawn_egg","minecraft:exposed_double_cut_copper_slab","minecraft:fire","minecraft:flowing_lava","minecraft:flowing_water","minecraft:fox_spawn_egg","minecraft:frog_spawn_egg","minecraft:frosted_ice","minecraft:ghast_spawn_egg","minecraft:glow_squid_spawn_egg","minecraft:glow_stick","minecraft:glowingobsidian","minecraft:goat_spawn_egg","minecraft:guardian_spawn_egg","minecraft:hard_glass","minecraft:hard_glass_pane","minecraft:hard_stained_glass","minecraft:hard_stained_glass_pane","minecraft:hoglin_spawn_egg","minecraft:horse_spawn_egg","minecraft:husk_spawn_egg","minecraft:ice_bomb","minecraft:info_update","minecraft:info_update2","minecraft:invisible_bedrock","minecraft:invisiblebedrock","minecraft:item.acacia_door","minecraft:item.bed","minecraft:item.beetroot","minecraft:item.birch_door","minecraft:item.cake","minecraft:item.campfire","minecraft:item.cauldron","minecraft:item.chain","minecraft:item.crimson_door","minecraft:item.dark_oak_door","minecraft:item.flower_pot","minecraft:item.frame","minecraft:item.glow_frame","minecraft:item.hopper","minecraft:item.iron_door","minecraft:item.jungle_door","minecraft:item.kelp","minecraft:item.nether_sprouts","minecraft:item.nether_wart","minecraft:item.reeds","minecraft:item.skull","minecraft:item.soul_campfire","minecraft:item.spruce_door","minecraft:item.warped_door","minecraft:item.wheat","minecraft:item.wooden_door","minecraft:jigsaw","minecraft:jungle_standing_sign","minecraft:jungle_wall_sign","minecraft:lava","minecraft:lava_cauldron","minecraft:light_block","minecraft:lit_blast_furnace","minecraft:lit_deepslate_redstone_ore","minecraft:lit_furnace","minecraft:lit_redstone_lamp","minecraft:lit_redstone_ore","minecraft:lit_smoker","minecraft:llama_spawn_egg","minecraft:magma_cube_spawn_egg","minecraft:medicine","minecraft:melon_stem","minecraft:mob_spawner","minecraft:mooshroom_spawn_egg","minecraft:movingBlock","minecraft:moving_block","minecraft:movingblock","minecraft:mule_spawn_egg","minecraft:netherreactor","minecraft:npc_spawn","minecraft:npc_spawn_egg","minecraft:ocelot_spawn_egg","minecraft:oxidized_double_cut_copper_slab","minecraft:panda_spawn_egg","minecraft:parrot_spawn_egg","minecraft:phantom_spawn_egg","minecraft:pig_spawn_egg","minecraft:piglin_brute_spawn_egg","minecraft:piglin_spawn_egg","minecraft:pillager_spawn_egg","minecraft:piston_arm_collision","minecraft:piston_arm_collision","minecraft:pistonarmcollision","minecraft:polar_bear_spawn_egg","minecraft:polished_blackstone_brick_double_slab","minecraft:polished_blackstone_double_slab","minecraft:polished_deepslate_double_slab","minecraft:portal","minecraft:potatoes","minecraft:powder_snow","minecraft:powder_snow_bucket","minecraft:powered_comparator","minecraft:powered_repeater","minecraft:pufferfish_bucket","minecraft:pufferfish_spawn_egg","minecraft:pumpkin_stem","minecraft:rabbit_spawn_egg","minecraft:rapid_fertilizer","minecraft:ravager_spawn_egg","minecraft:real_double_stone_slab","minecraft:real_double_stone_slab2","minecraft:real_double_stone_slab3","minecraft:real_double_stone_slab4","minecraft:redstone_wire","minecraft:repeating_command_block","minecraft:reserved3","minecraft:reserved4","minecraft:reserved6","minecraft:salmon_bucket","minecraft:salmon_spawn_egg","minecraft:sea_turtle_spawn_egg","minecraft:sheep_spawn_egg","minecraft:shulker_spawn_egg","minecraft:silverfish_spawn_egg","minecraft:skeleton_horse_spawn_egg","minecraft:skeleton_spawn_egg","minecraft:slime_spawn_egg","minecraft:soul_fire","minecraft:soul_fire","minecraft:sparkler","minecraft:spawn_egg","minecraft:spawn_egg","minecraft:spawner","minecraft:spider_spawn_egg","minecraft:spruce_standing_sign","minecraft:spruce_wall_sign","minecraft:squid_spawn_egg","minecraft:standing_banner","minecraft:standing_sign","minecraft:stickyPistonArmCollision","minecraft:sticky_piston_arm_collision","minecraft:stonecutter","minecraft:stray_spawn_egg","minecraft:strider_spawn_egg","minecraft:structure_block","minecraft:structure_void","minecraft:tadpole_bucket","minecraft:tadpole_spawn_egg","minecraft:tripwire","minecraft:tropical_fish_bucket","minecraft:tropical_fish_spawn_egg","minecraft:underwater_torch","minecraft:unknown","minecraft:unlit_redstone_ore","minecraft:unpowered_comparator","minecraft:unpowered_repeater","minecraft:vex_spawn_egg","minecraft:villager_spawn_egg","minecraft:vindicator_spawn_egg","minecraft:wall_banner","minecraft:wall_sign","minecraft:wandering_trader_spawn_egg","minecraft:warden_spawn_egg","minecraft:warped_double_slab","minecraft:warped_standing_sign","minecraft:warped_wall_sign","minecraft:water","minecraft:waxed_double_cut_copper_slab","minecraft:waxed_exposed_double_cut_copper_slab","minecraft:waxed_oxidized_double_cut_copper_slab","minecraft:waxed_weathered_double_cut_copper_slab","minecraft:weathered_double_cut_copper_slab","minecraft:witch_spawn_egg","minecraft:wither_spawn_egg","minecraft:wolf_spawn_egg","minecraft:zoglin_spawn_egg","minecraft:zombie_horse_spawn_egg","minecraft:zombie_spawn_egg","minecraft:zombie_villager_spawn_egg","minecraft:zombified_piglin_spawn_egg"],ee=["minecraft:moving_block","minecraft:beehive","minecraft:beenest"],me=["minecraft:chest","minecraft:trapped_chest"],D={x:7,y:7,z:7};var xe=new c({name:"config",description:"Opens up a form to configure rubedo",requires:t=>p(t)=="admin"}),ft=xe.literal({name:"banned",description:"Manages banned items/blocks on this server"}),dt=ft.literal({name:"items",description:"Manages the banned items on this server"});dt.literal({name:"add",description:"Adds a item to the banned items list"}).string("item").executes((t,e)=>{let n=s.config.get("banned_items")??Z;n.includes(e)||n.push(e),s.config.set("banned_items",n),t.reply(`Banned the item "${e}"`)});dt.literal({name:"remove",description:"Removes a item from the banned items list"}).string("item").executes((t,e)=>{let n=s.config.get("banned_items")??Z;if(!n.includes(e))return t.reply(`item: "${e}" is not banned`);n=n.filter(r=>r!=e),s.config.set("banned_items",n),t.reply(`Removed Banned item "${e}"`)});var ut=ft.literal({name:"blocks",description:"Manages the banned blocks on this server"});ut.literal({name:"add",description:"Adds a block to the banned blocks list"}).string("block").executes((t,e)=>{let n=s.config.get("banned_blocks")??ee;n.includes(e)||n.push(e),s.config.set("banned_blocks",e),t.reply(`Banned the block "${e}"`)});ut.literal({name:"remove",description:"Removes a block from the banned blocks list"}).string("block").executes((t,e)=>{let n=s.config.get("banned_blocks")??ee;if(!n.includes(e))return t.reply(`block: "${e}" is not banned`);n=n.filter(r=>r!=e),s.config.set("banned_blocks",e),t.reply(`Removed Banned block "${e}"`)});var gt=xe.literal({name:"enchantments",description:"Manages the maxEnchants on this srrver"});gt.literal({name:"set",description:"Sets a enchantment to a level"}).array("enchantment",Object.keys($)).int("level").executes((t,e,n)=>{let r=s.config.get("enchantments")??$;r[e]=n,s.config.set("enchantments",r),t.reply(`Set max level for ${e} to ${n}`)});gt.literal({name:"get",description:"Gets the max level for a enchantment"}).array("enchantment",Object.keys($)).executes((t,e)=>{let n=s.config.get("enchantments")??$;t.reply(`Max level for ${e} is ${n[e]}`)});xe.literal({name:"setAppealLink",description:"Sets the appeal link for this server"}).string("link").executes((t,e)=>{s.config.set("appealLink",e),t.reply(`Changed the servers appeal link to ${e}`)});var Re=new c({name:"database",description:"Interacts with SA Database",aliases:["db"],requires:t=>p(t)=="admin"});Re.literal({name:"get"}).string("table").string("key").executes((t,e,n)=>{try{let r=s[e].get(n);r?t.reply(r):t.reply(`No data could be found for key ${n}`)}catch(r){t.reply(r+r.stack)}});Re.literal({name:"set"}).string("table").string("key").string("value").executes((t,e,n,r)=>{try{s[e].set(n,r),t.reply(`Set Key: "${n}", to value: "${r}" on table: "${e}"`)}catch(i){t.reply(i+i.stack)}});Re.literal({name:"clear"}).string("table").executes((t,e)=>{try{s[e].clear(),t.reply(`Cleared Table ${e}`)}catch(n){t.reply(n+n.stack)}});new c({name:"ecwipe",description:"Clears a players ender chest",requires:t=>p(t)=="admin"}).argument(new b.player("player")).executes((t,e)=>{for(let n=0;n<27;n++)e.runCommand(`replaceitem entity @s slot.enderchest ${n} air`);t.reply(`Cleared ${e.name} Ender chest!`)});var ce=class{constructor(e,n="No Reason"){let r={player:e.name,key:e.id,reason:n,location:{x:e.location.x,y:e.location.y,z:e.location.z,dimension:e.dimension.id}};s.freezes.set(e.id,r)}};new c({name:"freeze",description:"Freeze a player",requires:t=>p(t)=="admin"}).argument(new b.player("player")).string("reason").executes((t,e,n)=>{new ce(e,n),t.reply(`\xA7cFroze \xA7f"\xA7a${e.name}\xA7f" Because: "${n}" \xA7aSuccessfully`),t.sender.tell(`\xA7cYou have been frozen by \xA7f"\xA7a${t.sender.name}\xA7f" Because: "${n}"`)});var Pe=class{constructor(e){this.name=e;this.typeName="CommandName"}matches(e){return{success:Boolean(C.find(n=>n.depth==0&&n.data.name==e)),value:e}}fail(e){return`"${e}" is not a vaild command`}};function en(t,e,n){n.tell(`${k}${t.data.name} ${e.map(r=>r.type.typeName=="literal"?r.data.name:`<${r.type.name}: ${r.type.typeName}>`).join(" ")}`)}function le(t,e,n,r){if(!e.data?.requires(r))return console.warn(`no perm ${e.data.name}`);if(e.callback&&en(t,e.depth==0?n:n.concat(e),r),e.children.length>0)for(let i of e.children)le(t,i,e.depth==0?n:n.concat(e),r)}function yt(t,e,n){t.tell({rawtext:[{text:`\xA72--- Showing help page ${e} of ${n} (${k}help <page: int>) ---`}]})}function ht(t){let e=C.filter(n=>n.depth==0&&n.data?.requires(t));return e.length==0?0:Math.ceil(e.length/5)}var bt=new c({name:"help",description:"Provides help/list of commands.",aliases:["?","h"]}).executes(t=>{let e=ht(t.sender),n=C.filter(r=>r.depth==0&&r.data?.requires(t.sender)).slice(1*5-5,1*5);yt(t.sender,1,e);for(let r of n)le(r,r,[],t.sender)});bt.int("page").executes((t,e)=>{let n=ht(t.sender);e>n&&(e=n);let r=C.filter(i=>i.depth==0&&i.data?.requires(t.sender)).slice(e*5-5,e*5);yt(t.sender,e,n);for(let i of r)le(i,i,[],t.sender)});bt.argument(new Pe("command")).executes((t,e)=>{let n=C.filter(r=>r.depth==0&&r.data.name==e)[0];le(n,n,[],t.sender)});var P=class{static getMuteData(e){return s.mutes.get(e.name)}constructor(e,n,r,i="No Reason",o="Smelly Anti Cheat"){e.runCommand("ability @s mute true");let a=n?O(`${n} ${r}`):null,l={player:e.name,date:Date.now(),length:a,expire:a?a+Date.now():null,reason:i,by:o};s.mutes.set(e.name,l)}};new c({name:"mute",description:"Mute a player for lengths",requires:t=>["admin","moderator"].includes(p(t))}).argument(new b.player("player")).argument(new b.int("length")).argument(new b.unit("unit")).string("reason").executes((t,e,n,r,i)=>{new P(e,n,r,i,t.sender.name),t.reply(`\xA7cMuted \xA7f"\xA7a${e.name}\xA7f" \xA7cfor ${n} ${r} Because: "${i}" \xA7aSuccessfully`),e.tell(`\xA7cYou have been muted by \xA7f"${t.sender.name}" \xA7cfor ${n} ${r} Because: "${i}"`)});var V=class{static isVaild(e){return e.typeId!="minecraft:npc"?!1:pe.find(n=>n.equals(e.location))?!0:!!s.npcs.keys().find(n=>e.id==n)}constructor(e,n){pe.push(e);let r=n.spawnEntity("minecraft:npc",e),i={dimension:r.dimension.id,x:r.location.x,y:r.location.y,z:r.location.z};s.npcs.set(r.id,i),_t()}};new c({name:"npc",description:"Spawns a npc at your coordinates",requires:t=>p(t)=="admin"}).executes(t=>{new V(t.sender.location,t.sender.dimension),t.reply("Spawned a verifed npc at your current location")});import{world as It}from"@minecraft/server";new c({name:"ping",description:"Returns the current TPS of the servers ping"}).executes(t=>{let e=It.events.tick.subscribe(({deltaTime:n})=>{t.reply(`Pong! Current TPS: ${1/n}`),It.events.tick.unsubscribe(e)})});import{BlockLocation as te}from"@minecraft/server";var ne=new c({name:"region",description:"Create a Region",requires:t=>p(t)=="admin"});ne.literal({name:"add",description:"Adds a new protection region"}).int("from_x").int("from_z").int("to_x").int("to_z").executes((t,e,n,r,i)=>{new u({x:e,z:n},{x:r,z:i},t.sender.dimension.id),t.reply(`Created Region From ${e} -64 ${n} ${r} 320 ${i}`)});ne.literal({name:"remove",description:"Removes a region at the players current postion"}).executes(t=>{let e=new te(t.sender.location.x,t.sender.location.y,t.sender.location.z);u.removeRegionAtBlockLocation(e,t.sender.dimension.id)?t.reply(`Removed Region at ${e.x} ${e.y} ${e.z}`):t.reply(`Failed to find/remove region at ${e.x} ${e.y} ${e.z}`)});ne.literal({name:"removeAll",description:"Removes all regions"}).executes(t=>{u.getAllRegions().forEach(e=>e.delete()),t.reply("Removed All regions")});ne.literal({name:"list",description:"Lists all regions and positions"}).executes(t=>{let e=u.getAllRegions();for(let n of e)t.reply(`Region from ${n.from.x}, ${n.from.z} to ${n.to.x}, ${n.to.z} in dimension ${n.dimensionId}`);if(e.length==0)return t.reply("No regions have been made yet")});var Ne=ne.literal({name:"permission",description:"Handels permissions for regions"});Ne.literal({name:"set",description:"Sets a certin permission on the region the player is currently in to a value"}).array("key",["doorsAndSwitches","openContainers","pvp"]).boolean("value").executes((t,e,n)=>{let r=u.blockLocationInRegion(new te(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!r)return t.reply("You are not in a region");r.changePermission(e,n),t.reply(`Changed permision ${e} to ${n}`)});Ne.literal({name:"list",description:"Lists the permissions for the current region"}).executes(t=>{let e=u.blockLocationInRegion(new te(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!e)return t.reply("You are not in a region");t.reply(`Current region permissions ${JSON.stringify(e.permissions)}`)});var wt=Ne.literal({name:"entities",description:"Holds the subCommands for adding or removing allowedEntitys"});wt.literal({name:"add",description:"Adds a entity to the allowed entitys list"}).string("entity").executes((t,e)=>{let n=u.blockLocationInRegion(new te(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let r=n.permissions.allowedEntitys;r.push(e),n.changePermission("allowedEntitys",r),t.reply(`Added entity ${e} to the allowed entitys of the region your currently standing in`)});wt.literal({name:"remove",description:"Removes a entity from the allowed entitys in the region"}).string("entity").executes((t,e)=>{let n=u.blockLocationInRegion(new te(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let r=n.permissions.allowedEntitys;if(!r.includes(e))return t.reply(`The entity ${e} is not allowed to enter the region`);r=r.filter(i=>i!=e),n.changePermission("allowedEntitys",r),t.reply(`Removed entity ${e} to the allowed entitys of the region your currently standing in`)});import{world as tn}from"@minecraft/server";var Le=(i=>(i[i.member=0]="member",i[i.admin=1]="admin",i[i.moderator=2]="moderator",i[i.builder=3]="builder",i))(Le||{});var nn=t=>isNaN(Number(t))===!1;function rn(t){return Object.keys(t).filter(nn).map(e=>t[e])}var kt=new c({name:"role",description:"Changes the role for a player",requires:t=>p(t)=="admin"||tn.getDynamicProperty("worldsOwner")==t.id});kt.literal({name:"set",description:"Sets the role for a player"}).string("playerName").argument(new b.array("role",rn(Le))).executes((t,e,n)=>{B(e,n),t.reply(`Changed role of ${e} to ${n}`)});kt.literal({name:"get",description:"Gets the role of a player"}).string("playerName").executes((t,e)=>{t.reply(`${e} has role: ${p(e)}`)});import{world as Ct}from"@minecraft/server";new c({name:"vanish",description:"Toggles Vanish Mode on the sender",requires:t=>p(t)=="admin"}).boolean("say").executes((t,e)=>{if(t.sender.hasTag("spectator")){if(t.sender.runCommand("gamemode c"),t.sender.runCommand("event entity @s removeSpectator"),t.sender.removeTag("spectator"),!e)return;Ct.say({rawtext:[{translate:"multiplayer.player.joined",with:[`\xA7e${t.sender.name}`]}]})}else{if(t.sender.runCommand("gamemode spectator"),t.sender.runCommand("event entity @s addSpectator"),t.sender.addTag("spectator"),!e)return;Ct.say({rawtext:[{translate:"multiplayer.player.left",with:[`\xA7e${t.sender.name}`]}]})}});new c({name:"unban",description:"Unban a banned player",requires:t=>p(t)=="admin"}).string("playerName").executes((t,e)=>{let n=s.bans.values().find(r=>r.playerName==e);if(!n)return t.reply(`${e} is not banned`);s.bans.delete(n.key)?t.reply(`\xA7a${e}\xA7r has been Unbanned!`):t.reply(`\xA7cFailed to unban ${e}`)});new c({name:"unfreeze",description:"Unfreeze a frozen player",requires:t=>p(t)=="admin"}).string("playerName").executes((t,e)=>{let n=s.freezes.values().find(r=>r.player==e);if(!n)return t.reply(`${e} is not frozen`);s.freezes.delete(n.key),t.reply(`\xA7a${e}\xA7r has been UnFrozen!`)});new c({name:"unmute",description:"Unmutes a muted player",requires:t=>["admin","moderator"].includes(p(t))}).string("playerName").executes((t,e)=>{let n=s.mutes.values().find(r=>r.player==e);if(!n)return t.reply(`${e} is not muted!`);s.mutes.delete(n.player);try{t.sender.runCommand(`ability "${e}" mute false`)}catch{}t.reply(`\xA7a${e}\xA7r has been UnMuted!`)});var vt="2.4.4-beta";var Et="https://discord.gg/dMa3A5UYKX";new c({name:"version",description:"Get Current Version",aliases:["v"]}).executes(t=>{t.reply(`Current Rubedo Version: ${vt}`)});_(t=>{try{let e=s.bans.get(t.id);if(!e)return;if(console.warn(t.name),e.expire&&e.expire<Date.now())return s.bans.delete(t.id);se(t,["\xA7cYou have been banned!",`\xA7aReason: \xA7f${e.reason}`,`\xA7fExpiry: \xA7b${e.expire?O(e.length):"Forever"}`,`\xA7fAppeal at: \xA7b${s.config.get("appealLink")??Et}`],()=>{console.warn(new Error("Failed to kick player")),s.bans.delete(t.id)})}catch(e){console.warn(e+e.stack)}},20);import{Location as on}from"@minecraft/server";_(t=>{let e=s.freezes.get(t.id);!e||t.teleport(new on(e.location.x,e.location.y,e.location.z),y[e.location.dimension],0,0)},20);import{world as sn}from"@minecraft/server";sn.events.beforeChat.subscribe(t=>{if(t.message.startsWith(k))return;let e=P.getMuteData(t.sender);if(!!e){if(e.expire&&e.expire<Date.now())return s.mutes.delete(t.sender.name);t.cancel=!0,t.sender.tell(L["modules.managers.mute.isMuted"]())}});import{BlockLocation as an,world as $e}from"@minecraft/server";w(()=>{oe()},6e3);$e.events.beforeItemUseOn.subscribe(t=>{if(["moderator","admin"].includes(p(t.source)))return;let e=u.blockLocationInRegion(t.blockLocation,t.source.dimension.id);if(!e)return;let n=t.source.dimension.getBlock(t.blockLocation);Ke.includes(n.typeId)&&e.permissions.doorsAndSwitches||Je.includes(n.typeId)&&e.permissions.openContainers||(t.cancel=!0)});$e.events.beforeExplosion.subscribe(t=>{for(let e=0;e<t.impactedBlocks.length;e++){let n=t.impactedBlocks[e];if(u.blockLocationInRegion(n,t.dimension.id))return t.cancel=!0}});$e.events.entityCreate.subscribe(t=>{let e=u.blockLocationInRegion(new an(t.entity.location.x,t.entity.location.y,t.entity.location.z),t.entity.dimension.id);!e||e.permissions.allowedEntitys.includes(t.entity.typeId)||(t.entity.teleport({x:0,y:-64,z:0},t.entity.dimension,0,0),t.entity.kill())});w(()=>{for(let t of u.getAllRegions())for(let e of y[t.dimensionId].getEntities({excludeTypes:t.permissions.allowedEntitys}))!t.entityInRegion(e)||(e.teleport({x:0,y:-64,z:0},e.dimension,0,0),e.kill())},100);_(t=>{for(let e of u.getAllRegions())e.entityInRegion(t)?(t.addTag("inRegion"),e.permissions.pvp||t.addTag("region-protected")):(t.removeTag("inRegion"),t.removeTag("region-protected"))},5);import{world as De}from"@minecraft/server";De.events.playerJoin.subscribe(({player:t})=>{let e=De.events.tick.subscribe(n=>{try{y.overworld.runCommand(`testfor @a[name="${t.name}"]`),De.events.tick.unsubscribe(e),P.getMuteData(t)&&t.runCommand("ability @s mute true"),t.hasTag("old")?t.addTag("old"):s.ids.set(t.name,t.id);let r=v.getPlayersRoleToSet(t.name);r&&B(t,r)}catch{}})});import{Items as mn,MinecraftItemTypes as I,world as Me}from"@minecraft/server";var Tt=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],cn=[10,11,12,13,14,15,16,19,20,21,22,23,24,25,28,29,30,31,32,33,34,37,38,39,40,41,42,43];function ln(t,e,n){let r=t.getComponent("minecraft:inventory").container;for(let i=0;i<r.size;i++){let o=e.slots[i];if(!o||!o.item){r.setItem(i,x);continue}r.setItem(i,o.item.itemStack)}for(let[i,o]of[...Me.getPlayers()].entries()){let a=Tt[i],l=new g(I.skull,{nameTag:o.name,data:3});r.setItem(a,l.itemStack),e.slots[a]={item:l,action:m=>{m.PageAction("moderation:see_inventory",{name:o.name})}}}}function pn(t,e,n){let r=t.getComponent("minecraft:inventory").container;for(let m=0;m<r.size;m++){let f=e.slots[m];if(!f||!f.item){r.setItem(m,x);continue}r.setItem(m,f.item.itemStack)}let i=new g(I.enderChest,{nameTag:`\xA7eView \xA7f${n?.name}\xA7e Ender Chest
\xA7fNote: \xA7cThis will not grab \xA7lANY NBT!\xA7r`});r.setItem(49,i.itemStack),e.slots[49]={item:i,action:m=>{m.PageAction("moderation:see_ender_chest",{name:n.name})}};let o=[...Me.getPlayers()].find(m=>m.name==n.name);if(!o)return;let a=o.getComponent("inventory").container,l=0;for(let m=0;m<a.size;m++){let f=a.getItem(m);if(!f)continue;let h=Tt[l];l++,r.setItem(h,f),e.slots[h]={item:new g(mn.get(f.typeId),{amount:f.amount,data:f.data},f),action:Lt=>{m<9?o.runCommand(`replaceitem entity @s slot.hotbar ${m} air`):o.runCommand(`replaceitem entity @s slot.inventory ${m-9} air`),Lt.GiveAction(),e.slots[h]={item:null,action:$t=>{a.addItem($t.getItemAdded())}}}}}}function fn(t,e,n){let r=t.getComponent("minecraft:inventory").container;for(let a=0;a<r.size;a++){let l=e.slots[a];if(!l||!l.item){r.setItem(a,x);continue}r.setItem(a,l.item.itemStack)}let i=[...Me.getPlayers()].find(a=>a.name==n?.name);if(!i)return;let o=0;for(let a of Object.values(I))try{i.runCommand(`testfor @s[hasitem={item=${a.id},location=slot.enderchest}]`);let l=new g(a.id,{nameTag:"Note: \xA7l\xA7cThis is not the exzact item"}),m=cn[o];r.setItem(m,l.itemStack),e.slots[m]={item:l,action:f=>{f.GiveAction(),e.slots[m]=null}},o++}catch{}}new R("moderation:see",ln).setSlots([45,46,47,49,51,52,53],new g(I.stainedGlassPane,{nameTag:"\xA7r",data:15}),t=>{t.SetAction()}).setSlots([50],new g(I.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("home")}).setSlots([48],new g(I.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});new R("moderation:see_inventory",pn).setSlots([45,46,47,49,51,52,53],new g(I.stainedGlassPane,{nameTag:"\xA7r",data:15}),t=>{t.SetAction()}).setSlots([50],new g(I.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("moderation:see")}).setSlots([48],new g(I.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});new R("moderation:see_ender_chest",fn).setSlots([0,1,2,3,4,5,6,7,8,9,17,18,26,27,35,36,44,45,46,47,49,51,52,53],new g(I.stainedGlassPane,{nameTag:"\xA7r",data:15}),t=>{t.SetAction()}).setSlots([50],new g(I.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("moderation:see")}).setSlots([48],new g(I.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});import{ItemStack as dn,MinecraftItemTypes as un,world as gn}from"@minecraft/server";var yn=new dn(un.stick,0),hn=["minecraft:command_block_minecart"];_(t=>{let e=t.getComponent("inventory").container;for(let n=0;n<e.size;n++){let r=e.getItem(n);if(!r)continue;let i=()=>t.getComponent("inventory").container.setItem(n,yn);if((s.config.get("banned_items")??Z).includes(r.typeId))return i();let a=r.getComponent("enchantments").enchantments,l=s.config.get("enchantments")??$,m=[];for(let f of a){let h=l[f.type.id]??f.type.maxLevel;if(a.slot==0&&!a.canAddEnchantment(f)||f.level>h||m.includes(f.type.id))return i();m.push(f.type.id)}}});gn.events.entityCreate.subscribe(t=>{let e=()=>{try{t.entity.triggerEvent("despawn"),t.entity.kill()}catch{t.entity.kill()}};if(hn.includes(t.entity.typeId)||t.entity.typeId=="minecraft:npc"&&!V.isVaild(t.entity))return e()});var Be=1e5;_(t=>{(Math.abs(t.location.x)>Be||Math.abs(t.location.y)>Be||Math.abs(t.location.z)>Be)&&new G(t,null,null,"Hacking: Crasher")});import{world as St}from"@minecraft/server";var fe=class{constructor(e,n,r){this.player=e,this.location=e.location,this.dimension=e.dimension,this.rotation=e.rotation,this.tick=n,this.storage=r,this.events={playerLeave:St.events.playerLeave.subscribe(({playerName:i})=>{i==this.player.name&&this.expire()})},this.storage.set(e,this)}back(){this.player.teleport(this.location,this.dimension,this.rotation.x,this.rotation.y)}update(){this.tick=j,this.location=this.player.location,this.dimension=this.player.dimension,this.rotation=this.player.rotation}expire(){this.storage.delete(this.player);for(let e in this.events)St.events[e].unsubscribe(this.events[e])}};var At=new S,bn=.9,_n=20,In=!0,wn=["gliding","riding","levitating","swimming"];function kn(t){return t.getComponent("minecraft:inventory").container.getItem(t.selectedSlot)}_((t,{currentTick:e})=>{if(t.getTags().some(i=>wn.includes(i)))return;let n=()=>At.get(t)??new fe(t,e,At),r=Math.sqrt(t.velocity.x**2+t.velocity.z**2);if(t.hasTag("on_ground"))return n().update();if(!(r<bn)&&kn(t)?.typeId!="minecraft:trident"&&!(e-n().tick<_n)&&(n().back(),In))try{t.runCommand("damage @s 4 fly_into_wall")}catch{}},20);import{GameMode as Cn,world as vn}from"@minecraft/server";var En=Cn.creative;w(()=>{for(let t of vn.getPlayers({gameMode:En})){if(["moderator","admin","builder"].includes(p(t)))return;try{t.runCommand("gamemode s"),t.runCommand("clear @s")}catch{}}},20);import{world as xt}from"@minecraft/server";var Tn=/^([\p{L}])([\p{L}\d\s#'()-_]{1,20})([\p{L}\d\)])$/isu,Sn="\xA7c\xA7k\xA7m\xA7A\xA7r\xA7cToolbox Gamer\xA7k\xA7mA\xA7r";xt.events.playerJoin.subscribe(({player:t})=>{let e=t.name,n=()=>se(t,["\xA7cYou have been kicked!",`\xA7aReason: \xA7f'${e}' is Invalid`,"\xA7fThis Server requires you to have a valid gamertag!"]);if(e==Sn||!Tn.test(e)||[...xt.getPlayers()].filter(r=>r.name==t.name).length>1)return n()});import{world as xn,Location as Rn}from"@minecraft/server";import{world as An}from"@minecraft/server";var de=class{constructor(e){this.emptySlotsCount=e.emptySlotsCount,this.size=e.size,this.items=[];for(let n=0;n<this.size;n++)this.items[n]=e.getItem(n)}load(e){for(let n=0;n<e.size;n++)!this.items[n]||e.setItem(n,this.items[n])}};var ue={};w(()=>{ue={};for(let t of An.getPlayers()){let e=tt(t.location),n=e.offset(D.x,D.y,D.z),r=e.offset(-D.x,-D.y,-D.z);for(let i of n.blocksBetween(r)){if(i.y<-64)continue;let o=t.dimension.getBlock(i);!me.includes(o.typeId)||(ue[JSON.stringify(i)]=new de(o.getComponent("inventory").container))}}},100);var Rt=new S,Pn=70,Nn=["snow","lush_plants_replaceable","azalea_log_replaceable","minecraft:crop","fertilize_area"],Ln=["minecraft:water","minecraft:flowing_water","minecraft:lava","minecraft:flowing_lava","minecraft:bedrock"];xn.events.blockBreak.subscribe(({block:t,brokenBlockPermutation:e,dimension:n,player:r})=>{if(["moderator","admin"].includes(p(r))||t.getTags().some(o=>Nn.includes(o)))return;let i=Rt.get(r);if(Rt.set(r,Date.now()),!!i&&!Ln.includes(t.typeId)&&!(i<Date.now()-Pn)){if(n.getBlock(t.location).setPermutation(e.clone()),me.includes(e.type.id)){let o=ue[JSON.stringify(t.location)];o&&o.load(t.getComponent("inventory").container)}Ce(()=>{[...n.getEntities({maxDistance:2,type:"minecraft:item",location:new Rn(t.location.x,t.location.y,t.location.z)})].forEach(o=>o.kill())},0)}});import{world as $n,MinecraftBlockTypes as Dn}from"@minecraft/server";$n.events.blockPlace.subscribe(({block:t,player:e})=>{if(["moderator","admin"].includes(p(e)))return;(s.config.get("banned_blocks")??ee).includes(t.typeId)&&t.setType(Dn.air)});import{Player as Mn,world as re}from"@minecraft/server";var Bn=re.events.beforeDataDrivenEntityTriggerEvent.subscribe(t=>{if(re.getDynamicProperty("roleHasBeenSet"))return re.events.beforeDataDrivenEntityTriggerEvent.unsubscribe(Bn);t.entity instanceof Mn&&t.id=="rubedo:becomeAdmin"&&(B(t.entity,"admin"),re.setDynamicProperty("roleHasBeenSet",!0),re.setDynamicProperty("worldsOwner",t.entity.id),t.entity.tell("\xA7l\xA7cYou have been given admin, the function start will not work anymore!!!!"))});import{system as On}from"@minecraft/server";On.events.beforeWatchdogTerminate.subscribe(t=>{t.cancel=!0,console.warn(`WATCHDOG TRIED TO CRASH = ${t.terminateReason}`)});import{DynamicPropertiesDefinition as Oe,EntityTypes as zn,MinecraftEntityTypes as Fn,world as Nt}from"@minecraft/server";var Pt=[];Nt.events.worldInitialize.subscribe(({propertyRegistry:t})=>{et("tickingarea add 0 0 0 0 0 0 db true");let e=new Oe;e.defineString("name",30),e.defineNumber("index"),t.registerEntityTypeDynamicProperties(e,zn.get(J));let n=new Oe;n.defineString("role",30),t.registerEntityTypeDynamicProperties(n,Fn.player);let r=new Oe;r.defineBoolean("roleHasBeenSet"),r.defineString("worldsOwner",100),t.registerWorldDynamicProperties(r);for(let i of Pt)Nt.scoreboard.addObjective(i.objective,i.displayName??"")});console.warn("---- STARTING RUBEDO ----");var pe=[];function _t(){pe=[]}var j=null,x=new Gn(Vn.stick,0);jn.events.tick.subscribe(t=>{j?j=j+1:j=t.currentTick});export{x as AIR,j as CURRENT_TICK,pe as NPC_LOCATIONS,_t as clearNpcLocations};
