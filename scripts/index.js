import{ItemStack as uo,MinecraftItemTypes as po,world as fo}from"@minecraft/server";import{world as gn}from"@minecraft/server";var T="-";import{Location as pn}from"@minecraft/server";import{world as un}from"@minecraft/server";import{BlockLocation as rn}from"@minecraft/server";var rt=32e3,J="rubedo:database",x=new rn(0,-64,0);import{ItemStack as ln,MinecraftItemTypes as dn}from"@minecraft/server";function it(t,e){return t.match(new RegExp(".{1,"+e+"}","g"))}import{world as S,Player as mn,BlockLocation as Re,MinecraftBlockTypes as cn,MinecraftDimensionTypes as j}from"@minecraft/server";var st={doorsAndSwitches:!0,openContainers:!0,pvp:!1,allowedEntitys:["minecraft:player","minecraft:npc","minecraft:item","rubedo:inventory","rubedo:database"]},at=["minecraft:acacia_door","minecraft:acacia_trapdoor","minecraft:acacia_button","minecraft:birch_door","minecraft:birch_trapdoor","minecraft:birch_button","minecraft:crimson_door","minecraft:crimson_trapdoor","minecraft:crimson_button","minecraft:dark_oak_door","minecraft:dark_oak_trapdoor","minecraft:dark_oak_button","minecraft:jungle_door","minecraft:jungle_trapdoor","minecraft:jungle_button","minecraft:mangrove_door","minecraft:mangrove_trapdoor","minecraft:mangrove_button","minecraft:spruce_door","minecraft:spruce_trapdoor","minecraft:spruce_button","minecraft:warped_door","minecraft:warped_trapdoor","minecraft:warped_button","minecraft:wooden_door","minecraft:wooden_button","minecraft:trapdoor","minecraft:iron_door","minecraft:iron_trapdoor","minecraft:polished_blackstone_button","minecraft:lever"],mt=["minecraft:chest","minecraft:ender_chest","minecraft:barrel","minecraft:trapped_chest","minecraft:dispenser","minecraft:dropper","minecraft:furnace","minecraft:blast_furnace","minecraft:lit_furnace","minecraft:lit_blast_furnace","minecraft:hopper","minecraft:shulker_box","minecraft:undyed_shulker_box"];var xe=[],sn=!1,ct=-64,lt=320;function dt(t,e,n){return n.every((o,r)=>o>=Math.min(t[r],e[r])&&o<=Math.max(t[r],e[r]))}var g=class{static getAllRegions(){if(sn)return xe;let e=s.regions.values().map(n=>new g(n.from,n.to,n.dimensionId,n.permissions,n.key));return e.forEach(n=>{xe.push(n)}),e}static blockLocationInRegion(e,n){return this.getAllRegions().find(o=>o.dimensionId==n&&dt([o.from.x,ct,o.from.z],[o.to.x,lt,o.to.z],[e.x,e.y,e.z]))}static removeRegionAtBlockLocation(e,n){let o=this.blockLocationInRegion(e,n);return o?s.regions.delete(o.key):!1}constructor(e,n,o,r,i){this.from=e,this.to=n,this.dimensionId=o,this.permissions=r??st,this.key=i||Date.now().toString(),i||(this.update(),ue(),xe.push(this))}update(){s.regions.set(this.key,{key:this.key,from:this.from,dimensionId:this.dimensionId,permissions:this.permissions,to:this.to})}delete(){return s.regions.delete(this.key)}entityInRegion(e){return this.dimensionId==e.dimension.id&&dt([this.from.x,ct,this.from.z],[this.to.x,lt,this.to.z],[e.location.x,e.location.y,e.location.z])}changePermission(e,n){this.permissions[e]=n,this.update()}};var _=class{static getTasks(){return s.tasks.get("changePlayerRole")??[]}static getPlayersRoleToSet(e){return _.getTasks().find(o=>o.playerName==e)?.role}constructor(e,n){let o=_.getTasks();o.push({playerName:e,role:n}),s.tasks.set("changePlayerRole",o)}};import{MessageFormData as an}from"@minecraft/server-ui";var U=class{constructor(e,n){this.title=e,this.body=n,this.form=new an,e&&this.form.title(e),n&&this.form.body(n),this.triedToShow=0}setButton1(e,n){return this.button1={text:e,callback:n},this.form.button1(e),this}setButton2(e,n){return this.button2={text:e,callback:n},this.form.button2(e),this}show(e){this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e)}return}n.selection==1&&this.button1?.callback?.(),n.selection==0&&this.button2?.callback?.()})}};var I={overworld:S.getDimension(j.overworld),nether:S.getDimension(j.nether),theEnd:S.getDimension(j.theEnd),"minecraft:overworld":S.getDimension(j.overworld),"minecraft:nether":S.getDimension(j.nether),"minecraft:the_end":S.getDimension(j.theEnd)};function L(t,e=[],n){if(Be(t))return console.warn("[WARNING]: TRIED TO KICK OWNER"),t.tell("You have been tried to kick, but you cant!"),n?.();try{t.runCommand(`kick "${t.name}" \xA7r${e.join(`
`)}`),t.triggerEvent("kick")}catch(o){if(!/"statusCode":-2147352576/.test(o))return;n&&n()}}function c(t){return t instanceof mn?s.roles.get(t.name)??"member":s.roles.get(t)??"member"}function H(t,e){if(typeof t=="string"){s.roles.set(t,e);let n=[...S.getPlayers()].find(o=>o.name==t);n?n.setDynamicProperty("role",e):new _(t,e)}else s.roles.set(t.name,e),t.setDynamicProperty("role",e)}function Be(t){return S.getDynamicProperty("worldsOwner")==t.id}function pe(){return S.getDynamicProperty("isLockDown")??!1}function Ne(t){S.setDynamicProperty("isLockDown",t)}function ue(){for(let t of g.getAllRegions()){let e=new Re(t.from.x,t.dimensionId=="minecraft:overworld"?-64:0,t.from.z),n=new Re(t.to.x,t.dimensionId=="minecraft:overworld"?-64:0,t.to.z);for(let o of e.blocksBetween(n))I[t.dimensionId].getBlock(o)?.setType(cn.deny)}}var ut=[];function R(t,e=0){ut.push({callback:t,delay:e,lastCall:0})}S.events.tick.subscribe(t=>{let e=[...S.getPlayers()];for(let[n,o]of e.entries())if(!["moderator","admin"].includes(c(o)))for(let r of ut)r.delay!=0&&t.currentTick-r.lastCall<r.delay||(r.callback(o,t),n==e.length-1&&(r.lastCall=t.currentTick))});function Z(t){let e=t.split(",");console.warn(e.length);let n=0;for(let o of e){let r=parseInt(o.match(/\D+|\d+/g)[0]),i=o.match(/\D+|\d+/g)[1];i=="y"&&(n=n+317098e-16*r),i=="w"&&(n=n+6048e5*r),i=="d"&&(n=n+864e5*r),i=="h"&&(n=n+36e5*r),i=="m"&&(n=n+6e4*r),i=="s"&&(n=n+1e3*r),i=="ms"&&(n=n+r)}return n}function Y(t){return new Date(t).toString()}function pt(t){return new Re(Math.floor(t.x),Math.floor(t.y),Math.floor(t.z))}function fe(t,e,n,o=()=>{}){new U("Confirm To Continue",e).setButton1("Confirm",n).setButton2("Never Mind",o).show(t)}var y=class{static compress(e){return e}static decompress(e){return e}static createEntity(e,n){let o=I.overworld.spawnEntity(J,x);o.setDynamicProperty("name",e),o.setDynamicProperty("index",n);let r=o.getComponent("inventory").container,i=new ln(dn.acaciaBoat,1);return n==0&&(i.nameTag="{}"),r.setItem(0,i),o}static getInventorySlotName(e,n){return e.getComponent("inventory").container.getItem(n)?.nameTag}static setInventorySlotName(e,n,o){let r=e.getComponent("inventory").container,i=r.getItem(n);return i.nameTag=o,r.setItem(n,i)}constructor(e){this.name=e,this.savedEntitys=void 0,this.MEMORY=void 0}get entitys(){if(this.savedEntitys)return this.savedEntitys;let e=I.overworld.getEntitiesAtBlockLocation(x).filter(n=>n.typeId==J&&n.getDynamicProperty("name")==this.name);return this.savedEntitys=e,e}data(){if(this.MEMORY)return this.MEMORY;if(this.entitys.length==0&&y.createEntity(this.name,0),this.entitys.length==1){let n=JSON.parse(y.decompress(y.getInventorySlotName(this.entitys[0],0)));return this.MEMORY=n,n}let e=new Array(this.entitys.length);for(let n of this.entitys){let o=n.getDynamicProperty("index");e[o]=y.getInventorySlotName(n,0)}try{e=JSON.parse(e.join(""))}catch{e={}}return this.MEMORY=e,e}save(e){this.MEMORY=e;let n=it(y.compress(JSON.stringify(e)),rt);if(this.entitys&&n.length==this.entitys.length)for(let o=0;o<n.length;o++)y.setInventorySlotName(this.entitys[o],0,n[o]);else{this.entitys?.forEach(o=>o?.triggerEvent("despawn")),this.savedEntitys=void 0;for(let o=0;o<n.length;o++){let r=y.createEntity(this.name,o);y.setInventorySlotName(r,0,n[o])}}}set(e,n){let o=this.data();o[e]=n,this.save(o)}get(e){return this.data()[e]}has(e){return this.keys().includes(e)}delete(e){let n=this.data(),o=delete n[e];return this.save(n),o}size(){return this.keys().length}clear(){this.save({})}keys(){return Object.keys(this.data())}values(){return Object.values(this.data())}getCollection(){return this.data()}};var s={config:new y("config"),freezes:new y("freezes"),mutes:new y("mutes"),bans:new y("bans"),regions:new y("regions"),roles:new y("roles"),tasks:new y("tasks"),npcs:new y("npcs"),ids:new y("ids")};function ft(t){return[...un.getPlayers()].find(e=>e.name===t)}var M=class{constructor(e="literal"){this.name=e;this.typeName="literal";this.name=e}matches(e){return{success:this.name==e}}fail(e){return`${e} should be ${this.name}!`}},Q=class{constructor(e="string"){this.name=e;this.typeName="string";this.name=e}matches(e){return{success:e&&e!="",value:e}}fail(e){return"Value must be of type string!"}},ee=class{constructor(e="integer"){this.name=e;this.typeName="int";this.name=e}matches(e){return{success:!isNaN(e),value:parseInt(e)}}fail(e){return"Value must be vaild number!"}},_e=class{constructor(e="float"){this.name=e;this.typeName="float";this.name=e}matches(e){return{success:Boolean(e?.match(/^\d+\.\d+$/)?.[0]),value:parseInt(e)}}fail(e){return"Value must be vaild float!"}},z=class{constructor(e="location"){this.name=e;this.typeName="location";this.name=e}matches(e){return{success:/^([~^]{0,1}(-\d)?(\d*)?(\.(\d+))?)$/.test(e),value:e}}fail(e){return"Value needs to be a vaild number, value can include: [~,^]"}},te=class{constructor(e="boolean"){this.name=e;this.typeName="boolean";this.name=e}matches(e){return{success:Boolean(e?.match(/^(true|false)$/)?.[0]),value:e=="true"}}fail(e){return`"${e}" can be either "true" or "false"`}},De=class{constructor(e="player"){this.name=e;this.typeName="playerName";this.name=e}matches(e){return{success:!!ft(e),value:ft(e)}}fail(e){return`player: "${e}", is not in this world`}},Le=class{constructor(e="target"){this.name=e;this.typeName="Target";this.name=e}matches(e){return{success:Boolean(e?.match(/^(@.|"[\s\S]+")$/)?.[0]),value:e}}fail(e){return`${e} is not a vaild target`}},ne=class{constructor(e="array",n){this.name=e;this.types=n;this.typeName="string";this.name=e,this.types=n,this.typeName=n.join(" | ").replace(/(.{25})..+/,"$1...")}matches(e){return{success:this.types.includes(e),value:e}}fail(e){return`"${e}" must be one of these values: ${this.types.join(" | ")}`}},Me=class{constructor(e){this.name=e;this.typeName="Duration"}matches(e){return{success:/^(\d+[hdysmw],?)+$/.test(e),value:e}}fail(e){return`"${e}" must be a value like "10d" or "3s" the first part is the length second is unit`}},$e=class{constructor(e="playerName"){this.name=e;this.typeName="playerName";this.name=e}matches(e){return{success:!!s.ids.get(e),value:e}}fail(e){return`player: "${e}" has never played this world before! Tip: if the name has spaces in it use quotes around name!`}},b={string:Q,int:ee,float:_e,location:z,boolean:te,player:De,target:Le,array:ne,duration:Me,playerName:$e};var ge=class{constructor(e){this.data=e,this.sender=e.sender}reply(e){this.sender.tell(e)}};function gt(t,e){try{return t.slice(e.length).trim().match(/"[^"]+"|[^\s]+/g).map(n=>n.replace(/"(.+)"/,"$1").toString())}catch{return[]}}function yt(t,e){t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.unknown",with:[`${e}`]}]})}function Oe(t,e){t.tell({rawtext:[{text:e.data.invaildPermission?e.data.invaildPermission:`\xA7cYou do not have perrmission to use "${e.data.name}"`}]})}function ht(t,e,n,o,r){if(t.tell({rawtext:[{text:"\xA7c"},{translate:"commands.generic.syntax",with:[`${T}${e.data.name} ${o.slice(0,r).join(" ")}`,o[r]??" ",o.slice(r+1).join(" ")]}]}),n.children.length>1||!o[r]){let i=n.children.map(m=>m.type instanceof M?m.type.name:m.type?.typeName);t.tell(`\xA7c"${o[r]??"undefined"}" is not vaild! Argument "${[...new Set(n.children.map(m=>m.type.name))][0]}" can be typeof: "${i.join('", "')}"`)}else t.tell(`\xA7c${n.children[0]?.type?.fail(o[r])}`)}function fn([t,e,n],{location:o,viewVector:r}){if(!t||!e||!t)return null;let i=[o.x,o.y,o.z],m=[r.x,r.y,r.z],a=[t,e,n].map(p=>{let u=parseFloat(p);return isNaN(u)?0:u}),l=[t,e,n].map((p,u)=>p.includes("~")?a[u]+i[u]:p.includes("^")?a[u]+m[u]:a[u]);return new pn(l[0],l[1],l[2])}function bt(t,e,n,o){let r=e[e.length-1]??o,i=[];for(let[m,a]of e.entries())if(!a.type.name.endsWith("*")){if(a.type instanceof z){i.push(fn([t[m],t[m+1],t[m+2]],n.sender));continue}a.type instanceof M||i.push(a.type.matches(t[m]).value??t[m])}r.callback(new ge(n),...i)}var D=[];gn.events.beforeChat.subscribe(t=>{if(!t.message.startsWith(T))return;t.cancel=!0;let e=gt(t.message,T),n=D.find(i=>i.depth==0&&(i.data.name==e[0]||i.data?.aliases?.includes(e[0])));if(!n)return yt(t.sender,e[0]);if(!n.data?.requires(t.sender))return Oe(t.sender,n);e.shift();let o=[],r=(i,m)=>{if(i.children.length>0){let a=i.children.find(l=>l.type.matches(e[m]).success);return!a&&!e[m]&&i.callback?void 0:a?a.data?.requires(t.sender)?(o.push(a),r(a,m+1)):(Oe(t.sender,a),"fail"):(ht(t.sender,n,i,e,m),"fail")}};r(n,0)||bt(e,o,t,n)});import{Player as wn,world as Ve}from"@minecraft/server";var It="rubedo:gui",oe="rubedo:inventory";import{world as kt}from"@minecraft/server";var wt=new Map,re=class{constructor(e,n,o=!1,r=Date.now()){this.callbackTick=null,this.tickDelay=n,this.loop=o,this.callback=e,this.id=r,wt.set(r,this),this.TickCallBack=kt.events.tick.subscribe(({currentTick:i})=>{if(this.callbackTick||(this.callbackTick=i+this.tickDelay),!(this.callbackTick>i)){if(this.callback(i),!this.loop)return this.expire();this.callbackTick=i+this.tickDelay}})}expire(){kt.events.tick.unsubscribe(this.TickCallBack),wt.delete(this.id)}};var Ct=t=>new Promise(e=>Fe(e,t));function Fe(t,e){new re(t,e)}function A(t,e){return new re(t,e,!0)}import{world as At}from"@minecraft/server";var ze={},vt={},$={};function yn(t,e,n){if(e.length!=n.length)return[];let o=[];for(let r=0;r<n.length;r++){if(e[r]?.item?.amount<n[r]?.item?.amount||e[r]?.item?.amount>n[r]?.item?.amount&&e[r]?.item?.amount!=0){let i={slot:r,uid:n[r].uid,oldUid:e[r].uid,item:n[r].item,oldItem:e[r].item,changeType:"fluctuation"};o.push(i),$[t.id]=i;continue}if(n[r].uid!=e[r].uid)if(e[r]?.item&&n[r]?.item){let i={slot:r,uid:n[r].uid,oldUid:e[r].uid,item:n[r].item,oldItem:e[r].item,changeType:"swap"};o.push(i),$[t.id]=i}else if(n[r]?.item){if(n[r]?.item)if($[t.id]?.changeType=="delete"&&$[t.id]?.uid==n[r].uid){let i={slot:r,uid:n[r].uid,item:n[r].item,changeType:"move"};o.push(i),$[t.id]=i;continue}else{let i={slot:r,uid:n[r].uid,item:n[r].item,changeType:"put"};o.push(i),$[t.id]=i}}else{let i={slot:r,uid:e[r].uid,item:e[r].item,changeType:"delete"};o.push(i),$[t.id]=i}}return o}function hn(t){if(!t)return"";let e=[];return e.push(t.typeId),e.push(t.nameTag),e.push(t.data),e.push(t.getLore().join("")),e.join("")}function bn(t){let e=[];for(let n=0;n<t.size;n++){let o=t.getItem(n);e[n]={uid:hn(o),item:o}}return e}A(()=>{for(let t of Object.values(ze))for(let e of I.overworld.getEntities(t.entities)){let n=bn(e.getComponent("inventory").container),o=yn(e,vt[e.id]??n,n);if(vt[e.id]=n,o.length!=0){if(e.hasTag("skipCheck")){e.removeTag("skipCheck"),delete $[e.id];continue}for(let r of o)t.callback(e,r)}}},5);var ie=class{static subscribe(e,n){let o=Date.now();return ze[o]={callback:n,entities:e},o}static unsubscribe(e){delete ze[e]}};import{world as In}from"@minecraft/server";var k=class{constructor(){this.data=new Map,this.events={playerLeave:In.events.playerLeave.subscribe(e=>this.data.delete(e.playerName))}}set(e,n){this.data.set(e.name,n)}get(e){return this.data.get(e.name)}delete(e){this.data.delete(e.name)}clear(){this.data.clear()}playerNames(){return[...this.data.keys()]}};var P={},K={},se=new k;function Tt(t){return t.getComponent("minecraft:inventory").container.getItem(t.selectedSlot)}async function St(t,e){try{let n=t.getComponent("minecraft:inventory").container,o=[];for(let r=0;r<n.size;r++){let i=n.getItem(r);!i||i?.typeId==e?.typeId&&(o.push({slot:r,item:i}),n.setItem,r<9?t.runCommand(`replaceitem entity @s slot.hotbar ${r} air`):t.runCommand(`replaceitem entity @s slot.inventory ${r-9} air`))}t.runCommand(`clear @s ${e?.typeId} ${e.data} ${e.amount}`);for(let r of o)n.setItem(r.slot,r.item)}catch{[...t.dimension.getEntities({type:"minecraft:item",location:t.location,maxDistance:2,closest:1})].forEach(o=>o.kill())}}function Et(t,e){return t.getComponent("minecraft:inventory").container.getItem(e)}var ye=class{constructor(e,n,o){this.gui=e,this.slot=n,this.change=o}message(e){this.gui.player.tell(e)}getItemAdded(){return this.slot.item?null:this.gui.entity.getComponent("minecraft:inventory").container.getItem(this.change.slot)}GiveAction(e=this.slot.item.itemStack){this.gui.player.getComponent("minecraft:inventory").container.addItem(e)}TakeAction(e=null){this.gui.player.getComponent("minecraft:inventory").container.addItem(this.slot.item.itemStack),this.gui.page.slots[this.change.slot]=null,e&&e.delete(this.slot.item.components.dbKey)}PageAction(e,n){this.gui.setPage(e,n)}CloseAction(){this.gui.despawn()}SetAction(){this.gui.entity.getComponent("minecraft:inventory").container.setItem(this.change.slot,this.slot.item.itemStack)}async FormAction(e){return this.CloseAction(),await Ct(5),await e.show(this.gui.player)}};var q=class{static spawnEntity(e){try{return e.dimension.spawnEntity(oe,e.headLocation)}catch{return null}}constructor(e){this.player=e,this.entity=q.spawnEntity(e),this.entity&&(this.hasChestOpen=!1,this.setPage("home")),this.tickEvent=At.events.tick.subscribe(()=>{if(!this.entity)return this.despawn();if(se.get(this.player))this.hasChestOpen||(this.slotChangeEvent=ie.subscribe({type:oe},(n,o)=>{n.id==this.entity.id&&this.onSlotChange(o)})),this.hasChestOpen=!0;else try{this.entity.teleport(this.player.headLocation,this.player.dimension,this.player.rotation.x,this.player.rotation.y,!0)}catch{this.despawn()}})}setPage(e,n){let o=this.entity.getComponent("inventory").container;for(let i=0;i<o.size;i++)o.setItem(i,B);if(!Object.keys(K).includes(e))throw new Error(`pageId ${e} does not exist!`);let r=K[e];this.page=r,r.fillType(this.entity,r,n),this.entity.nameTag="size:54"}onSlotChange(e){let n=this.page.slots[e.slot];if(!n)this.entity.getComponent("inventory").container.setItem(e.slot,B);else if(e.changeType=="delete"){if(n.item&&St(this.player,e.item),!n.item&&!Et(this.entity,e.slot))return;n.action(new ye(this,n,e))}}despawn(){try{this.entity?.triggerEvent("despawn")}catch{}try{delete P[this.player.name]}catch{}this.tickEvent&&At.events.tick.unsubscribe(this.tickEvent),this.slotChangeEvent&&ie.unsubscribe(this.slotChangeEvent)}};import{ItemStack as kn}from"@minecraft/server";var h=class{constructor(e,n={},o){this.itemType=e,this.components=n,this.setItemStack=o}get itemStack(){if(this.setItemStack)return this.setItemStack;let e=new kn(this.itemType);if(this.components){e.amount=this.components?.amount??1,e.data=this.components?.data??0,e.nameTag=this.components?.nameTag,e.setLore(this.components?.loreList??[]);let n=e.getComponent("enchantments").enchantments;for(let o of this.components?.enchantments??[])n.addEnchantment(o);e.getComponent("enchantments").enchantments=n}return e}};function Pt(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let r=0;r<o.size;r++){let i=e.slots[r];if(!i||!i.item){o.setItem(r,B);continue}o.setItem(r,i.item.itemStack)}}var O=class{constructor(e,n=Pt){if(Object.keys(K).includes(e))throw new Error(`Page: ${e}, Already exists!`);this.id=e,this.fillType=n,this.slots=[],K[e]=this}setSlots(e,n,o){let r=n?{item:n,action:o}:null;for(let i of e)this.slots[i]=r;return this}};import{MinecraftItemTypes as Ge}from"@minecraft/server";var Xr=new O("home").setSlots([0,1,2,3,4,5,6,7,8,9,17,18,26,27,35,36,44,45,46,47,48,50,51,52,53],new h(Ge.stainedGlassPane,{data:15,nameTag:"\xA7r"}),t=>{t.SetAction()}).setSlots([22],new h(Ge.enderChest,{nameTag:"\xA7l\xA7bInventory Viewer"}),t=>{t.PageAction("moderation:see")}).setSlots([54],new h(Ge.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});Ve.events.tick.subscribe(t=>{for(let e of Ve.getPlayers())if(c(e)=="admin"){if(Tt(e)?.typeId!=It){P[e.name]&&P[e.name].despawn();continue}Object.keys(P).includes(e?.name)||(P[e.name]=new q(e))}});Ve.events.beforeDataDrivenEntityTriggerEvent.subscribe(t=>{t.entity instanceof wn&&(t.id=="rubedo:has_container_open"?se.set(t.entity,!0):t.id=="rubedo:dosent_have_container_open"&&se.set(t.entity,!1))});A(()=>{let t=Object.values(P).map(e=>e.entity.id);for(let e of I.overworld.getEntities({type:oe}))t.includes(e.id)||e.triggerEvent("despawn")},100);var w={"api.name":()=>"Smelly API","api.error.unknown":()=>"An unknown error has occured.","api.database.error.table_name":(t,e)=>`The display name ${t} is too long for an objective, it can be at most ${e} characters long`,"api.utilities.formatter.error.ms":t=>`${t} is not a string or a number`,"api.Providers.form.invaildtype":(t,e)=>`Type ${t} is not a vaild type to add a ${e}`,"api.Providers.form.invaildFormtype":(t,e)=>{`${t}${JSON.stringify(e)}`},"api.ChestGUI.error.pagenotfound":t=>`Page ${t} not found!`,"modules.protections.cps.clickingToFast":()=>"You are clicking to fast! Please click slower!","modules.managers.mute.isMuted":()=>"You are muted and cannot send messages please try again later","modules.commands.ban.reply":(t,e,n="")=>`\xA7cBanned \xA7f"\xA7a${t}\xA7f" \xA7cfor ${e} Because: "${n??"No reason Provided"}" \xA7aSuccessfully`,"lockdown.kick.message":()=>["\xA7cYou have been kicked!","\xA7aReason: \xA7fServer is currently under LockDown","\xA7fServer will be up soon, Try to join later"],"commands.ban.list.player":(t,e,n)=>`- "${t}" Because: ${e}, Expiry ${n}`,"commands.freeze.list.player":(t,e)=>`- "${t}" Because: ${e}`,"commands.mutes.list.player":(t,e,n)=>`- "${t}" Because: ${e}, Expiry: ${n}`,"commands.lockdown.confirm":"Are you sure you want to lockdown the server, this will kick all active players and all players who try to join who are not admin"};var d=class{constructor(e,n,o=0,r){this.data=e;this.type=n;this.depth=o;this.parent=r;e.requires||(e.requires=i=>!0),this.data=e,this.type=n??new M(this.data.name),this.children=[],this.depth=o,this.parent=r,this.callback=null,D.push(this)}argument(e){let n=new d(this.data,e,this.depth+1,this);return this.children.push(n),n}string(e){return this.argument(new Q(e))}int(e){return this.argument(new ee(e))}array(e,n){return this.argument(new ne(e,n))}boolean(e){return this.argument(new te(e))}location(e){let n=this.argument(new z(e));return e.endsWith("*")?n:n.location(e+"_y*").location(e+"_z*")}literal(e){let n=new d(e,new M(e.name),this.depth+1,this);return this.children.push(n),n}executes(e){return this.callback=e,this}};import{Player as xt}from"@minecraft/server";var C=class{constructor(e,n,o="No Reason",r="Rubedo Auto Mod"){let i=e instanceof xt?e.id:s.ids.get(e);if(!i)throw new Error(`"${e}" does not have a saved id!`);let m={key:i,playerName:e instanceof xt?e.name:e,date:Date.now(),duration:n?Z(n):null,expire:n?Z(n)+Date.now():null,reason:o,by:r};s.bans.set(i,m)}};function Ue(t,e,n,o,r){if(s.bans.get(s.ids.get(e)))return t.reply(`\xA7c${e} is already banned`);t.reply("\xA7aClose chat to confirm"),fe(t.sender,`Are you sure you want to ban ${e}, for ${n??"forever"}`,()=>{new C(e,n,o,t.sender.name),t.reply(w["modules.commands.ban.reply"](e,n,o))})}var je=new d({name:"ban",description:"Manage bans",requires:t=>["admin","moderator"].includes(c(t))});je.literal({name:"add",description:"Bans a player"}).argument(new b.playerName).executes((t,e)=>{Ue(t,e,null,null,t.sender.name)}).argument(new b.duration("duration")).executes((t,e,n)=>{Ue(t,e,n,null,t.sender.name)}).string("reason").executes((t,e,n,o)=>{Ue(t,e,n,o,t.sender.name)});je.literal({name:"remove",description:"unbans a player"}).argument(new b.playerName("playerName")).executes((t,e)=>{let n=s.bans.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not banned`);s.bans.delete(n.key)?t.reply(`\xA7a${e}\xA7r has been Unbanned!`):t.reply(`\xA7cFailed to unban ${e}`)});je.literal({name:"list",description:"Lists all bans"}).executes(t=>{let e=s.bans.values();if(e.length==0)return t.sender.tell("\xA7cNo one is banned!");t.sender.tell(`\xA72--- Showing Bans (${e.length}) ---`);for(let n of e)t.sender.tell(w["commands.ban.list.player"](n.playerName,n.reason,n.expire?Y(n.duration):"Forever"))});var He=new d({name:"database",description:"Interacts with SA Database",aliases:["db"],requires:t=>c(t)=="admin"});He.literal({name:"get"}).string("table").string("key").executes((t,e,n)=>{try{let o=s[e].get(n);o?t.reply(o):t.reply(`No data could be found for key ${n}`)}catch(o){t.reply(o+o.stack)}});He.literal({name:"set"}).string("table").string("key").string("value").executes((t,e,n,o)=>{try{s[e].set(n,o),t.reply(`Set Key: "${n}", to value: "${o}" on table: "${e}"`)}catch(r){t.reply(r+r.stack)}});He.literal({name:"clear"}).string("table").executes((t,e)=>{try{s[e].clear(),t.reply(`Cleared Table ${e}`)}catch(n){t.reply(n+n.stack)}});new d({name:"ecwipe",description:"Clears a players ender chest",requires:t=>c(t)=="admin"}).argument(new b.player("player")).executes((t,e)=>{for(let n=0;n<27;n++)e.runCommand(`replaceitem entity @s slot.enderchest ${n} air`);t.reply(`Cleared ${e.name} Ender chest!`)});var he=class{constructor(e,n="No Reason"){let o={playerName:e.name,key:e.id,reason:n,location:{x:e.location.x,y:e.location.y,z:e.location.z,dimension:e.dimension.id}};s.freezes.set(e.id,o)}};var Ye=new d({name:"freeze",description:"Manage Freezes",requires:t=>c(t)=="admin"});Ye.literal({name:"add",description:"Freezes a player"}).argument(new b.player("player")).string("reason").executes((t,e,n)=>{new he(e,n),t.reply(`\xA7cFroze \xA7f"\xA7a${e.name}\xA7f" Because: "${n}" \xA7aSuccessfully`),t.sender.tell(`\xA7cYou have been frozen by \xA7f"\xA7a${t.sender.name}\xA7f" Because: "${n}"`)});Ye.literal({name:"remove",description:"unfreezes a player"}).argument(new b.playerName("playerName")).executes((t,e)=>{let n=s.freezes.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not frozen`);s.freezes.delete(n.key),t.reply(`\xA7a${e}\xA7r has been UnFrozen!`)});Ye.literal({name:"list",description:"Lists all freezes"}).executes(t=>{let e=s.freezes.values();if(e.length==0)return t.sender.tell("\xA7cNo one is frozen!");t.sender.tell(`\xA72--- Showing Freezes (${e.length}) ---`);for(let n of e)t.sender.tell(w["commands.freeze.list.player"](n.playerName,n.reason))});var Ke=class{constructor(e){this.name=e;this.typeName="CommandName"}matches(e){return{success:Boolean(D.find(n=>n.depth==0&&n.data.name==e)),value:e}}fail(e){return`"${e}" is not a vaild command`}};function Cn(t,e,n){n.tell(`${T}${t.data.name} ${e.map(o=>o.type.typeName=="literal"?o.data.name:`<${o.type.name}: ${o.type.typeName}>`).join(" ")}`)}function be(t,e,n,o){if(!!e.data?.requires(o)&&(e.callback&&Cn(t,e.depth==0?n:n.concat(e),o),e.children.length>0))for(let r of e.children)be(t,r,e.depth==0?n:n.concat(e),o)}function Rt(t,e,n){t.tell(`\xA72--- Showing help page ${e} of ${n} (${T}help <page: int>) ---`)}function Bt(t){let e=D.filter(n=>n.depth==0&&n.data?.requires(t));return e.length==0?0:Math.ceil(e.length/5)}var Nt=new d({name:"help",description:"Provides help/list of commands.",aliases:["?","h"]}).executes(t=>{let e=Bt(t.sender),n=D.filter(o=>o.depth==0&&o.data?.requires(t.sender)).slice(1*5-5,1*5);Rt(t.sender,1,e);for(let o of n)be(o,o,[],t.sender)});Nt.int("page").executes((t,e)=>{let n=Bt(t.sender);e>n&&(e=n);let o=D.filter(r=>r.depth==0&&r.data?.requires(t.sender)).slice(e*5-5,e*5);Rt(t.sender,e,n);for(let r of o)be(r,r,[],t.sender)});Nt.argument(new Ke("command")).executes((t,e)=>{let n=D.filter(o=>o.depth==0&&o.data.name==e)[0];t.sender.tell(`\xA7e${n.data.name}: ${n.data.aliases?`aliases (${n.data.aliases.join(", ")})`:""}`),t.sender.tell(`\xA7e${n.data.description}`),t.sender.tell("Usage:"),be(n,n,[],t.sender)});import{world as _t}from"@minecraft/server";new d({name:"lockdown",description:"Toggles the servers lockdown, meaning noone can join",requires:t=>c(t)=="admin"}).executes(t=>{pe()?(Ne(!1),t.sender.tell("Unlocked the server!")):(t.reply("\xA7aClose chat to confirm lockdown"),fe(t.sender,w["commands.lockdown.confirm"],()=>{Ne(!0);for(let e of _t.getPlayers())c(e)!="admin"&&L(e,w["lockdown.kick.message"]());_t.say("\xA7l\xA7cServer is now LOCKED!")}))});var N=class{static getMuteData(e){return s.mutes.get(e.name)}constructor(e,n,o="No Reason",r="Rubedo Auto Mod"){let i=n?Z(n):null,m={playerName:e.name,date:Date.now(),duration:i,expire:i?i+Date.now():null,reason:o,by:r};s.mutes.set(e.name,m)}};var qe=new d({name:"mute",description:"Manage Mutes",requires:t=>["admin","moderator"].includes(c(t))});qe.literal({name:"add",description:"Mutes a player"}).argument(new b.player("player")).argument(new b.duration("duration")).string("reason").executes((t,e,n,o)=>{new N(e,n,o,t.sender.name),t.reply(`\xA7cMuted \xA7f"\xA7a${e.name}\xA7f" \xA7cfor ${n} Because: "${o}" \xA7aSuccessfully`),e.tell(`\xA7cYou have been muted by \xA7f"${t.sender.name}" \xA7cfor ${n} Because: "${o}"`)});qe.literal({name:"remove",description:"unmutes a player"}).argument(new b.playerName("playerName")).executes((t,e)=>{let n=s.mutes.values().find(o=>o.playerName==e);if(!n)return t.reply(`${e} is not muted!`);s.mutes.delete(n.playerName);try{t.sender.runCommand(`ability "${e}" mute false`)}catch{}t.reply(`\xA7a${e}\xA7r has been UnMuted!`)});qe.literal({name:"list",description:"Lists all feeezes"}).executes(t=>{let e=s.mutes.values();if(e.length==0)return t.sender.tell("\xA7cNo one is muted!");t.sender.tell(`\xA72--- Showing Mutes (${e.length}) ---`);for(let n of e)t.sender.tell(w["commands.mutes.list.player"](n.playerName,n.reason,n.expire?Y(n.expire):"Forever"))});var W=class{static isVaild(e){return e.typeId!="minecraft:npc"?!1:Ie.find(n=>n.equals(e.location))?!0:!!s.npcs.keys().find(n=>e.id==n)}constructor(e,n){Ie.push(e);let o=n.spawnEntity("minecraft:npc",e),r={dimension:o.dimension.id,x:o.location.x,y:o.location.y,z:o.location.z};s.npcs.set(o.id,r),Dt()}};new d({name:"npc",description:"Spawns a npc at your coordinates",requires:t=>c(t)=="admin"}).executes(t=>{new W(t.sender.location,t.sender.dimension),t.reply("Spawned a verifed npc at your current location")});import{world as Lt}from"@minecraft/server";new d({name:"ping",description:"Returns the current TPS of the servers ping"}).executes(t=>{let e=Lt.events.tick.subscribe(({deltaTime:n})=>{t.reply(`Pong! Current TPS: ${1/n}`),Lt.events.tick.unsubscribe(e)})});import{BlockLocation as ae}from"@minecraft/server";var me=new d({name:"region",description:"Create a Region",requires:t=>c(t)=="admin"});me.literal({name:"add",description:"Adds a new protection region"}).int("from_x").int("from_z").int("to_x").int("to_z").executes((t,e,n,o,r)=>{new g({x:e,z:n},{x:o,z:r},t.sender.dimension.id),t.reply(`Created Region From ${e} -64 ${n} ${o} 320 ${r}`)});me.literal({name:"remove",description:"Removes a region at the players current postion"}).executes(t=>{let e=new ae(t.sender.location.x,t.sender.location.y,t.sender.location.z);g.removeRegionAtBlockLocation(e,t.sender.dimension.id)?t.reply(`Removed Region at ${e.x} ${e.y} ${e.z}`):t.reply(`Failed to find/remove region at ${e.x} ${e.y} ${e.z}`)});me.literal({name:"removeAll",description:"Removes all regions"}).executes(t=>{g.getAllRegions().forEach(e=>e.delete()),t.reply("Removed All regions")});me.literal({name:"list",description:"Lists all regions and positions"}).executes(t=>{let e=g.getAllRegions();for(let n of e)t.reply(`Region from ${n.from.x}, ${n.from.z} to ${n.to.x}, ${n.to.z} in dimension ${n.dimensionId}`);if(e.length==0)return t.reply("No regions have been made yet")});var We=me.literal({name:"permission",description:"Handels permissions for regions"});We.literal({name:"set",description:"Sets a certin permission on the region the player is currently in to a value"}).array("key",["doorsAndSwitches","openContainers","pvp"]).boolean("value").executes((t,e,n)=>{let o=g.blockLocationInRegion(new ae(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!o)return t.reply("You are not in a region");o.changePermission(e,n),t.reply(`Changed permision ${e} to ${n}`)});We.literal({name:"list",description:"Lists the permissions for the current region"}).executes(t=>{let e=g.blockLocationInRegion(new ae(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!e)return t.reply("You are not in a region");t.reply(`Current region permissions ${JSON.stringify(e.permissions)}`)});var Mt=We.literal({name:"entities",description:"Holds the subCommands for adding or removing allowedEntitys"});Mt.literal({name:"add",description:"Adds a entity to the allowed entitys list"}).string("entity").executes((t,e)=>{let n=g.blockLocationInRegion(new ae(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let o=n.permissions.allowedEntitys;o.push(e),n.changePermission("allowedEntitys",o),t.reply(`Added entity ${e} to the allowed entitys of the region your currently standing in`)});Mt.literal({name:"remove",description:"Removes a entity from the allowed entitys in the region"}).string("entity").executes((t,e)=>{let n=g.blockLocationInRegion(new ae(t.sender.location.x,t.sender.location.y,t.sender.location.z),t.sender.dimension.id);if(!n)return t.reply("You are not in a region");let o=n.permissions.allowedEntitys;if(!o.includes(e))return t.reply(`The entity ${e} is not allowed to enter the region`);o=o.filter(r=>r!=e),n.changePermission("allowedEntitys",o),t.reply(`Removed entity ${e} to the allowed entitys of the region your currently standing in`)});var Je=(r=>(r[r.member=0]="member",r[r.admin=1]="admin",r[r.moderator=2]="moderator",r[r.builder=3]="builder",r))(Je||{});var vn=t=>isNaN(Number(t))===!1;function Tn(t){return Object.keys(t).filter(vn).map(e=>t[e])}var $t=new d({name:"role",description:"Changes the role for a player",requires:t=>c(t)=="admin"||Be(t)});$t.literal({name:"set",description:"Sets the role for a player"}).argument(new b.playerName("playerName")).argument(new b.array("role",Tn(Je))).executes((t,e,n)=>{H(e,n),t.reply(`Changed role of ${e} to ${n}`)});$t.literal({name:"get",description:"Gets the role of a player"}).argument(new b.playerName("playerName")).executes((t,e)=>{t.reply(`${e} has role: ${c(e)}`)});import{ActionFormData as Sn}from"@minecraft/server-ui";var F=class{constructor(e,n){this.title=e,this.body=n,this.form=new Sn,e&&this.form.title(e),n&&this.form.body(n),this.buttons=[],this.triedToShow=0}addButton(e,n=null,o){return this.buttons.push({text:e,iconPath:n,callback:o}),this.form.button(e,n),this}show(e){this.form.show(e).then(n=>{if(n.canceled){if(n.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e)}return}this.buttons[n.selection].callback?.()})}};import{MinecraftBlockTypes as An}from"@minecraft/server";var Ot="2.5.3-beta";var ke="https://discord.gg/dMa3A5UYKX";var ce={aquaAffinity:1,baneOfArthropods:5,binding:1,blastProtection:4,channeling:1,depthStrider:3,efficiency:5,featherFalling:4,fireAspect:2,fireProtection:4,flame:1,fortune:3,frostWalker:2,impaling:5,infinity:1,knockback:2,looting:3,loyalty:4,luckOfTheSea:3,lure:3,mending:1,multishot:1,piercing:4,power:5,projectileProtection:4,protection:4,punch:2,quickCharge:3,respiration:3,riptide:3,sharpness:5,silkTouch:1,smite:5,soulSpeed:3,swiftSneak:4,thorns:3,unbreaking:3,vanishing:1};import{MinecraftBlockTypes as we,MinecraftItemTypes as f}from"@minecraft/server";var G=[f.beehive.id,f.beeNest.id,f.axolotlBucket.id,f.codBucket.id,f.tadpoleBucket.id,f.tropicalFishBucket.id,f.salmonBucket.id,f.pufferfishBucket.id,f.allow.id,f.barrier.id,f.borderBlock.id,f.debugStick?.id??"minecraft:debug_stick",f.deny.id,f.jigsaw.id,f.lightBlock.id,f.commandBlock.id,f.repeatingCommandBlock.id,f.chainCommandBlock.id,f.structureBlock.id,f.structureVoid.id,f.bedrock.id,f.commandBlockMinecart.id,f.endPortalFrame.id,"minecraft:info_update","minecraft:info_update2","minecraft:reserved3","minecraft:reserved4","minecraft:reserved6","minecraft:movingBlock","minecraft:moving_block","minecraft:movingblock","minecraft:piston_arm_collision","minecraft:piston_arm_collision","minecraft:pistonarmcollision","minecraft:stickyPistonArmCollision","minecraft:sticky_piston_arm_collision","minecraft:unknown","minecraft:glowingobsidian","minecraft:invisible_bedrock","minecraft:invisiblebedrock","minecraft:netherreactor","minecraft:portal","minecraft:fire","minecraft:water","minecraft:lava","minecraft:flowing_lava","minecraft:flowing_water","minecraft:soul_fire"],le=[we.beehive.id,we.beeNest.id,"minecraft:movingBlock","minecraft:movingblock","minecraft:moving_block",we.bedrock.id,we.barrier.id,"minecraft:invisiblebedrock"],Ce=["minecraft:chest","minecraft:trapped_chest"],V={x:7,y:7,z:7};import{ModalFormData as En}from"@minecraft/server-ui";var ve=class{constructor(e,n,o){this.form=e,this.player=n,this.callback=o}error(e){new U("Error",e).setButton1("Return to form",()=>{this.form.show(this.player,this.callback)}).setButton2("Cancel",null).show(this.player)}};var v=class{constructor(e){this.title=e,this.form=new En,e&&this.form.title(e),this.args=[],this.triedToShow=0}addDropdown(e,n,o){return this.args.push({type:"dropdown",options:n}),this.form.dropdown(e,n,o),this}addSlider(e,n,o,r,i){return this.args.push({type:"slider"}),this.form.slider(e,n,o,r,i),this}addToggle(e,n){return this.args.push({type:"toggle"}),this.form.toggle(e,n),this}addTextField(e,n,o){return this.args.push({type:"textField"}),this.form.textField(e,n,o),this}show(e,n){this.form.show(e).then(o=>{if(o.canceled){if(o.cancelationReason=="userBusy"){if(this.triedToShow>200)return e.tell("\xA7cForm Timeout: tried to show form, but you were busy (close chat after running command)");this.triedToShow++,this.show(e,n)}return}n(new ve(this,e,n),...o.formValues.map((r,i)=>this.args[i].type=="dropdown"?this.args[i].options[r]:r))})}};function Ft(t){new F("Remove a Banned Item").addButton("Remove a Banned Item",null,()=>{Pn(t)}).addButton("Ban an item",null,()=>{xn(t)}).show(t)}function Pn(t){new v("Remove Banned Items").addDropdown("Select item to remove",s.config.get("banned_items")??G).show(t,(e,n)=>{let o=s.config.get("banned_items")??G;o=o.filter(r=>r!=n),s.config.set("banned_items",o),t.tell(`Removed Banned item "${n}"`)})}function xn(t){new v("Add Banned Items").addTextField("Item Id","minecraft:string").show(t,(e,n)=>{let o=s.config.get("banned_items")??G;if(o.includes(n))return e.error(`\xA7cItem "${n}" is already banned`);o.push(n),s.config.set("banned_items",o),t.tell(`Banned the item "${n}"`)})}function zt(t){new v("Manage Banned Blocks").addDropdown("Add/Remove Block",["add","remove"],0).addTextField("Block Id","minecraft:barrier").show(t,(e,n,o)=>{if(!An.get(o)?.id)return e.error(`\xA7c"${o}" is not a vaild block id, note: this item must be either a block in a behavior pack or a default minecraft block`);if(n=="add"){let r=s.config.get("banned_blocks")??le;if(r.includes(o))return e.error(`\xA7cBlock "${o}" is already banned`);r.push(o),s.config.set("banned_blocks",o),t.tell(`Banned the block "${o}"`)}else{let r=s.config.get("banned_blocks")??le;if(!r.includes(o))return e.error(`block: "${o}" is not banned`);r=r.filter(i=>i!=o),s.config.set("banned_blocks",o),t.tell(`Removed Banned block "${o}"`)}})}function Gt(t){new v("Manage Enchantment Levels").addDropdown("Enchantment to change",Object.keys(ce),0).addTextField("Level (number)","5").show(t,(e,n,o)=>{if(isNaN(o))return e.error(`\xA7c"${o}" is not a number, please enter a value like, "3", "9", etc.`);let r=parseInt(o),i=s.config.get("enchantments")??ce;i[n]=r,s.config.set("enchantments",i),t.tell(`Set max level for ${n} to ${r}`)})}function Vt(t){new v("Manage Appeal Link").addTextField("Appeal Link",ke).show(t,(e,n)=>{s.config.set("appealLink",n),t.tell(`Changed the servers appeal link to ${n}`)})}function Ut(t){new F("Rubedo Settings").addButton("Anti Spam","textures/ui/permissions_op_crown.png",()=>{Bn(t)}).addButton("Cbe","textures/blocks/sculk_shrieker_top.png",()=>{Nn(t)}).addButton("Gamemode","textures/blocks/barrier.png",()=>{_n(t)}).addButton("Nuker","textures/ui/Feedback.png",()=>{Dn(t)}).show(t)}function Bn(t){let e=s.config.get("spam_config")??{repeatedMessages:!0,zalgo:!0,violationCount:0,permMutePlayer:!1};new v("Manage Spam Protection").addToggle("Ban Repeated Messages",e.repeatedMessages).addToggle("Ban Zalgo",e.zalgo).addSlider("Violation Count before ban (if ban is false this does nothing)",0,20,1,e.violationCount).addToggle("Perm Mute Player",e.permMutePlayer).show(t,(n,o,r,i,m)=>{s.config.set("spam_config",{repeatedMessages:o,zalgo:r,violationCount:i,permMutePlayer:m}),t.tell("Updated Spam Protection settings!")})}function Nn(t){let e=s.config.get("cbe_config")??{clearItem:!0,violationCount:0,banPlayer:!1,canAddEnchantment:!1};new v("Manage CBE Protection").addToggle("Clear Item",e.clearItem).addSlider("Violation Count before ban (if ban is false this does nothing)",0,20,1,e.violationCount).addToggle("Ban Player",e.banPlayer).addToggle("Allow non-enchantable items to be enchanted",e.banPlayer).show(t,(n,o,r,i,m)=>{s.config.set("cbe_config",{clearItem:o,violationCount:r,banPlayer:i,canAddEnchantment:m}),t.tell("Updated CBE Protection settings!")})}function _n(t){let e=s.config.get("gamemode_config")??{setToSurvival:!0,clearPlayer:!0,violationCount:0,banPlayer:!1};new v("Manage Gamemode Protection").addToggle("Set to survival",e.setToSurvival).addToggle("Clear Player (Once this players gamemode has been switched back to survival should it clear the inventory?)",e.clearPlayer).addSlider("Violation Count before ban (if ban is false this does nothing)",0,20,1,e.violationCount).addToggle("Ban Player",e.banPlayer).show(t,(n,o,r,i,m)=>{s.config.set("gamemode_config",{setToSurvival:o,clearPlayer:r,violationCount:i,banPlayer:m}),t.tell("Updated Gamemode Protection settings!")})}function Dn(t){let e=s.config.get("nuker_data")??{violationCount:0,banPlayer:!1};new v("Manage Gamemode Protection").addSlider("Violation Count before ban (if ban is false this does nothing)",0,20,1,e.violationCount).addToggle("Ban Player",e.banPlayer).show(t,(n,o,r)=>{s.config.set("nuker_data",{violationCount:o,banPlayer:r}),t.tell("Updated Nuker Protection settings!")})}function jt(t){new F("Rubedo Settings").addButton("Auto Mod","textures/ui/permissions_op_crown.png",()=>{Ut(t)}).addButton("Banned items","textures/blocks/sculk_shrieker_top.png",()=>{Ft(t)}).addButton("Banned blocks","textures/blocks/barrier.png",()=>{zt(t)}).addButton("Enchantments","textures/items/book_enchanted.png",()=>{Gt(t)}).addButton("Appeal Link","textures/ui/Feedback.png",()=>{Vt(t)}).show(t)}new d({name:"settings",description:"Opens up the settings menu for the player",requires:t=>["admin","moderator"].includes(c(t))}).executes(t=>{jt(t.sender),t.sender.tell("\xA7aForm request sent, close chat to continue!")});import{world as Ht}from"@minecraft/server";function Yt(t,e){if(t.hasTag("spectator")){if(t.runCommand("gamemode c"),t.runCommand("event entity @s removeSpectator"),t.removeTag("spectator"),!e)return;Ht.say({rawtext:[{translate:"multiplayer.player.joined",with:[`\xA7e${t.name}`]}]})}else{if(t.runCommand("gamemode spectator"),t.runCommand("event entity @s addSpectator"),t.addTag("spectator"),!e)return;Ht.say({rawtext:[{translate:"multiplayer.player.left",with:[`\xA7e${t.name}`]}]})}}new d({name:"vanish",description:"Toggles Vanish Mode on the sender",requires:t=>c(t)=="admin"}).executes(t=>{Yt(t.sender,!1)}).boolean("say").executes((t,e)=>{Yt(t.sender,e)});new d({name:"version",description:"Get Current Version",aliases:["v"]}).executes(t=>{t.reply(`Current Rubedo Version: ${Ot}`)});R(t=>{try{let e=s.bans.get(t.id);if(!e)return;if(e.expire&&e.expire<Date.now())return s.bans.delete(t.id);L(t,["\xA7cYou have been banned!",`\xA7aReason: \xA7f${e.reason}`,`\xA7fExpiry: \xA7b${e.expire?Y(e.expire-Date.now()):"Forever"}`,`\xA7fAppeal at: \xA7b${s.config.get("appealLink")??ke}`],()=>{console.warn(new Error("Failed to kick player")),s.bans.delete(t.id)})}catch(e){console.warn(e+e.stack)}},20);import{Location as Mn}from"@minecraft/server";R(t=>{let e=s.freezes.get(t.id);!e||t.teleport(new Mn(e.location.x,e.location.y,e.location.z),I[e.location.dimension],0,0)},20);import{world as $n}from"@minecraft/server";var Xe={};$n.events.beforeChat.subscribe(t=>{if(!t.message.startsWith(T))for(let e of Object.values(Xe))e.callback(t)});var Te=class{static subscribe(e){let n=Date.now();return Xe[n]={callback:e},n}static unsubscribe(e){delete Xe[e]}};Te.subscribe(t=>{let e=N.getMuteData(t.sender);if(!!e){if(e.expire&&e.expire<Date.now())return s.mutes.delete(t.sender.name);t.cancel=!0,t.sender.tell(w["modules.managers.mute.isMuted"]())}});import{BlockLocation as On,world as Ze}from"@minecraft/server";A(()=>{ue()},6e3);Ze.events.beforeItemUseOn.subscribe(t=>{if(["moderator","admin"].includes(c(t.source)))return;let e=g.blockLocationInRegion(t.blockLocation,t.source.dimension.id);if(!e)return;let n=t.source.dimension.getBlock(t.blockLocation);at.includes(n.typeId)&&e.permissions.doorsAndSwitches||mt.includes(n.typeId)&&e.permissions.openContainers||(t.cancel=!0)});Ze.events.beforeExplosion.subscribe(t=>{for(let e=0;e<t.impactedBlocks.length;e++){let n=t.impactedBlocks[e];if(g.blockLocationInRegion(n,t.dimension.id))return t.cancel=!0}});Ze.events.entityCreate.subscribe(t=>{let e=g.blockLocationInRegion(new On(t.entity.location.x,t.entity.location.y,t.entity.location.z),t.entity.dimension.id);!e||e.permissions.allowedEntitys.includes(t.entity.typeId)||(t.entity.teleport({x:0,y:-64,z:0},t.entity.dimension,0,0),t.entity.kill())});A(()=>{for(let t of g.getAllRegions())for(let e of I[t.dimensionId].getEntities({excludeTypes:t.permissions.allowedEntitys}))!t.entityInRegion(e)||(e.teleport({x:0,y:-64,z:0},e.dimension,0,0),e.kill())},100);R(t=>{for(let e of g.getAllRegions())e.entityInRegion(t)?(t.addTag("inRegion"),e.permissions.pvp||t.addTag("region-protected")):(t.removeTag("inRegion"),t.removeTag("region-protected"))},5);import{world as Qe}from"@minecraft/server";Qe.events.playerJoin.subscribe(({player:t})=>{if(pe()&&c(t)!="admin")return L(t,w["lockdown.kick.message"]());let e=Qe.events.tick.subscribe(n=>{try{I.overworld.runCommand(`testfor @a[name="${t.name}"]`),Qe.events.tick.unsubscribe(e),N.getMuteData(t)&&t.runCommand("ability @s mute true"),s.ids.has(t.name)?t.addTag("old"):s.ids.set(t.name,t.id);let o=_.getPlayersRoleToSet(t.name);o&&H(t,o)}catch{}})});import{Items as Fn,MinecraftItemTypes as E,world as et}from"@minecraft/server";var Kt=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44],zn=[10,11,12,13,14,15,16,19,20,21,22,23,24,25,28,29,30,31,32,33,34,37,38,39,40,41,42,43];function Gn(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let r=0;r<o.size;r++){let i=e.slots[r];if(!i||!i.item){o.setItem(r,B);continue}o.setItem(r,i.item.itemStack)}for(let[r,i]of[...et.getPlayers()].entries()){let m=Kt[r],a=new h(E.skull,{nameTag:i.name,data:3});o.setItem(m,a.itemStack),e.slots[m]={item:a,action:l=>{l.PageAction("moderation:see_inventory",{name:i.name})}}}}function Vn(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let l=0;l<o.size;l++){let p=e.slots[l];if(!p||!p.item){o.setItem(l,B);continue}o.setItem(l,p.item.itemStack)}let r=new h(E.enderChest,{nameTag:`\xA7eView \xA7f${n?.name}\xA7e Ender Chest
\xA7fNote: \xA7cThis will not grab \xA7lANY NBT!\xA7r`});o.setItem(49,r.itemStack),e.slots[49]={item:r,action:l=>{l.PageAction("moderation:see_ender_chest",{name:n.name})}};let i=[...et.getPlayers()].find(l=>l.name==n.name);i||(Object.values(P).find(p=>p.entity.id==t.id).despawn(),i.tell(`"${n.name}" Could not be found, Gui Crashed`));let m=i.getComponent("inventory").container,a=0;for(let l=0;l<m.size;l++){let p=m.getItem(l),u=Kt[a];if(a++,!p){o.setItem(u,B);continue}o.setItem(u,p),e.slots[u]={item:new h(Fn.get(p.typeId),{amount:p.amount,data:p.data},p),action:Pe=>{l<9?i.runCommand(`replaceitem entity @s slot.hotbar ${l} air`):i.runCommand(`replaceitem entity @s slot.inventory ${l-9} air`),Pe.GiveAction(),e.slots[u]={item:null,action:on=>{m.addItem(on.getItemAdded())}}}}}}function Un(t,e,n){let o=t.getComponent("minecraft:inventory").container;for(let a=0;a<o.size;a++){let l=e.slots[a];if(!l||!l.item){o.setItem(a,B);continue}o.setItem(a,l.item.itemStack)}let r=[...et.getPlayers()].find(a=>a.name==n?.name);r||(Object.values(P).find(l=>l.entity.id==t.id).despawn(),r.tell(`"${n.name}" Could not be found, Gui Crashed`));let i=0,m=Object.values(E);for(let a of m)try{r.runCommand(`testfor @s[hasitem={item=${a.id},location=slot.enderchest}]`),console.warn(`found ${a.id}`);let l=new h(a,{nameTag:"Note: \xA7l\xA7cThis is not the exzact item"}),p=zn[i];o.setItem(p,l.itemStack),e.slots[p]={item:l,action:u=>{u.GiveAction(),e.slots[p]=null}},i++}catch{}}new O("moderation:see",Gn).setSlots([45,46,47,49,51,52,53],new h(E.stainedGlassPane,{nameTag:"\xA7r",data:15}),t=>{t.SetAction()}).setSlots([50],new h(E.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("home")}).setSlots([48],new h(E.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});new O("moderation:see_inventory",Vn).setSlots([45,46,47,49,51,52,53],new h(E.stainedGlassPane,{nameTag:"\xA7r",data:15}),t=>{t.SetAction()}).setSlots([50],new h(E.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("moderation:see")}).setSlots([48],new h(E.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});new O("moderation:see_ender_chest",Un).setSlots([0,1,2,3,4,5,6,7,8,9,17,18,26,27,35,36,44,45,46,47,49,51,52,53],new h(E.stainedGlassPane,{nameTag:"\xA7r",data:15}),t=>{t.SetAction()}).setSlots([50],new h(E.arrow,{nameTag:"\xA7fBack"}),t=>{t.PageAction("moderation:see")}).setSlots([48],new h(E.barrier,{nameTag:"\xA7cClose GUI"}),t=>{t.CloseAction()});import{ItemStack as jn,MinecraftItemTypes as Hn,world as tt,Player as Yn}from"@minecraft/server";var Kn=new jn(Hn.stick,0),qn=["minecraft:command_block_minecart"],qt=new k;R(t=>{let e=s.config.get("cbe_config")??{clearItem:!0,violationCount:0,banPlayer:!1,canAddEnchantment:!1},n=t.getComponent("inventory").container;for(let o=0;o<n.size;o++){let r=n.getItem(o);if(!r)continue;let i=()=>{console.warn(`[Protection: CBE]: ${t.name} Has a CBE item!`),e.clearItem&&t.getComponent("inventory").container.setItem(o,Kn);let u=(qt.get(t)??0)+1;qt.set(t,u),e.banPlayer&&u>=e.violationCount&&new C(t,null,null,"Cbe Detection")};if((s.config.get("banned_items")??G).includes(r.typeId))return i();let a=r.getComponent("enchantments").enchantments,l=s.config.get("enchantments")??ce,p=[];for(let u of a){let Pe=l[u.type.id]??u.type.maxLevel;if(a.slot==0&&!e.canAddEnchantment&&!a.canAddEnchantment(u)||u.level>Pe||u.level<1||p.includes(u.type.id))return i();p.push(u.type.id)}}});tt.events.entityCreate.subscribe(({entity:t})=>{if(t.typeId!="minecraft:npc")return;let e=()=>{try{t.triggerEvent("despawn"),t.kill()}catch{t.kill()}};if(qn.includes(t.typeId)||t.typeId=="minecraft:npc"&&!W.isVaild(t))return e()});tt.events.beforeItemUseOn.subscribe(t=>{!(t.source instanceof Yn)||["moderator","admin"].includes(c(t.source))||!(s.config.get("banned_blocks")??le).includes(t.item.typeId)||(t.cancel=!0,new C(t.source,null,"Placing Banned Block"))});tt.events.blockPlace.subscribe(({player:t,block:e})=>{if(!["minecraft:chest","minecraft:trapped_chest"].includes(e.typeId))return;let n=e.getComponent("inventory")?.container;if(!n)return;let o=s.config.get("banned_items")??G;for(let r=0;r<n.size;r++){let i=n.getItem(r);if(!!i&&!!o.includes(i.typeId)){e.dimension.runCommandAsync(`setblock ${e.x} ${e.y} ${e.z} air`),new C(t,null,"Placing Chest with Banned Items");return}}});var nt=32e4;R(t=>{(Math.abs(t.location.x)>nt||Math.abs(t.location.y)>nt||Math.abs(t.location.z)>nt)&&new C(t,null,null,"Hacking: Crasher")});import{GameMode as Wn,world as Jn}from"@minecraft/server";var Xn=Wn.creative,Wt=new k;A(()=>{let t=s.config.get("gamemode_config")??{setToSurvival:!0,clearPlayer:!0,violationCount:0,banPlayer:!1};for(let e of Jn.getPlayers({gameMode:Xn})){if(["moderator","admin","builder"].includes(c(e)))continue;try{t.setToSurvival&&e.runCommand("gamemode s"),t.clearPlayer&&e.runCommand("clear @s")}catch{}let n=(Wt.get(e)??0)+1;Wt.set(e,n),t.banPlayer&&n>=t.violationCount&&new C(e,null,null,"Invaild Gamemode")}},20);import{world as Jt}from"@minecraft/server";var Zn="\xA7c\xA7k\xA7m\xA7A\xA7r\xA7cToolbox Gamer\xA7k\xA7mA\xA7r";Jt.events.playerJoin.subscribe(({player:t})=>{let e=()=>L(t,["\xA7cYou have been kicked!",`\xA7aReason: \xA7f'${t.name}' is Detected for nameSpoof`,"\xA7fThis Server requires you to have a valid gamertag!"]);if(t.name==Zn||[...Jt.getPlayers()].filter(n=>n.name==t.name).length>1||(s.ids.get(t.name)??t.id)!=t.id||t.name.includes("\xA7"))return e()});import{world as eo,Location as to}from"@minecraft/server";import{world as Qn}from"@minecraft/server";var Se=class{constructor(e){this.emptySlotsCount=e.emptySlotsCount,this.size=e.size,this.items=[];for(let n=0;n<this.size;n++)this.items[n]=e.getItem(n)}load(e){for(let n=0;n<e.size;n++)!this.items[n]||e.setItem(n,this.items[n])}};var Ee={};A(()=>{Ee={};for(let t of Qn.getPlayers()){if(t.dimension.id!="minecraft:overworld")continue;let e=pt(t.location),n=e.offset(V.x,V.y,V.z),o=e.offset(-V.x,-V.y,-V.z);for(let r of n.blocksBetween(o)){if(r.y<-64)continue;let i=t.dimension.getBlock(r);!i||!Ce.includes(i.typeId)||(Ee[JSON.stringify(r)]=new Se(i.getComponent("inventory").container))}}},100);var Xt=new k,no=70,oo=["snow","lush_plants_replaceable","azalea_log_replaceable","minecraft:crop","fertilize_area"],ro=["minecraft:water","minecraft:flowing_water","minecraft:lava","minecraft:flowing_lava","minecraft:bedrock"],Zt=new k;eo.events.blockBreak.subscribe(({block:t,brokenBlockPermutation:e,dimension:n,player:o})=>{if(["moderator","admin"].includes(c(o))||t.getTags().some(a=>oo.includes(a)))return;let r=Xt.get(o);if(Xt.set(o,Date.now()),!r||ro.includes(t.typeId)||r<Date.now()-no)return;let i=s.config.get("nuker_data")??{violationCount:0,banPlayer:!1},m=(Zt.get(o)??0)+1;if(Zt.set(o,m),i.banPlayer&&m>=i.violationCount&&new C(o,null,null,"Using Nuker"),n.getBlock(t.location).setPermutation(e.clone()),Ce.includes(e.type.id)){let a=Ee[JSON.stringify(t.location)];a&&a.load(t.getComponent("inventory").container)}Fe(()=>{[...n.getEntities({maxDistance:2,type:"minecraft:item",location:new to(t.location.x,t.location.y,t.location.z)})].forEach(a=>a.kill())},0)});import{world as io}from"@minecraft/server";var Qt=new k,en=new k;io.events.beforeChat.subscribe(t=>{if(t.message.startsWith(T)||["admin","moderator"].includes(c(t.sender)))return;let e=s.config.get("spam_config")??{repeatedMessages:!0,zalgo:!0,violationCount:0,permMutePlayer:!1},n=()=>{let o=(en.get(t.sender)??0)+1;en.set(t.sender,o),e.permMutePlayer&&o>=e.violationCount&&new N(t.sender,null,null,"Reached Violation count")};if(e.repeatedMessages&&Qt.get(t.sender)==t.message)return t.cancel=!0,n(),t.sender.tell("\xA7cRepeated message detected!");if(e.zalgo&&/%CC%/g.test(encodeURIComponent(t.message)))return t.cancel=!0,n(),t.sender.tell("\xA7cYou message contains some type of zalgo and cannot be sent!");Qt.set(t.sender,t.message)});import{Player as so,world as de}from"@minecraft/server";var ao=de.events.beforeDataDrivenEntityTriggerEvent.subscribe(t=>{if(de.getDynamicProperty("roleHasBeenSet"))return de.events.beforeDataDrivenEntityTriggerEvent.unsubscribe(ao);t.entity instanceof so&&t.id=="rubedo:becomeAdmin"&&(H(t.entity,"admin"),de.setDynamicProperty("roleHasBeenSet",!0),de.setDynamicProperty("worldsOwner",t.entity.id),t.entity.tell("\xA7l\xA7cYou have been given admin, the function start will not work anymore!!!!"))});import{system as mo}from"@minecraft/server";mo.events.beforeWatchdogTerminate.subscribe(t=>{t.cancel=!0,console.warn(`WATCHDOG TRIED TO CRASH = ${t.terminateReason}`)});import{DynamicPropertiesDefinition as ot,EntityTypes as co,MinecraftEntityTypes as lo,world as nn}from"@minecraft/server";var tn=[];nn.events.worldInitialize.subscribe(({propertyRegistry:t})=>{I.overworld.runCommandAsync(`tickingarea add ${x.x} ${x.y} ${x.z} ${x.x} ${x.y} ${x.z} db true`);let e=new ot;e.defineString("name",30),e.defineNumber("index"),t.registerEntityTypeDynamicProperties(e,co.get(J));let n=new ot;n.defineString("role",30),t.registerEntityTypeDynamicProperties(n,lo.player);let o=new ot;o.defineBoolean("roleHasBeenSet"),o.defineString("worldsOwner",100),o.defineBoolean("isLockDown"),t.registerWorldDynamicProperties(o);for(let r of tn)nn.scoreboard.addObjective(r.objective,r.displayName??"")});console.warn("----- Importing Plugins -----");console.warn("---- STARTING RUBEDO ----");var Ie=[];function Dt(){Ie=[]}var Ae=null,B=new uo(po.stick,0);fo.events.tick.subscribe(t=>{Ae?Ae=Ae+1:Ae=t.currentTick});export{B as AIR,Ae as CURRENT_TICK,Ie as NPC_LOCATIONS,Dt as clearNpcLocations};
//# sourceMappingURL=index.js.map
